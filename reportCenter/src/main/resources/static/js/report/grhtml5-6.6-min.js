var gr={},DEBUG=0;!function(){"use strict";gr.const_={VERSION:"6.6.18.1030",REPORT_STYLE_ID:"-gr-style-id",DG_ID:"_grdg",CONTENT_RECNO:"_grRecNo",GROUPH_INDEX:"_grGHIndex",GROUPF_INDEX:"_grGFIndex",GROUP_RECNO:"_grGRecNo",DG_CSS:"_grdg",SH_CSS:"_grshcss",BIG_AMT_NUMBER:"零壹贰叁肆伍陆柒捌玖",HZ_NUMBER:"一二三四五六七八九十零",HZ_NEGATIVE:"负",HZ_ZERO_YUAN:"零元整",HZ_AMT_STEP:"元拾佰仟万拾佰仟亿拾佰仟",HZ_AMT_UNIT:"整角分",HZ_DATETIME_UNIT:"周日星期天",MILLISECONDS_DAY:864e5,TIMEZONE_OFFSET:6e4*(new Date).getTimezoneOffset()},gr.enum_={PenStyle:{Solid:0,Dash:1,Dot:2,DashDot:3,DashDotDot:4},BorderStyle:{DrawLeft:1,DrawTop:2,DrawRight:4,DrawBottom:8},BackStyle:{Normal:1,Transparent:2},TextAlign:{TopLeft:17,TopCenter:18,TopRight:20,TopJustiy:144,BottomLeft:65,BottomCenter:66,BottomRight:68,BottomJustiy:192,MiddleLeft:33,MiddleCenter:34,MiddleRight:36,MiddleJustiy:160},TextOrientation:{Default:0,U2DL2R0:5,D2UL2R1:22,U2DR2L0:9,U2DR2L1:25,Invert:58,L2RD2U0:38,L2RD2U1:54},ParameterDataType:{String:1,Integer:2,Float:3,Boolean:5,DateTime:6},FieldType:{String:1,Integer:2,Float:3,Currency:4,Boolean:5,DateTime:6,Binary:7},ControlType:{StaticBox:1,ShapeBox:2,SystemVarBox:3,FieldBox:4,SummaryBox:5,RichTextBox:6,PictureBox:7,MemoBox:8,SubReport:9,Line:10,Chart:11,Barcode:12,FreeGrid:13},SummaryFun:{Sum:1,Avg:2,Count:3,Min:4,Max:5,Var:6,VarP:7,StdDev:8,StdDevP:9,AveDev:10,DevSq:11,CountBlank:12,CountA:13,Distinct:14,AvgA:15,MinN:16,MaxN:17,StrMin:18,StrMax:19,VarA:20,VarPA:21,StdDevA:22,StdDevPA:23,AveDevA:24,DevSqA:25,SumAbs:26,SumAcc:27,GroupSumAcc:28},SystemVarType:{CurrentDateTime:1,RecordNo:4,RowNo:8,RecordCount:19,GroupNo:20,GroupCount:21,GroupRowNo:22,GroupRowCount:23},AnchorStyle:{Left:1,Top:2,Right:4,Bottom:8},AlignColumnSideStyle:{Left:1,Right:2,Both:3},DockStyle:{None:0,Left:1,Top:2,Right:3,Bottom:4,Fill:5},CenterStyle:{None:0,Horizontal:1,Vertical:2,Both:3},ShiftMode:{Never:0,Always:1,WhenOverLapped:2},Unit:{Cm:1,Inch:2},ShapeBoxType:{Circle:1,Ellipse:2,Rectangle:3,RoundRect:4,RoundSquare:5,Square:6,Line:7},PictureAlignment:{TopLeft:1,TopRight:2,Center:3,BottomLeft:4,BottomRight:5},PictureSizeMode:{Clip:1,Stretch:2,Zoom:3,EnsureFullView:4,Tile:5},PictureTransparentMode:{None:0,Overlying:1,Background:2},PictureRotateMode:{None:0,Left:1,Right:2,Flip:3,Mirror:4},ChartType:{BarChart:1,PieChart:2,LineChart:3,StackedBarChart:4,XYScatterChart:5,XYLineChart:6,CurveLineChart:7,XYCurveLineChart:8,Bubble:9,StackedBar100Chart:10,ColumnChart:11,StackedColumnChart:12,StackedColumn100Chart:13},ChartVarType:{XVal:1,YVal:2,ZVal:3,YVal100ByGroup:4,YVal100BySeries:5,YValTotalByGroup:6,YValTotalBySeries:7,SeriesLabel:8,GroupLabel:9},PointMarkerStyle:{None:-1,Square:0,SquareCheck:1,SquareCross:2,Circle:3,CirclePoint:4,CircleCross:5,Dimond:6,Triangle:7,Cross:8,Cross4:9,Star4:10,Star5:11,Star6:12,Star10:13},BarcodeType:{Code25Intlv:1,Code25Ind:2,Code25Matrix:3,Code39:4,Code39X:5,Code128A:6,Code128B:7,Code128C:8,Code93:9,Code93X:10,CodeMSI:11,CodePostNet:12,CodeCodabar:13,CodeEAN8:14,CodeEAN13:15,CodeUPC_A:16,CodeUPC_E0:17,CodeUPC_E1:18,CodeUPC_Supp2:19,CodeUPC_Supp5:20,CodeEAN128A:21,CodeEAN128B:22,CodeEAN128C:23,Code128Auto:24,PDF417:50,QRCode:51,DataMatrix:52},BarcodeCaptionPosition:{None:1,Above:2,Below:3},BarcodeDirection:{LeftToRight:1,RightToLeft:2,TopToBottom:3,BottomToTop:4},DtmxEncoding:{Auto:2,Ascii:3,C40:4,Text:5,X12:6,Edifact:7,Base256:8},DtmxMatrixSize:{Auto:2,"10x10":4,"12x12":5,"14x14":6,"16x16":7,"18x18":8,"20x20":9,"22x22":10,"24x24":11,"26x26":12,"32x32":13,"36x36":14,"40x40":15,"44x44":16,"48x48":17,"52x52":18,"64x64":19,"72x72":20,"80x80":21,"88x88":22,"96x96":23,"104x104":24,"120x120":25,"132x132":26,"144x144":27,"8x18":28,"8x32":29,"12x26":30,"12x36":31,"16x36":32,"16x48":33},StringAlignment:{Near:1,Center:2,Far:3},PeriodType:{None:0,Day:1,Week:2,ThirdMonth:3,HalfMonth:4,Month:5,Quarter:6,HalfYear:7,Year:8,Calendar:9},OCGroupHeaderVAlign:{Top:1,Bottom:2,Middle:3},controlLayout:{auto:0,table:1,absolute:2},detailgridResize:{asDesign:0,fitWidth:1,onlyGrow:2}},gr.locale={supportIntl:!!window.Intl,decimalSep:".",thousandSep:",",dateSep:"-",timeSep:":",textAM:"上午",textPM:"下午",currencySymbol:"￥"},gr.script={calcExp:function(expText){var result=NaN;expText="result="+expText;try{eval(expText)}catch(e){result=NaN}return result},execEvent:function(scriptText,scriptName,Sender,Report){var globalScript=Report.GlobalScript;try{globalScript&&(scriptText+=" "+globalScript),eval(scriptText)}catch(e){alert("执行报表脚本 '"+scriptName+"' 失败"+(Sender.Name?"\n对象名称: "+Sender.Name:"")+"\n错误信息: "+e.toString()+"\n脚本代码:\n"+scriptText)}}},gr.WRZipSource=['":"','","','"},{"','":{"','},{"','":',',"',"false"],gr.WRZipDest="!$%&@^`~",gr.WRAsciiMap_R="r<~VH6SAZ?yiO %1#Ek>]`+|F_t/$RgQnX=YbqL)7uU9,oaB5}-'ev4;JD.2WsP@3zhl\"cfC^(K0mx!&Td{*GM:[pIj8\\Nw",gr.propNameMap={AlternatingBackColor:"G",BackColor:"Q",BarcodeType:"b",BorderCustom:"i",DBFieldName:"WA",FreeCell:"AB",GroupLabel:"OB",GroupTitle:"PB",IsCrossTab:"jB",Name:"YC",SeriesLabel:"HE",Type:"LF",Value:"UF"},gr.propNameMap_R={A:"AdjustRowHeight",B:"AlignColumn",C:"AlignColumnEx",D:"AlignColumnSide",E:"AlignToGrid",F:"Alignment",G:"AlternatingBackColor",H:"AlwaysShowHScrollBar",I:"AlwaysShowVScrollBar",J:"Anchor",K:"AppendBlankCol",L:"AppendBlankColWidth",M:"AppendBlankRow",N:"AppendBlankRowAtLast",O:"AppendBlankRowExclude",P:"Author",Q:"BackColor",R:"BackImage",S:"BackImageFile",T:"BackImagePreview",U:"BackImagePrint",V:"BackStyle",W:"BackgroundColor",X:"BarRatio",Y:"BarSingleSeriesColor",Z:"BarWidth",a:"BarWidthPercent",b:"BarcodeType",c:"BeforePostRecordScript",d:"BeforeSortScript",e:"BeginDateParameter",f:"Bold",g:"BookmarkText",h:"BorderColor",i:"BorderCustom",j:"BorderPrintType",k:"BorderStyles",l:"BorderWidth",m:"BottomMargin",n:"BubbleScalePerCm",o:"ByFields",p:"ByY2Axis",q:"CanGrow",r:"CanShrink",s:"CaptionAlignment",t:"CaptionPosition",u:"Center",v:"CenterView",w:"CenterWithDetailGrid",x:"CharSpacing",y:"CharacterSpacing",z:"Charset",AA:"Chart3D",BA:"ChartType",CA:"CheckSum",DA:"CodePage",EA:"ColLineColor",FA:"ColLineWidth",GA:"ColSpan",HA:"Color",IA:"Column",JA:"ColumnCount",KA:"ColumnMove",LA:"ColumnResize",MA:"ConditionScript",NA:"ConnectionString",OA:"ContinuePrint",PA:"CoordLineColor",QA:"CoordLineVisible",RA:"CornerDx",SA:"CornerDy",TA:"Cursor",UA:"CustomDraw",VA:"CustomDrawScript",WA:"DBFieldName",XA:"DataField",YA:"DataName",ZA:"DataType",aA:"Description",bA:"Direction",cA:"DisabledSumFields",dA:"DisplayField",eA:"Dock",fA:"DtmxEncoding",gA:"DtmxMatrixSize",hA:"DtmxModuleSize",iA:"Editable",jA:"EndDateParameter",kA:"EndEllipsis",lA:"ExportBeginScript",mA:"ExportEndScript",nA:"FalseText",oA:"FetchRecordScript",pA:"FillColor",qA:"FillColorAuto",rA:"FillStyle",sA:"FirstCharIndent",tA:"FixCols",uA:"FixedWidth",vA:"FlowTo",wA:"FontWidthRatio",xA:"ForeColor",yA:"Format",zA:"FormatScript",AB:"FreeCell",BB:"GetDisplayTextScript",CB:"GlobalScript",DB:"GridColsPerUnit",EB:"GridLinePrintType",FB:"GridRowsPerUnit",GB:"GroupAuto",HB:"GroupAutoSum",IB:"GroupBeginScript",JB:"GroupCount",KB:"GroupEndScript",LB:"GroupField",MB:"GroupIndex",NB:"GroupKeepTogether",OB:"GroupLabel",PB:"GroupTitle",QB:"GrowToBottom",RB:"GrowToNextRow",SB:"HCrossFields",TB:"HCrossPeriodType",UB:"HNewPageFixed",VB:"HPercentColumns",WB:"HResort",XB:"HSortAsc",YB:"HTotalAtFirst",ZB:"Height",aB:"HideOnRecordsetEmpty",bB:"HtmlTags",cB:"Image",dB:"ImageFile",eB:"ImageIndex",fB:"IncludeFooter",gB:"InitializeScript",hB:"InnerIndent",iB:"InnerStyles",jB:"IsCrossTab",kB:"Italic",lB:"KeepTogether",mB:"L2R",nB:"Label",oB:"LabelAsGroup",pB:"LabelInBar",qB:"LabelText",rB:"LabelTextAngle",sB:"Left",tB:"LeftMargin",uB:"LegendAtBottom",vB:"LegendColumnCount",wB:"LegendCursor",xB:"LegendShowSum",yB:"LegendSumLabel",zB:"LegendValueVisible",AC:"LegendVisible",BC:"Length",CC:"LimitsPerPage",DC:"LineColor",EC:"LineSpacing",FC:"LineType",GC:"LineVisible",HC:"LineWeight",IC:"ListCols",JC:"LnSpacing",KC:"Lock",LC:"Locked",MC:"MarginBeginWeight",NC:"MarginEndWeight",OC:"MarginGap",PC:"MarkerColor",QC:"MarkerColorAuto",RC:"MarkerLegendShow",SC:"MarkerSize",TC:"MarkerStyle",UC:"Max",VC:"Min",WC:"MirrorMargins",XC:"MonoPrint",YC:"Name",ZC:"NegativeAsZero",aC:"NewPage",bC:"NewPageColumn",cC:"OccupiedColumns",dC:"OccupyColumn",eC:"Oriention",fC:"PDF417Columns",gC:"PDF417ErrorLevel",hC:"PDF417Rows",iC:"PDF417Simple",jC:"PaddingBottom",kC:"PaddingLeft",lC:"PaddingRight",mC:"PaddingTop",nC:"PageColumnCount",oC:"PageColumnDirection",pC:"PageColumnGroupNA",qC:"PageColumnSpacing",rC:"PageDivideCount",sC:"PageDivideLine",tC:"PageDivideSpacing",uC:"PageEndScript",vC:"PageGroup",wC:"PageProcessRecordScript",xC:"PageStartScript",yC:"ParagraphSpacing",zC:"Parameter",AD:"ParentPageSettings",BD:"PenColor",CD:"PenStyle",DD:"PenWidth",ED:"PercentFormat",FD:"Picture",GD:"Pitch",HD:"PointWeight",ID:"PrintAdaptFitText",JD:"PrintAdaptMethod",KD:"PrintAdaptRFCStep",LD:"PrintAdaptRepeat",MD:"PrintAdaptTryToOnePage",ND:"PrintAsDesignPaper",OD:"PrintAtBottom",PD:"PrintBeginScript",QD:"PrintEndScript",RD:"PrintGridBorder",SD:"PrintOffsetSaveToLocal",TD:"PrintOffsetX",UD:"PrintOffsetY",VD:"PrintPageScript",WD:"PrintRotation",XD:"PrintToStretch",YD:"PrintType",ZD:"PrinterName",aD:"ProcessBeginScript",bD:"ProcessEndScript",cD:"ProcessRecordScript",dD:"QRCodeErrorLevel",eD:"QRCodeMask",fD:"QRCodeVersion",gD:"QuerySQL",hD:"RTF",iD:"RTrimBlankChars",jD:"RankNo",kD:"RegisterNo",lD:"RelationFields",mD:"RepeatOnPage",nD:"RepeatStyle",oD:"ReportFile",pD:"ResetPageNumber",qD:"RightMargin",rD:"RotateMode",sD:"RowCount",tD:"RowLineColor",uD:"RowLineWidth",vD:"RowSelection",wD:"RowSpan",xD:"RowsIncludeGroup",yD:"RowsPerPage",zD:"SameAsColumn",AE:"ScriptType",BE:"SelectionBackColor",CE:"SelectionForeColor",DE:"SeriesAuto",EE:"SeriesCount",FE:"SeriesCursor",GE:"SeriesField",HE:"SeriesLabel",IE:"SeriesName",JE:"Shadow",KE:"ShadowColor",LE:"ShadowWidth",ME:"ShapeType",NE:"SharePrintSetupOptions",OE:"ShiftMode",PE:"ShowColLine",QE:"ShowGrid",RE:"ShowMoneyDigit",SE:"ShowMoneyLabel",TE:"ShowMoneyLine",UE:"ShowMoneyLineColor",VE:"ShowMoneySepLineColor",WE:"ShowMoneyWidth",XE:"ShowPreviewWndScript",YE:"ShowRowLine",ZE:"ShrinkFontToFit",aE:"SingleSeriesColored",bE:"Size",cE:"SizeMode",dE:"SkipQuery",eE:"SortAsc",fE:"SortCaseSensitive",gE:"SortFields",hE:"SortSummaryBox",iE:"Space",jE:"SpanToNewPage",kE:"Strikethrough",lE:"Style",mE:"Styles",nE:"SubtotalCols",oE:"SummaryFun",pE:"SystemVar",qE:"Tag",rE:"Text",sE:"TextAlign",tE:"TextAngle",uE:"TextFormat",vE:"TextOrientation",wE:"TextVisible",xE:"Title",yE:"TitleRepeat",zE:"TitleRows",AF:"ToNewExcelSheet",BF:"TooltipText",CF:"Top",DF:"TopMargin",EF:"TotalCols",FF:"TotalExcludeColumns",GF:"TotalHPercentColumns",HF:"TotalVPercentColumns",IF:"Transparent",JF:"TransparentMode",KF:"TrueText",LF:"Type",MF:"U2D",NF:"Underline",OF:"Unit",PF:"VAlign",QF:"VCrossFields",RF:"VPercentColumns",SF:"VResort",TF:"VSortAsc",UF:"Value",VF:"ValueAsPercent",WF:"ValueFormat",XF:"ValueVisible",YF:"Version",ZF:"Visible",aF:"Watermark",bF:"WatermarkAlignment",cF:"WatermarkSizeMode",dF:"Weight",eF:"Width",fF:"WordWrap",gF:"XAxisLabel",hF:"XAxisMaximum",iF:"XAxisMinimum",jF:"XAxisSpace",kF:"XAxisTextAngle",lF:"XAxisTextFormat",mF:"XAxisTextVisible",nF:"XAxisVisible",oF:"XValueField",pF:"XmlTableName",qF:"YAxisLabel",rF:"YAxisMaximum",sF:"YAxisMinimum",tF:"YAxisSpace",uF:"YAxisTextFormat",vF:"YAxisTextVisible",wF:"YAxisVisible",xF:"YValueField",yF:"ZValueField",zF:"ZValueFormat"}}(),function(e){"use strict";var t=gr.enum_,r=gr.const_,o=gr.helper={},n=gr.common={},a=r.MILLISECONDS_DAY,i=r.TIMEZONE_OFFSET,l=o.wrPropNameEncode=function(e){var t=gr.propNameMap[e];return t?t:e},s=o.wrPropNameDecode=function(e){var t=gr.propNameMap_R[e];return t?t:e},c=o.assignJSONMembers=function(t,r,o){var n,a;o===e&&(o=t.report.isWR);for(a in r)n=r[a],"object"!=typeof n&&(o&&(a=s(a)),t.hasOwnProperty(a)&&(t[a]=n))},u=o.enumMemberValid=function(e,t,r){"number"!=typeof e[t]&&(e[t]=x(r,e[t]))},d=o.enumBitMemberValid=function(e,t,r){"number"!=typeof e[t]&&(e[t]=S(r,e[t]))},h=o.colorMemberValid=function(e,t,r){"number"!=typeof e[t]&&(e[t]=parseInt("0x"+e[t],16)|Math.max(0,Math.min(Math.round(255*r),255))<<24)},p=o.penStyleText=function(e){var r={Solid:"solid",Dash:"dashed",Dot:"dotted",DashDot:"dashed",DashDotDot:"dotted"};return C(e.Width)+" "+r[y(t.PenStyle,e.Style)]+" "+P(e.Color)},f=o.fontHeight=function(e){return 4*e.Size/3e4},g=(o.fontString=function(e,t,r){return t+" "+C(e)+" "+r},o.fontCSSText=function(e){var t="",r=[];return e.Italic&&r.push("italic"),e.Bold&&r.push("bold"),r.push(C(f(e)),e.Name),r.forEach(function(e){t&&(t+=" "),t+=e}),t}),m=(o.intFixed=function(e,t){var r,o=e+"";if(t>0)if(r=t-o.length,0>r)o=o.substr(-r);else for(;r-- >0;)o="0"+o;return o},function(e){var t=e.toFixed(2),r=t.length-1;return"0"===t.charAt(r)&&("0"===t.charAt(r-1)&&(r-=2),t=t.substr(0,r)),t}),C=o.pixelsToHtml=function(e){return m(e)+"px"},b=(o.percentToHtml=function(e){return m(e)+"%"},o.cloneDate=function(e){return new Date(e)}),v=o.confirmDateValue=function(e){function t(){function t(){var t=e.indexOf(":"),o=t>0&&8>t,n=e.split(/[\:\-\/ ]/g),a=n.length,i=a>0?+n[0]:0,l=a>1?+n[1]:0,s=a>2?+n[2]:0,c=a>3?+n[3]:0,u=a>4?+n[4]:0,d=a>5?+n[5]:0;return isNaN(l)&&(t=n[1],l=r.HZ_NUMBER.indexOf(t.charAt(0))+1,t.length>=3&&(l+=r.HZ_NUMBER.indexOf(t.charAt(1))+1)),o&&(t=i,i=c,c=t,t=l,l=u,u=t,t=s,s=d,d=t),s>31&&(t=i,i=s,s=t,t=l,l=s,s=t),l>12&&(t=l,l=s,s=t),new Date(i,--l,s,c,u,d)}var o;return"string"!=typeof e?(o=new L,o.AsFloat=+e,e=o.value):(o=Date.parse(e),e=isNaN(o)?t():new Date(o)),e}return Date.prototype.isPrototypeOf(e)?e:t()},T=(o.confirmCloneDateValue=function(e){return Date.prototype.isPrototypeOf(e)?b(e):v(e)},o.strimDate=function(e){var t=e.getTime();e.setTime(t-(t-6e4*e.getTimezoneOffset())%a)},o.incDate=function(e){e.setTime(e.getTime()+a)},o.incDate2=function(e,t){e.setTime(e.getTime()+t*a)}),x=(o.periodRangeBy=function(e,t){function r(){11>s?++s:(++c,s=0)}var o,n=e.getDate(),a=e.getMonth(),i=e.getFullYear(),l=n,s=a,c=i;if(2>=t)o={begin:b(e),end:b(e)},T(o.end,1===t?1:7);else{switch(t){case 3:10>=n?(n=1,l=11):20>=n?(n=11,l=21):(n=21,r(),l=1);break;case 4:15>=n?(n=1,l=16):(n=16,r(),l=1);break;case 5:n=l=1,r();break;case 6:n=l=1,a-=a%3,s=a,r(),r(),r();break;case 7:n=l=1,a=6>a?0:6,s=6>a?6:0,s||c++;break;case 8:n=l=1,a=s=0,c++}o={begin:new Date(i,a,n),end:new Date(c,s,l)}}return o},o.periodRangeNext=function(e,t){function r(){11>s?++s:(++c,s=0)}var o,n=e.begin.getDate(),a=e.begin.getMonth(),i=e.begin.getFullYear(),l=n,s=a,c=i;if(2>=t)o={begin:b(e.end),end:b(e.end)},T(o.end,1===t?1:7);else{switch(t){case 3:10>=n?(n=11,l=21):20>=n?(n=21,l=1,r()):(n=1,l=11,r(),i=c,a=s);break;case 4:15>=n?(n=16,l=1,r()):(n=1,l=16,r(),i=c,a=s);break;case 5:r(),i=c,a=s,r();break;case 6:r(),r(),r(),i=c,a=s,n=l,r(),r(),r();break;case 7:a?(a=0,i++,s=6):(a=6,s=0),c++;break;case 8:i++,c++,c++}o={begin:new Date(i,a,n),end:new Date(c,s,l)}}return o},o.confirmBooleanValue=function(e){if(e.constructor===Boolean.prototype.constructor)return e;if("string"==typeof e){if(e.toLowerCase(),"TRUE"===e||"true"===e)return!0;e=parseInt(e)}return!!e},o.ensureNameText=function(e){return/^[A-Za-z_\u0100-\uffff][\w\u0100-\uffff]*$/.test(e)||(e="["+e+"]"),e},o.enumName2Value=function(t,r){var o=t[r];return o!==e?o:-1}),y=o.enumValue2Name=function(e,t){for(var r in e)if(e[r]===t)return r;return""},S=function(e,t){var r,o,n,a=0;for(t=t.substring(1,t.length-1),r=t.split("|"),n=r.length,o=0;n>o;o++)a+=e[r[o]]||0;return a},F=o.rgba2color=function(e,t,r,o){return w(e|t<<8|r<<16,o)},w=o.colorAlpha=function(e,t){return e|Math.max(0,Math.min(Math.round(255*t)))<<24},D=o.color2rgba=function(e){return{r:255&e,g:e>>8&255,b:e>>16&255,a:4278190080&e?(e>>24&255)/255:1}},P=o.colorValue2Html=function(e){function t(e){return(16>e?"0":"")+e.toString(16)}var r=D(e);return 1===r.a?"#"+t(r.r)+t(r.g)+t(r.b):"rgba("+r.r+","+r.g+","+r.b+","+m(r.a)+")"},R=o.colorIsBlack=function(e){return 16777215&e},B=(o.decodeTextColor=function(e){var t,r,o,n,a,i=4;return"rgb("===e.substr(0,4)&&(t=e.indexOf(")",i),-1!==t&&(e=e.substring(4,t),r=e.split(","),3===r.length&&(o=parseInt(r[0]),n=parseInt(r[1]),a=parseInt(r[2]),o>=0&&255>=o&&n>=0&&255>=n&&a>=0&&255>=a)))?{color:rgb(o,n,a),index:t+1}:!1},o.colorGradientLight=function(e){var t=D(e),r=120/255;return t.r+=(255-t.r)*r,t.g+=(255-t.g)*r,t.b+=(255-t.b)*r,t.r>255&&(t.r=255),t.g>255&&(t.g=255),t.b>255&&(t.b=255),F(t.r,t.g,t.b,t.a)},o.colorGradientDark=function(e){var t=D(e),r=30/255;return t.r-=t.r*r,t.g-=t.g*r,t.b-=t.b*r,t.r<0&&(t.r=0),t.g<0&&(t.g=0),t.b<0&&(t.b=0),F(t.r,t.g,t.b,t.a)},o.prototypeLinkExtend=function(e,t){function r(){}var o,n=e.prototype;r.prototype=t.prototype,o=new r;for(var a in n)o[a]=n[a];e.prototype=o,e.prototype.constructor=e},o.prototypeCopyExtend=function(e,t){var r=t.prototype,o=e.prototype;for(var n in r)o.hasOwnProperty(n)||(o[n]=r[n])},o.createArray=function(e,t){for(var r=[],o=0;o++<e;)r.push(t);return r},o.assignObjectEx=function(e,t,r){var o,n;for(var a in t)t.hasOwnProperty(a)&&(o=t[a],n=typeof o,r&&"object"===n?(e[a]||(e[a]={}),A(e[a],o)):e[a]=o);return e}),A=o.assignObject=function(e,t){B(e,t,1)},E=(o.assignObjectAtom=function(e,t){var r;for(var o in t)t.hasOwnProperty(o)&&(r=t[o],"object"!=typeof r&&(e[o]=r));return e},o.compareObject=function(e,t){var r;if(e===t)return 1;if(!e||!t)return 0;for(var o in e)if(r=typeof e[o],"object"===r){if(!E(e[o],t[o]))return 0}else if("function"!==r&&e[o]!==t[o])return 0;return 1}),N=(o.parseXML=function(t){function r(){for(var e,r=0,o=t.indexOf("<",r),n=[];o>=0;)o>r&&(e=t.substring(r,o),/\S/g.test(e)&&n.push(e)),r=o,o=t.indexOf(">",r+1),n.push(t.substring(r,++o)),r=o,o=t.indexOf("<",r);return n}var o;/\s/g.test(t)&&(t=r().join(""));try{o=(new DOMParser).parseFromString(t,"text/xml")}catch(n){o=e}return o},o.xmlToReportDataJSON=function(e){var t,r,o,n,a="",i={};for(o=e.childNodes[0].firstChild;o;){for(o.nodeName!==a&&(a=o.nodeName,r=[],i[o.nodeName]=r),t={},n=o.firstChild;n;)t[n.nodeName]=n.hasOwnProperty("text")?n.text:n.textContent,n=n.nextSibling;r.push(t),o=o.nextSibling}return i},o.getRelativePosition=function(e){var t,r,o=e.originalEvent||e,n=e.currentTarget||e.srcElement,a=n.getBoundingClientRect();return o.touches?(t=o.touches[0].clientX-a.left,r=o.touches[0].clientY-a.top):(t=o.clientX-a.left,r=o.clientY-a.top),{x:t,y:r}},o.addEvent=function(e,t,r){e.addEventListener?e.addEventListener(t,r):e.attachEvent?e.attachEvent("on"+t,r):e["on"+t]=r}),V=o.removeEvent=function(e,t,r){e.removeEventListener?e.removeEventListener(t,r,!1):e.detachEvent?e.detachEvent("on"+t,r):e["on"+t]=noop},M=(o.bindEvents=function(e,t,r){e.events||(e.events={}),t.forEach(function(t){e.events[t]=function(){r.apply(e,arguments)},N(e.canvas,t,e.events[t])})},o.unbindEvents=function(e,t){t.forEach(function(t,r){V(e.canvas,r,t)})},o.toRadians=function(e){return e*(Math.PI/180)});o.toDegree=function(e){return 180*e/Math.PI},o.getDomEventCSSName=function(e){return"_grec"+e};n.DateTime=function(){this.value=new Date},n.DateTime.prototype={get Year(){return this.value.getFullYear()},get Month(){return this.value.getMonth()+1},get Day(){return this.value.getDate()},get Hour(){return this.value.getHours()},get Minute(){return this.value.getMinutes()},get Second(){return this.value.getSeconds()},get DayOfWeek(){return this.value.getDay()},get DayOfYear(){var e=this.value,t=e.getFullYear();return(new Date(t,e.getMonth(),e.getDate()).getTime()-new Date(t,0,1).getTime())/a+1},get AsFloat(){return(this.value.getTime()+new Date(1970,0,1).getTime()-new Date(1899,11,30).getTime()-i)/a},set AsFloat(e){this.value.setTime(e*a+new Date(1899,11,30).getTime()-new Date(1970,0,1).getTime()+i)},ValueFromDate:function(e,t,r){this.value=new Date(e,t-1,r)},ValueFromDateTime:function(e,t,r,o,n,a){this.value=new Date(e,t-1,r,o,n,a)},Format:function(e){return new gr.format.DateTimeFormatter(e).format(this.value)}};var L=n.DateTime;n.Rect=function(e,t,r,o){var n=this;n.left=e,n.top=t,n.right=r,n.bottom=o},n.Rect.prototype={clone:function(){var e=this;return new n.Rect(e.left,e.top,e.right,e.bottom)},IsRectEmpty:function(){var e=this;return e.left>=e.right||e.top>=e.bottom},PtInRect:function(e,t){var r=this;return r.left<=e&&e<r.right&&r.top<=t&&t<r.bottom},Width:function(){var e=this;return e.right-e.left},Height:function(){var e=this;return e.bottom-e.top},SetRect:function(e,t,r,o){var n=this;n.left=e,n.top=t,n.right=r,n.bottom=o},InflateRect:function(e,t){var r=this;r.left-=e,r.top-=t,r.right+=e,r.bottom+=t},OffsetRect:function(e,t){var r=this;r.left+=e,r.top+=t,r.right+=e,r.bottom+=t}};var I=n.Pen=function(){var e=this;e.Width=1,e.Style=0,e.Color=w(0,1)};I.prototype={clone:function(){var e=this,t=new I;return t.Width=e.Width,t.Style=e.Style,t.Color=e.Color,t},loadFromJSON:function(e,r,o){e&&(c(this,e,o),u(this,"Style",t.PenStyle),h(this,"Color",r))},getDashStyle:function(){var e;switch(this.Style){case 1:e=[2,2];break;case 2:e=[1,1];break;case 3:e=[2,1,1,1];break;case 4:e=[2,1,1,1,1,1];break;default:e=[]}return e}},n.Border=function(e){var t=this;t.Styles=e,t.Shadow=!1,t.ShadowWidth=4,t.ShadowColor=0,t.Pen=new I},n.Border.prototype={loadFromJSON:function(e,r,o){var n=this;e&&(c(n,e,o),d(n,"Styles",t.BorderStyle),h(n,"ShadowColor"),e.Pen&&n.Pen.loadFromJSON(e.Pen,r,o))},getLeftWidth:function(){var e=this;return 1&e.Styles?e.Pen.Width:0},getRightWidth:function(){var e=this;return(4&e.Styles?e.Pen.Width:0)+(e.Shadow?e.ShadowWidth:0)},getTopWidth:function(){var e=this;return 2&e.Styles?e.Pen.Width:0},getBottomWidth:function(){var e=this;return(8&e.Styles?e.Pen.Width:0)+(e.Shadow?e.ShadowWidth:0)}},n.Font=function(){var e=this;e.Size=97500,e.Bold=!1,e.Italic=!1,e.Underline=!1,e.Strikethrough=!1,e.Name=""},n.Font.prototype={loadFromJSON:function(e,t){e&&c(this,e,t)},clone:function(){var e=this,t=new n.Font;return t.Size=e.Size,t.Bold=e.Bold,t.Italic=e.Italic,t.Underline=e.Underline,t.Strikethrough=e.Strikethrough,t.Name=e.Name,t}},n.FontWrapper=function(e){this.parentFont=e},n.FontWrapper.prototype={loadFromJSON:function(e,t){var r=this;e&&(r.prepareModify(),r.font.loadFromJSON(e,t))},assign:function(e){var t=this;e.font?t.font=e.font.clone():delete t.font},prepareModify:function(){var e=this;e.font||(e.font=e.parentFont.UsingFont().clone())},Clone:function(){var e=this,t=new n.FontWrapper(e.parentFont);return t.font=e.UsingFont().clone(),t},UsingFont:function(){var e=this;return e.font?e.font:e.parentFont.UsingFont()},get Name(){return this.UsingFont().Name},set Name(e){var t=this;t.prepareModify(),t.font.Name=e},get Point(){return this.UsingFont().Size/1e4},set Point(e){var t=this;t.prepareModify(),t.font.Size=1e4*e},get Bold(){return this.UsingFont().Bold},set Bold(e){var t=this;t.prepareModify(),t.font.Bold=e},get Italic(){return this.UsingFont().Italic},set Italic(e){var t=this;t.prepareModify(),t.font.Italic=e},get Underline(){return this.UsingFont().Underline},set Underline(e){var t=this;t.prepareModify(),t.font.Underline=e},get Strikethrough(){return this.UsingFont().Strikethrough},set Strikethrough(e){var t=this;t.prepareModify(),t.font.Strikethrough=e}},n.TextFormat=function(){var e=this;e.WordWrap=!1,e.EndEllipsis=!1,e.TextAlign=33,e.CharacterSpacing=0,e.LineSpacing=0,e.FirstCharIndent=0},n.TextFormat.prototype={loadFromJSON:function(e,r){var o=this,n="CharSpacing";e&&(c(o,e,r),r&&(n=l(n)),n=e[n],n&&(o.CharacterSpacing=n),u(o,"TextAlign",t.TextAlign),u(o,"TextOrientation",t.TextOrientation))}},n.Context=function(e){var t=this;t.ctx=e,e.textBaseline="top",t.pens=[new I],t.defaultFillStyles=e.fillStyle,t.fonts=[]},n.Context.prototype={get usingFont(){var e=this.fonts,t=e.length;return e[t-1]},setDefaultFillColor:function(e){var t=this;t.defaultFillStyles=P(e),t.ctx.fillStyle=t.defaultFillStyles},setFillStyle:function(e){this.ctx.fillStyle=e},setFillColor:function(e){this.ctx.fillStyle=P(e)},resetFillStyle:function(){var e=this;e.ctx.fillStyle=e.defaultFillStyles},SelectPen:function(e){var t=this;t.pens.push(e),t._applyPen()},RestorePen:function(){var e=this;e.pens.pop(),e._applyPen()},SelectFont:function(e){var t=this,r=t.fonts,o=r[r.length-1];e!==o&&(t.ctx.font=g(e)),r.push(e)},RestoreFont:function(){var e=this,t=e.fonts,r=t.pop(),o=t[t.length-1];t.length>0?o!==r&&(e.ctx.font=g(o)):e.ctx.font=""},FontSizeChangeTo:function(e){var t=this,r=t.usingFont.clone();r.Size=e,t.SelectFont(r)},FontPointRestore:function(){this.RestoreFont()},measureTextWidth:function(e){return this.ctx.measureText(e).width},drawText:function(e,t,r){this.ctx.fillText(e,t,r)},drawTextCenter:function(e,t,r){var o=this.ctx;o.textAlign="center",o.fillText(e,t,r),o.textAlign="start"},drawText2:function(e,t,r){var o,n=this,a=f(n.usingFont),i=t.left,l=(t.top+t.bottom-a)/2;33!==r&&(o=n.measureTextWidth(e),34===r?(i+=t.right-o,i/=2):i=t.right-o),n.drawText(e,i,l)},drawTextRotate:function(e,t,r,o){var n=this.ctx;n.translate(t,r),n.rotate(M(-o)),this.ctx.fillText(e,0,0),n.setTransform(1,0,0,1,0,0)},drawEqualSpaceText:function(e,t,r,o){for(var n,a,i=this,l=t,s=e.length,c=0,u=(r-t)/s;s>c;)n=t+u*(c+1),a=e.substr(c++,1),i.drawText(a,(n+l-i.measureTextWidth(a))/2,o),l=n},fillRect:function(e,t){var r=this;r.setFillColor(t),r.ctx.fillRect(e.left,e.top,e.Width(),e.Height()),r.resetFillStyle(t)},drawLine:function(e,t,r,o){var n=this.ctx;n.beginPath(),n.moveTo(e,t),n.lineTo(r,o),n.stroke()},drawPolyLine:function(e,t,r){var o=this.ctx,n=0,a=e.length;for(o.beginPath(),o.moveTo(e[n++],e[n++]);a>n;)o.lineTo(e[n++],e[n++]);r&&o.closePath(),o.stroke(),t&&o.fill()},polyBezier:function(e){var t,r=this.ctx,o=e.length;for(r.beginPath(),r.moveTo(e[0].x,e[0].y),t=1;o>t;t++)r.bezierCurveTo(e[t].x,e[t++].y,e[t].x,e[t++].y,e[t].x,e[t].y);r.stroke()},circle:function(e,t,r,o,n){var a=this.ctx,i=(o>r?r:o)/2;e+=r/2,t+=o/2,a.beginPath(),a.arc(e,t,i,0,2*Math.PI),a.stroke(),n&&a.fill()},ellipse:function(e,t,r,o,n){var a=this.ctx,i=r>o?r:o,l=r/i,s=o/i;e+=r/2,t+=o/2,i/=2,a.beginPath(),a.save(),a.scale(l,s),a.arc(e/l,t/s,i,0,2*Math.PI),a.restore(),a.stroke(),n&&a.fill()},rectangle:function(e,t,r,o,n){var a=this;a.ctx.strokeRect(e,t,r,o),n&&a.ctx.fillRect(e,t,r,o)},rectangle2:function(e,t){this.rectangle(e.left,e.top,e.Width(),e.Height(),t)},square:function(e,t,r,o,n){var a=o>r?r:o;e+=(r-a)/2,t+=(o-a)/2,this.rectangle(e,t,a,a,n)},roundRectangle:function(e,t,r,o,n,a,i){var l=this.ctx;l.beginPath(),l.moveTo(e+n,t),l.lineTo(e+r-n,t),l.quadraticCurveTo(e+r,t,e+r,t+a),l.lineTo(e+r,t+o-a),l.quadraticCurveTo(e+r,t+o,e+r-n,t+o),l.lineTo(e+n,t+o),l.quadraticCurveTo(e,t+o,e,t+o-a),l.lineTo(e,t+a),l.quadraticCurveTo(e,t,e+n,t),l.stroke(),i&&l.fill()},roundSquare:function(e,t,r,o,n,a,i){var l=o>r?r:o;e+=(r-l)/2,t+=(o-l)/2,this.roundRectangle(e,t,l,l,n,a,i)},pie:function(e,t,r,o,n){var a=this,i=a.ctx;o=M(o),n=M(n),i.beginPath(),i.moveTo(e,t),i.arc(e,t,r,-o,-n,1),i.closePath(),i.stroke(),i.fill()},drawBar:function(e,t,r,o){var n,a=this,i=a.ctx,l=[{x:e.left,y:e.bottom},{x:e.left,y:e.top},{x:e.right,y:e.top},{x:e.right,y:e.bottom}];a.setFillColor(r),a.SelectPen(t),i.fillRect(e.left,e.top,e.Width(),e.Height()),i.beginPath(),n=l[o],i.moveTo(n.x,n.y),n=l[++o%4],i.lineTo(n.x,n.y),n=l[++o%4],i.lineTo(n.x,n.y),n=l[++o%4],i.lineTo(n.x,n.y),i.stroke(),a.RestorePen(),a.resetFillStyle()},DrawHorzLine:function(e,t,r){this.drawLine(t,e,r,e)},DrawVertLine:function(e,t,r){this.drawLine(e,t,e,r)},DrawPointMarker:function(e,t,r,o){function n(){var r,o=10===t?4:11===t?5:12===t?6:10,n=2*Math.PI/o,a=n/2,i=e.Width()/2,l=i/2,c=e.left+i,u=e.top+i,d=Math.PI/2,h=[];for(r=0;o>r;r++)h.push(c+Math.cos(d)*i,u-Math.sin(d)*i),d+=a,h.push(c+Math.cos(d)*l,u-Math.sin(d)*l),d+=a;s.drawPolyLine(h,1,1)}function a(){var n=r.clone();n.Color=o,s.SelectPen(n),s.drawLine(e.left,e.top,e.right,e.bottom),s.drawLine(e.left,e.bottom,e.right,e.top),9===t&&(i=(e.left+e.right)/2,s.drawLine(i,e.top,i,e.bottom),l=(e.top+e.bottom)/2,s.drawLine(e.left,l,e.right,l)),s.RestorePen()}var i,l,s=this,c=e.Width(),u=Math.min(4,(c-4)/2);switch(s.setFillColor(o),s.SelectPen(r),t){case 3:case 4:case 5:s.ellipse(e.left,e.top,e.Width(),e.Height(),1),4===t?s.circle((e.left+e.right)/2-1,(e.top+e.bottom)/2-1,2,2,0):5===t&&(c=Math.min(4,c/3),s.drawLine(e.left+c,e.top+c,e.right-c,e.bottom-c),s.drawLine(e.right-c,e.top+c,e.left+c,e.bottom-c));break;case 0:case 1:case 2:s.rectangle(e.left,e.top,e.Width(),e.Height(),1),1===t?s.drawPolyLine([e.left+u,e.top+c/2,e.left+c/2,e.bottom-u,e.right-u,e.top+u]):2===t&&(s.drawLine(e.left+u,e.top+u,e.right-u,e.bottom-u),s.drawLine(e.right-u,e.top+u,e.left+u,e.bottom-u));break;case 8:case 9:a();break;case 6:s.drawPolyLine([(e.left+e.right)/2,e.top,e.left,(e.top+e.bottom)/2,(e.left+e.right)/2,e.bottom,e.right,(e.top+e.bottom)/2],1,1);break;case 7:s.drawPolyLine([(e.left+e.right)/2,e.top,e.left,e.bottom,e.right,e.bottom],1,1);break;case 10:case 11:case 12:case 13:n()}s.RestorePen(),s.resetFillStyle()},_applyPen:function(){var e=this,t=e.pens[e.pens.length-1];e.ctx.lineWidth=t.Width,e.ctx.strokeStyle=P(t.Color),e.ctx.setLineDash(t.getDashStyle())}},n.HtmlStyles=function(){this.items=[]},n.HtmlStyles.prototype={add:function(e,t){this.items.push({name:e,value:t})},addBackColor:function(e){this.add("background-color",P(e))},addCellBorder:function(e){var t=this;e.ShowColLine&&e.ShowRowLine&&E(e.ColLinePen,e.RowLinePen)?t.add("border",p(e.ColLinePen)):(e.ShowRowLine&&t.add("border-bottom",p(e.ColLinePen)),e.ShowColLine&&t.add("border-right",p(e.RowLinePen)))},addObjectPadding:function(e){var t=e.padding,r="";return t.Right===t.Left&&t.Top===t.Bottom?(t.Right!==t.Top&&(r=C(t.Top)+" "),r+=C(t.Right)):r=C(t.Top)+" "+C(t.Right)+" "+C(t.Bottom)+" "+C(t.Left),this.add("padding",r)},addBorder:function(e){var t,r=this;e.Styles&&(t=p(e.Pen),15===e.Styles?r.add("border",t):(1&e.Styles&&r.add("border-left",t),4&e.Styles&&r.add("border-right",t),2&e.Styles&&r.add("border-top",t),8&e.Styles&&r.add("border-bottom",t))),e.Shadow&&(t=C(e.ShadowWidth)+" ",r.add("box-shadow",t+t+P(e.ShadowColor)))},addTextFormat:function(e,t){var r=this,o="text-align",n=e.WordWrap;1&e.TextAlign?r.add(o,"left"):2&e.TextAlign?r.add(o,"center"):4&e.TextAlign?r.add(o,"right"):r.add(o,"justify"),t&&(o="vertical-align",16&e.TextAlign?r.add(o,"top"):32&e.TextAlign?r.add(o,"middle"):r.add(o,"bottom")),e.EndEllipsis&&(r.add("text-overflow","ellipsis"),n=!1),n?r.add("white-space","normal"):(r.add("overflow","hidden"),r.add("white-space","nowrap")),e.CharacterSpacing&&r.add("letter-spacing",C(e.CharacterSpacing)),e.FirstCharIndent&&r.add("text-indent",C(e.FirstCharIndent)),R(e.ForeColor)&&r.add("color",P(e.ForeColor))},getText:function(){var e="";return this.items.forEach(function(t){e+=t.name+":"+t.value+";"}),e},clear:function(){this.items=[]}};var O=n.HtmlStyles;n.HtmlElement=function(e,t){var r=this;r.tag=e,r.classes=[],t.addChild(this)},n.HtmlElement.prototype={getStyles:function(){var e=this;return e._styles||(e._styles=new O),e._styles},addClass:function(e){this.classes.push(e)},addStyle:function(e,t){var r=this;r._styles||(r._styles=new O),r._styles.add(e,t)},addBackColorStyle:function(e){this.addStyle("background-color",P(e))},addAttribute:function(e,t){var r=this;r._attributes||(r._attributes=[]),r._attributes.push({name:e,value:t})},addChild:function(e){var t=this;t.children||(t.children=[]),t.children.push(e)},beginText:function(){var e=this,t="\r\n<"+e.tag;return e.classes.length>0&&(t+=' class="',e.classes.forEach(function(e,r){r>0&&(t+=" "),t+=e}),t+='"'),e._styles&&(t+=' style="'+e._styles.getText()+'"'),e._attributes&&e._attributes.forEach(function(e){t+=" "+e.name+'="'+e.value+'"'}),e.skipend&&(t+="/"),t+=">"},endText:function(){var e=this;return e.skipend?"":"</"+e.tag+">"}}}(),function(e){"use strict";var t=(gr.enum_,gr.const_),r=gr.common,o=gr.locale,n=gr.helper,a=r.DateTime,i=n.intFixed,l=n.confirmDateValue,s=n.confirmBooleanValue,c=n.rgba2color,u=n.color2rgba,d=n.decodeTextColor,h=gr.format={};h.BooleanFormatter=function(e){this.parse(e)},h.BooleanFormatter.prototype={parse:function(e){var t,r=this;e?(t=e.indexOf(":"),-1===t?(r.trueValueText=e,r.falseValueText=""):(r.trueValueText=e.substr(0,t),r.falseValueText=e.substr(t+1))):(r.trueValueText="true",
r.falseValueText="false")},format:function(e){var t=this;return e=s(e),e?t.trueValueText:t.falseValueText}};var p=function(){this.defaultMe()};p.prototype={defaultMe:function(){var e=this;e.precision=9,e.leastPrecision=0,e.leastIntegerWidth=1,e.showPositive=!1,e.showNegative=!0,e.showSymbolAtHead=!0,e.negativeBracket=!1,e.intSepStep=0,e.asPercent=!1,e.asCurrency=!1,e.blankSepSymbol=!1,e.firstCurrencySymbol=!0,e.exponent=!1,e.textColor=0,e.prefix="",e.suffix=""},isCustomTextColor:function(){return 0!==this.textColor},parse:function(e){function t(e){return-1!=="0#.,+-()$%".indexOf(e)}var r,o,n,a,i,l=this;if(l.defaultMe(),e){if(r=d(e),r&&(e=e.substr(r.index),l.textColor=r.color),i=e.length,l.exponent="e"===e.charAt(0),!l.exponent){for(o=0;i>o&&!t(e.charAt(o));)++o;if(o>0&&(l.prefix=e.substr(0,o),e=e.substr(o),i=e.length),i>o){for(o=i-1;!t(e.charAt(o))&&o>0;)--o;i-1>o&&(l.suffix=e.substr(o+1),e=e.substr(0,o+1),i=e.length)}}for(a=e.indexOf("."),-1===a&&(a=i),o=e.indexOf(","),o>=0&&(l.intSepStep=a-o-1,l.intSepStep<0&&(l.intSepStep=3)),l.negativeBracket=e.indexOf("(")>=0&&e.indexOf(")")>=0,l.asPercent=e.indexOf("%")>=0,l.blankSepSymbol=e.indexOf(" ")>=0,o=e.indexOf("+"),l.showPositive=o>=0,n=e.indexOf("-"),l.showNegative=n>=0||!l.negativeBracket&&!l.isCustomTextColor(),n>o&&(o=n),n=e.indexOf("$"),l.asCurrency=n>=0,n>o&&(o=n),l.showSymbolAtHead=-1===o||a>o,l.asCurrency&&(l.negativeBracket?(o=e.indexOf(l.showSymbolAtHead?"(":")"),l.firstCurrencySymbol=o>n):l.firstCurrencySymbol=o>=n),l.leastIntegerWidth=0,o=0;a>o;++o)"0"===e.charAt(o)&&++l.leastIntegerWidth;for(l.leastPrecision=0,l.precision=0,o=a+1;i>o;++o)"0"===e.charAt(o)?(++l.leastPrecision,++l.precision):"#"===e.charAt(o)&&++l.precision}},format:function(e){var t,r,n,a,i,l,s,c,d,h,p,f=this,g="";if(e=+e,f.isCustomTextColor()&&(t=u(f.textColor),g="[_color#=rgb("+t.r+","+t.g+","+t.b+")]"),f.asPercent&&(e*=100),f.exponent){if(r=e,0>r&&(r=-r),n=0,0!==r){for(;r>=10;)r/=10,++n;for(;1>r;)r*=10,--n}return f.exponent=!1,0>e&&(r=-r),g+=f.format(r),g+="e",n>=0?g+="+":(g+="-",n=-n),g+=n,f.exponent=!0,g}if(p=e.toFixed(f.precision),h=p.length,f.precision>f.leastPrecision){for(a=h-1,i=a-f.precision+f.leastPrecision;a>i&&"0"===p.charAt(a);a--);"."!==p.charAt(a)&&a++,a<p.length&&(p=p.substr(0,a),h=a)}if(l=p.indexOf("."),0>l&&(l=h),g+=f.prefix,f.showSymbolAtHead?(f.asCurrency&&f.firstCurrencySymbol&&(g+=o.currencySymbol),0>e?f.negativeBracket&&(g+="("):f.showPositive&&e>0&&(g+="+"),f.asCurrency&&!f.firstCurrencySymbol&&(g+=o.currencySymbol),f.blankSepSymbol&&(g+=" ")):f.negativeBracket&&0>e&&(g+="("),a=0,s=l,0>e&&(--s,++a,f.showNegative&&(g+="-")),c=f.leastIntegerWidth-s,d=s,c>0)for(d+=c;d>s;)g+="0",d--,f.intSepStep>0&&d%f.intSepStep===0&&(g+=o.thousandSep);else for(;c++<0&&"0"===p.charAt(a);)a++;if(f.intSepStep>0)for(;d>0;)g+=p.charAt(a++),--d%f.intSepStep===0&&0!==d&&(g+=o.thousandSep);else g+=p.substring(a,l);return h>l&&(g+=p.substr(l)),f.showSymbolAtHead?f.negativeBracket&&0>e&&(g+=")"):(f.blankSepSymbol&&(g+=" "),f.asCurrency&&f.firstCurrencySymbol&&(g+=o.currencySymbol),0>e?g+=f.negativeBracket?")":"-":f.showPositive&&e>0&&(g+="+"),f.asCurrency&&!f.firstCurrencySymbol&&(g+=o.currencySymbol)),f.asPercent&&(g+="%"),g+=f.suffix}};var f=function(e){e=e.substring(1,e.length-1);for(var t=e.split(","),r=0;r<t.length;r++){var o=t[r],n=o.indexOf("=");this[o.substr(0,n)]=o.substr(n+1)}};f.prototype={format:function(t){var r=this[t];return r===e&&(r=""),r}};var g="$$",m="$$$";h.NumericFormatter=function(e){this.parse(e)},h.NumericFormatter.prototype={defaultMe:function(){var t=this;t.formatType=0,t.positiveAnalyser=new p,t.negativeAnalyser&&(t.negativeAnalyser=e),t.zeroAnalyser&&(t.zeroAnalyser=e),t.intEnumAnalyser&&(t.intEnumAnalyser=e)},parse:function(e){function t(e){var t,r;t=e.split(";"),r=t.length,o.positiveAnalyser.parse(t[0]),r>1&&""!==t[1]&&(o.negativeAnalyser=new p,o.negativeAnalyser.parse(t[1])),r>2&&""!==t[2]&&(o.zeroAnalyser=new p,o.zeroAnalyser.parse(t[2]))}var r,o=this;if(o.defaultMe(),e){var n=e.length;e&&(r=e.indexOf(m),-1!==r?(o.formatType=1,e=e.substr(0,r)+e.substr(r+m.length),""!==e&&t(e)):n>=2&&e.substr(0,2)===g?2===n?o.formatType=2:(o.formatType=3,t(e.substr(2))):"{"===e.charAt(0)&&"}"===e.charAt(n-1)?(o.formatType=4,o.intEnumAnalyser=new f(e)):t(e))}},format:function(r){function o(e,r){var o,n,a=!1,i=!1,l=0,s="";for(o=r-1;o>=0;o--,l++)n=parseInt(e.charAt(o)),l%4===0&&l>0&&(a=!0),0===n?i=!0:(i&&(""!==s&&(s=t.BIG_AMT_NUMBER.charAt(0)+s),i=!1),l>0&&(a&&l%4!==0&&(s=t.HZ_AMT_STEP.charAt(l-l%4)+s),a=!1,s=t.HZ_AMT_STEP.charAt(l)+s),s=t.BIG_AMT_NUMBER.charAt(n)+s);return s}function n(e){var r,o,n="",a=e.length;for(o=0;a>o;o++)r=parseInt(e.charAt(o)),isNaN(r)||(n+=t.BIG_AMT_NUMBER.charAt(r));return n}function a(e){var r,n,a,i,l,s=0>=e;return e>-.005&&.005>e?t.HZ_ZERO_YUAN:(s&&(e=-e),i=e.toFixed(2),r=i.indexOf("."),l=o(i,r),""!==l&&(l+=t.HZ_AMT_STEP.charAt(0)),n=parseInt(i.charAt(r+1)),a=parseInt(i.charAt(r+2)),0===n&&0===a?l+=t.HZ_AMT_UNIT[0]:(0===n&&""===l||(l+=t.BIG_AMT_NUMBER.charAt(n)),0!==n&&(l+=t.HZ_AMT_UNIT.charAt(1)),0!==a?(l+=t.BIG_AMT_NUMBER.charAt(a),l+=t.HZ_AMT_UNIT.charAt(2)):l+=t.HZ_AMT_UNIT.charAt(0)),s&&(l=t.HZ_NEGATIVE+l),l)}function i(e,r){var n,a,i,l,s=Math.max(0,r.precision),c=Math.min(s,r.leastPrecision),u=-.5*Math.pow(.1,s),d=u>=e;for(0>e&&(e=-e),i=e.toFixed(s),n=i.length,a=i.indexOf("."),-1===a&&(a=n),l=o(i,a),""===l&&(l=t.BIG_AMT_NUMBER.charAt(0)),n--;n>a+c&&"0"===i.charAt(n);n--);if(n>a)for(l+="点",a++;n>=a;a++)l+=t.BIG_AMT_NUMBER.charAt(parseInt(i.charAt(a)));return d&&(l=t.HZ_NEGATIVE+l),""!==r.prefix&&(l=r.prefix+l),""!==r.suffix&&(l+=r.suffix),l}var l,s=this;if(r=+r,isNaN(r))l="";else if(s.formatType<=1){if(s.zeroAnalyser&&r>-.5&&.5>r){var c=s.positiveAnalyser.precision;s.positiveAnalyser.asPercent&&(c+=2);var u=c;s.negativeAnalyser&&(u=s.negativeAnalyser.precision,s.negativeAnalyser.asPercent&&(u+=2));var d=Math.pow(.1,u)*-.5,h=.5*Math.pow(.1,c);r>d&&h>r&&(l=s.zeroAnalyser.format(0))}l===e&&(l=s.negativeAnalyser&&0>r?s.negativeAnalyser.format(r):s.positiveAnalyser.format(r)),1===s.formatType&&(l=n(l))}else l=4===s.formatType?s.intEnumAnalyser.format(r):2===s.formatType?a(r):i(r,s.positiveAnalyser);return l}},h.DateTimeFormatter=function(e){this.parse(e)},h.DateTimeFormatter.prototype={parse:function(r){function n(){for(w=1;D[F+1]===P;)F++,w++}function a(){var e=w;w%=2,e=(e-w)/2,e>0&&l(e)}function l(e){var t="",r=A.length;do t+=P;while(--e>0);r>0&&15===A[r-1].type?A[r-1].data+=t:A.push({type:15,data:t,funDisplayText:v})}function s(e,t){return i(e.getFullYear(),t.subtype)}function c(r,n){var a=r.getMonth();return n.subtype<=4?i(a+1,n.subtype):o.supportIntl?5===n.subtype?new Intl.DateTimeFormat(e,{month:"short"}).format(r):new Intl.DateTimeFormat(e,{month:"long"}).format(r):10>a?t.HZ_NUMBER.charAt(a):t.HZ_NUMBER.charAt(9)+t.HZ_NUMBER.charAt(a-10)+t.HZ_DATETIME_UNIT.charAt(5)}function u(e,t){return i(e.getDate(),t.subtype)}function d(r,n){var a;return o.supportIntl?5===n.subtype?new Intl.DateTimeFormat(e,{weekday:"short"}).format(r):new Intl.DateTimeFormat(e,{weekday:"long"}).format(r):(a=r.getDay(),(5===n.subtype?t.HZ_DATETIME_UNIT.substr(0,1):t.HZ_DATETIME_UNIT.substring(2,4))+(a>0?t.HZ_NUMBER.charAt(a-1):t.HZ_DATETIME_UNIT.charAt(1)))}function h(e,t){var r=e.getHours()%12;return r||(r=12),i(r,t.subtype)}function p(e,t){return i(e.getHours(),t.subtype)}function f(e,t){return i(e.getMinutes(),t.subtype)}function g(e,t){return i(e.getSeconds(),t.subtype)}function m(e,t){return e.toLocaleDateString()}function C(e,t){return e.toLocaleTimeString()}function b(e,t){return e.toLocaleString()}function v(e,t){return t.data}function T(e,t){return e.getHours()<12?o.textAM:o.textPM}function x(e,t){return o.dateSep}function y(e,t){return o.timeSep}var S,F,w,D,P,R,B,A=this.items=[];if(r){D=r.split(""),S=D.length,F=0;do{switch(P=D[F],n(),B={},P){case"d":3>w?(B.type=3,B.funDisplayText=u,B.subtype=1===w?0:2):(B.type=4,B.funDisplayText=d,B.subtype=3===w?5:6);break;case"M":B.type=2,B.funDisplayText=c,1===w?B.subtype=0:2===w?B.subtype=2:3===w?B.subtype=5:B.subtype=6;break;case"y":B.type=1,B.funDisplayText=s,B.subtype=3>w?2:0;break;case"h":B.type=5,B.funDisplayText=h,B.subtype=1===w?0:2;break;case"H":B.type=6,B.funDisplayText=p,B.subtype=1===w?0:2;break;case"m":B.type=7,B.funDisplayText=f,B.subtype=1===w?0:2;break;case"s":B.type=8,B.funDisplayText=g,B.subtype=1===w?0:2;break;case"t":2===w&&(B.type=20,B.funDisplayText=T);break;case"%":a(),w&&(R=D[F+1],++F,"d"===R?(B.type=10,B.funDisplayText=m):"t"===R?(B.type=11,B.funDisplayText=C):"g"===R?(B.type=12,B.funDisplayText=b):F--);break;case":":a(),w&&(B.type=22,B.funDisplayText=y);break;case"/":a(),w&&(B.type=21,B.funDisplayText=x);break;default:l(w)}B.type&&15!==B.type&&A.push(B)}while(++F<S)}else A.push({type:12,funDisplayText:b})},format:function(t){var r="";return t!==e&&(t=l(t),this.items.forEach(function(e){r+=e.funDisplayText(t,e)})),r}};var C=gr.utility={CreateDateTime:function(){return new a},DateTimeFormat:function(e,t){return new h.DateTimeFormatter(t).format(l(e))},NumberFormat:function(e,t){return new h.NumericFormatter(t).format(e)},NumberFormatToBigHZ:function(e,t){var r,o="$$0";if(t>0)for(o+=".",r=0;t>r;r++)o+="0";return C.NumberFormat(e,o)},NumberFormatToBigHZAmount:function(e){return C.NumberFormat(e,"$$")},NumberRound45:function(e,t){var r=Math.pow(10,t);return Math.round(e*r)/r},NumberRound465:function(e,t){var r,o,n,a=Math.pow(10,t+2);return e=Math.floor(e*a),r=e%10,o=e%100-r,e-=o+r,o>=60?e+=100:50===o&&(r>0?e+=100:(n=e%1e3/100,n%2&&(e+=100))),e/a},ColorFromRGB:function(t,r,o,n){return n===e&&(n=1),c(t,r,o,n)}}}(),function(e){"use strict";var t=gr.enum_,r=gr.helper,o=gr.format,n=gr.utility,a=r.ensureNameText,i=r.enumName2Value,l=r.enumValue2Name,s=r.prototypeCopyExtend,c=gr.exp={},u="[#",d="#]",h=2,p=c.Summary=function(){};p.prototype={init:function(e,t){var r=this;switch(e&&(r.paramExp=new x(r.report,e)),t&&(r.displayField=r.report.RunningFieldByName(t)),r.SummaryFun){case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 15:case 16:case 17:case 20:case 21:case 22:case 23:case 24:case 25:case 14:case 18:case 19:r.values=[]}},getAsFloat:function(){var e=this;return e.valueField?e.valueField.AsFloat:e.value},getValue:function(){return this.getAsFloat()},setValue:function(e){var t=this;t.valueField?t.valueField.AsFloat=e:t.value=e},getDisplayText:function(){return this.getValue()+""},isDateTimeValue:function(){var e=this;return e.argExp&&e.argExp.isSingleVariable()&&e.argExp.varItems[0].varField.isDateTimeValue()},beginSummaryValue:function(){var t=this;t.recordCount=0,4===t.SummaryFun||5===t.SummaryFun?t.value=e:27!==t.SummaryFun&&28!==t.SummaryFun&&(t.value=0),t.values&&(t.values=[])},summaryCurRecord:function(){var t=this,r=t.values,o=t.SummaryFun,n=t.paramExp,a=n?n.calculate():0;switch(++t.recordCount,o){case 1:case 2:case 27:case 28:isNaN(a)||(t.value+=a);break;case 4:case 5:n&&!n.isNull()&&(t.value===e?t.value=a:(5===o&&t.value<a||4===o&&t.value>a)&&(t.value=a,t.displayField&&(t.stringValue=t.displayField.DisplayText)));break;case 6:case 7:case 8:case 9:case 10:case 11:r.push_back(a);break;case 12:case 13:n&&n.isNull()&&(t.value+=1);break;case 16:case 17:case 15:case 20:case 21:case 22:case 23:case 24:case 25:n&&!n.isNull()&&r.push(a);break;case 14:n&&r.push(n.getTextForDistinct());break;case 19:case 18:n&&(a=n.getTextForDistinct(),0===t.value?t.value=a:(19===o&&t.value.localeCompare(a)<0||18===o&&t.value.localeCompare(a)>0)&&(t.value=a));break;case 26:t.value+=Math.abs(t.Calculate())}},endSummaryValue:function(){var t=this,r=t.values?t.values.length:0;switch(t.SummaryFun){case 2:t.recordCount>0?t.value/=t.recordCount:t.value=e;break;case 3:t.value=t.recordCount;break;case 6:case 20:t.value=r>1?t.devSq()/(r-1):e;break;case 7:case 21:t.value=r>1?t.devSq()/r:e;break;case 8:case 22:t.value=r>1?Math.sqrt(t.devSq()/(r-1)):e;break;case 9:case 23:t.value=r>1?Math.sqrt(t.devSq()/r):e;break;case 10:case 24:t.value=t.aveDev();break;case 11:case 25:t.value=t.devSq();break;case 16:case 17:if(t.values.sort(function(e,t){return e-t}),r<t.rankNo)return e;t.value=t.values[17===t.SummaryFun?r-t.rankNo:t.rankNo];break;case 13:t.value=t.recordCount-t.value;break;case 15:t.value=t.average();break;case 14:t.value=t.distinct()}},average:function(){var t=this,r=t.values.length,o=0;return t.values.forEach(function(e){o+=e}),r?o/r:e},aveDev:function(){var t=this,r=t.values.length,o=average(),n=0;return t.values.forEach(function(e){n+=Math.abs(e-o)}),r?n/r:e},devSq:function(){var e=(average(),0);return this.values.forEach(function(t){var r=t-ave;e+=r*r}),e},distinct:function(){var e,t,r=1,o=self.values.length,n=o;for(self.values.sort(function(e,t){return e.localeCompare(t)}),e=self.values[0];o>r;)t=self.values[r++],e===t?n--:e=t;return n}};var f=function(e,r,o){var n,a=this,l=o.split(",");a.report=e,a.SummaryFun=i(t.SummaryFun,r),l.length>0&&(n=l[0]),l.length>1&&(a.RankNo=parseInt(l[1])),a.init(n)};f.prototype={type:4,getExpText:function(){var e=this;return l(t.SummaryFun,e.SummaryFun)+"("+e.paramExp?e.paramExp.getExpText():""+e.RankNo?","+e.RankNo:")"}},s(f,p);var g=function(e,r){var o=this,n=r.split(",");o["var"]=i(t.SystemVarType,n[0]),n.length>1&&(o.groupIndex=parseInt(n[1])),o.report=e};g.prototype={type:3,getAsFloat:function(){var e=this;return e.report.SystemVarValue2(e["var"],e.groupIndex)},getValue:function(){return this.getAsFloat()},getDisplayText:function(){return this.getAsFloat()+""},getExpText:function(){var e=this;return"SystemVar("+l(t.SystemVarType,e["var"])+e.groupIndex?","+e.groupIndex:")"},isDateTimeValue:function(){return 1===this["var"]}};var m=function(e){this.oParameter=e};m.prototype={type:2,getAsFloat:function(){return this.oParameter.AsFloat},getValue:function(){return this.oParameter.Value},getDisplayText:function(){var e=this;return e.valueField?e.valueField.DisplayText:e.oParameter.DisplayText},getExpText:function(){return a(this.oParameter.Name)},isDateTimeValue:function(){return 6===this.oParameter.DataType}};var C=function(e){this.object=e};C.prototype={type:1,getAsFloat:function(){return this.object.AsFloat},getValue:function(){return this.object.Value},getDisplayText:function(){return this.object.DisplayText},getExpText:function(){return a(this.object.Name)},isDateTimeValue:function(){return 6===this.object.FieldType}};var b=function(e){this.object=e};b.prototype={type:5,getAsFloat:function(){return parseFloat(this.object.DisplayText)},getValue:function(){return this.getDisplayText()},getDisplayText:function(){return this.object.DisplayText},getExpText:function(){return a(this.object.Name)},isDateTimeValue:function(){return t0}};var v=function(e,t,r){var o=this;o.varField=e,o.beginIndex=t,o.endIndex=r},T=function(e,t){function r(){for(c=u[n];C.test(c);)c=u[++n]}function o(e,r){var o=c===e;return o&&(n=t.indexOf(r,a),-1===n?m=!1:(d=t.substring(a+1,n),i=++n)),o}var n,a,i,l,s,c,u,d,h,p,f,g=this,m=!0,C=/\s/,b=/[\d.]/,T=/[()+-\/%*]/,x=/[()+-\/%*\s]/;for(u=t.split(""),s=u.length,g.expText=t,g.varItems=[],n=0;s>n&&m;)if(r(),T.test(c)||b.test(c))n++;else{if(a=n,o("{","}"))p=g.decodeVariable(e,d,1);else{if(!o("[","]")){for(;s>n&&!x.test(u[n]);)n++;i=n,d=t.substring(a,i)}if(r(),"("===c){for(l=++n,f=1;s>n;)if(c=u[n++],")"===c){if(f--,0>=f)break}else"("===c&&f++;h=t.substring(l,n-1),i=n,p=g.decodeFunction(e,d,h)}else p=g.decodeVariable(e,d,0)}p?g.varItems.push(new v(p,a,i)):m=!1}g.valid=m};T.prototype={calculate:function(){var e=this,t=0,r="",o=NaN;return e.valid&&(e.varItems.forEach(function(o){t<o.beginIndex&&(r+=e.expText.substring(t,o.beginIndex)),t=o.endIndex,r+=o.varField.getAsFloat()+""}),r+=e.expText.substr(t),o=gr.script.calcExp(r),(o>=Number.POSITIVE_INFINITY||o<=Number.NEGATIVE_INFINITY)&&(o=NaN)),o},isSingleVariable:function(){var e=this;return 1===e.varItems.length&&0===e.varItems[0].beginIndex&&e.varItems[0].endIndex===e.expText.length}};var x=c.Expression=function(e,t){T.call(this,e,t)};x.prototype={decodeVariable:function(t,r,o){var n,a=e;return o?(n=t.ParameterByName(r))&&(a=new m(n)):(n=t.RunningFieldByName(r))?a=new C(n):(n=t.ParameterByName(r))?a=new m(n):(n=t.ControlByName(r))&&(a=new b(n)),a},decodeFunction:function(t,r,o){var n=new f(t,r,o);return n.SummaryFun<0&&("SystemVar"===r?(n=new g(t,o),n["var"]<0&&(n=e)):n=e),n},getExpText:function(){var e=this,t=0,r="";return e.varItems.forEach(function(o){t<o.beginIndex&&(r+=e.expText.substring(t,o.beginIndex)),t=o.endIndex,r+=o.varField.getExpText()}),r+=e.expText.substr(t)},getTextForDistinct:function(){var e=this;return e.isSingleVariable()?e.varItems[0].varField.getDisplayText():e.calculate()+""},isNull:function(){return this.varItems.some(function(e){return e.IsNull})}},s(x,T);var y=function(e,t){var r,n,a,i=this,l=0,s="";for(r=t.indexOf(":");r>=0&&(n=t.indexOf("[",l),!(-1===n||n>r))&&(n=t.indexOf("]",r),-1!==n);)l=n+1,r=t.indexOf(":",l);r>=0&&(s=t.substr(r+1),t=t.substr(0,r)),T.call(i,e,t),!s&&i.isSingleVariable()||(a=i.isSingleVariable()&&i.varItems[0].varField.isDateTimeValue(),!a&&s&&(a=/[yMdthHms]/.test(s)&&!/[0#e$]/.test(s)),i.formater=a?new o.DateTimeFormatter(s):new o.NumericFormatter(s))};y.prototype={getDisplayText:function(){function e(e){return'"'+e.expText+'" 不是有效的运算表达式'}var t,r=this;return r.valid?r.formater?(t=r.isSingleVariable()?r.varItems[0].varField.getValue():r.calculate(),r.formater.format(t)):r.varItems[0].varField.getDisplayText():e(this)}},s(y,T);var S=function(e,t){y.call(this,e,t)};S.prototype={decodeVariable:x.prototype.decodeVariable,decodeFunction:x.prototype.decodeFunction,isPureNumeric:function(){var e=this;return o.NumericFormatter.prototype.isPrototypeOf(e.formater)||e.isSingleVariable()&&!e.varItems[0].varField.isDateTimeValue()}},s(S,y);var F=function(e){this.oParameter=e};F.prototype={getAsFloat:function(){return this.oParameter.AsFloat},getValue:function(){return this.oParameter.Value},getDisplayText:function(){return this.oParameter.DisplayText},isDateTimeValue:function(){return 6===this.oParameter.DataType}};var w=function(e,t){var r=this;r.textBuilder=e,r.varType=t};w.prototype={getAsFloat:function(){function e(){var e,t,r=n.graphs,o=r.length;for(e=0;o>e&&(t=r[e],!t.some(function(e){return e===a}));e++);return t}var t,r=this,o=r.textBuilder,n=o.chart,a=o.seriesIndex,i=o.groupIndex;if(n.IsScatterGraph())switch(t=n.Value(a,i),r.varType){case 1:t=t.x;break;case 2:t=t.y;break;case 3:t=t.z;break;case 5:t=t.z/n.GetSeriesTotalValue(a);break;case 7:t=n.GetSeriesTotalValue(a)}else switch(t=n.Value(a,i),r.varType){case 4:t/=n.GetGroupTotalValue(e(),i);break;case 6:t=n.GetGroupTotalValue(e(),i);break;case 5:t/=n.GetSeriesTotalValue(a);break;case 7:Val=n.GetSeriesTotalValue(a)}return t},getValue:function(){return this.getAsFloat()},getDisplayText:function(){var e=this,t=e.varType,r=e.textBuilder,o=r.seriesIndex,a=r.groupIndex,i=r.chart,l=i.IsScatterGraph(),s=i.graphSerieses[o],c=e.getAsFloat(),u=0;if(l)switch(t){case 1:u=1;break;case 2:u=2;break;case 3:case 7:u=3;break;case 5:u=5;break;case 8:u=4}else switch(t){case 1:case 8:case 9:u=4;break;case 2:case 6:case 7:u=2;break;case 4:case 5:u=5}switch(u){case 1:c=i.XAxis.ScaleFormatParser.format(c);case 2:c=l?i.YAxisOfSeries(s).ScaleFormatParser.format(c):s.ValueFormatParser.format(c);break;case 3:c=s.ValueFormatParser.format(c);break;case 4:c=8===t?i.SeriesLabel(o):i.GroupLabel(a);break;case 5:c=n.NumberFormat(c,"0.00%")}return c},isDateTimeValue:function(){return 0}};var D=c.ChartTextExpression=function(e,t){y.call(this,e,t)};D.prototype={decodeVariable:function(t,r,o){var n=t.chart.report.ParameterByName(r);return n?new F(n):e},decodeFunction:function(e,r,o){var n;return"chartvar"===r.toLowerCase()&&(o=i(t.ChartVarType,o),o>0&&(n=new w(e,o))),n}},s(D,y);var P=function(e){this.text=e};P.prototype={getDisplayText:function(){return this.text}};var R=c.TextBuilder=function(e,t){var r,o=this,n=e.XAxis?D:S,a=0,i=0,l=0;for(o.items=[],e.XAxis&&(o.chart=e,e=this);(i=t.indexOf(u,l))>=0;)l=t.indexOf(d,i+h),l>=0&&(r=new n(e,t.substring(i+h,l)),l+=h,r.valid&&(i>a&&o.items.push(new P(t.substring(a,i))),a=l,o.items.push(r)),i=l);a<t.length&&o.items.push(new P(t.substr(a)))};R.prototype={forEach:function(e){this.items.forEach(e)},generateDisplayText:function(){var e="";return this.forEach(function(t){e+=t.getDisplayText()}),e},generateChartDisplayText:function(e,t){var r=this;return r.seriesIndex=e,r.groupIndex=t,r.generateDisplayText()},isStaticText:function(){var e=this;return 1==e.items.length&&P.prototype.isPrototypeOf(e.items[0])}}}(),function(e){"use strict";function t(e){switch(e){case 2:return et;case 15:return tt;case 3:return rt;case 13:return ot;case 4:return nt;case 5:return at}return""}function r(e,t,r){return new J(e-r,t-r,e+r,t+r)}gr.dom={};var n=gr.enum_,a=gr.const_,i=gr.helper,l=gr.format,s=gr.exp,c=i.assignJSONMembers,u=i.enumMemberValid,d=i.enumBitMemberValid,h=i.colorMemberValid,p=i.fontString,f=i.fontHeight,g=i.intFixed,m=i.pixelsToHtml,C=i.percentToHtml,b=i.cloneDate,v=i.confirmDateValue,T=i.confirmCloneDateValue,x=i.strimDate,y=i.incDate,S=(i.incDate2,i.confirmBooleanValue),F=i.ensureNameText,w=i.enumName2Value,D=i.enumValue2Name,P=i.rgba2color,R=i.colorAlpha,B=i.color2rgba,A=i.colorGradientLight,E=i.colorGradientDark,N=(i.colorValue2Html,i.prototypeLinkExtend),V=i.prototypeCopyExtend,M=i.createArray,L=i.assignObjectEx,I=i.assignObject,O=i.assignObjectAtom,G=i.parseXML,k=i.getRelativePosition,H=(i.addEvent,i.bindEvents),j=i.toDegree,_=i.toRadians,W=gr.common,U=s.Summary,z=W.DateTime,J=W.Rect,Y=W.Pen,X=W.Border,Z=W.Font,q=W.FontWrapper,Q=W.TextFormat,K=W.Context,$=W.HtmlStyles,ee=W.HtmlElement,te=function(){var e=0;return function(){return"-gr-canvas-"+e++}}(),re=function(e){var t=0,r=0;e.length&&(e.forEach(function(e){t+=e.pxHeight}),e.forEach(function(e){e.pctHeight=Math.round(100*e.pxHeight/t),r+=e.pctHeight}),e[0].pctHeight+=100-r)},oe=function(e){var t=this;t.owner=e,t.items=[]};oe.prototype={loadFromJSON:function(e){var t,r=0;if(e)for(t=e.length;t>r;)this._doloadItem(e[r++])},getJsonMember:function(e){return this.owner.report.isWR?i.wrPropNameEncode(e):e},assign:function(e){var t=this;t.RemoveAll(),e.forEach(function(e){t.Add().assign(e)})},attachData:function(){for(var e=this.items,t=e.length;t--;)e[t].attachData()},prepare:function(){for(var e=this.items,t=0,r=e.length;r>t;)e[t++].prepare()},unprepare:function(){for(var e=this.items,t=e.length;t--;)e[t].unprepare()},generate:function(e){for(var t=this.items,r=0,o=t.length;o>r;)t[r++].generate(e)},itemByName:function(t){var r,o=this.items,n=o.length;if(t)for(t=t.toUpperCase();n--;)if(r=o[n],r.Name.toUpperCase()===t)return r;return e},indexOfCOMIndex:function(e){return e?("number"!=typeof e&&(e=this.IndexByName(e||"")),--e):e=-1,e},indexOf:function(e){for(var t=this.items,r=t.length;r--;)if(e===t[r])return r;return-1},decodeItems:function(e){var t,r=this,o=[];return e&&(t=e.split(";"),t.forEach(function(e){var t;e=e.trim(),t=r.itemByName(e),t&&o.push(t)})),o},forEach:function(e){this.items.forEach(e)},_doloadItem:function(e){this.Add().loadFromJSON(e)},get Count(){return this.items.length},Item:function(e){var t=this;return t.items[t.indexOfCOMIndex(e)]},Add:function(){var e=this,t=e._createItem();return e.items.push(t),t},Remove:function(e){var t=this;e=t.indexOfCOMIndex(e),e>=0&&t.items.splice(e,1)},RemoveAll:function(){this.items=[]},IndexByName:function(e){var t=this.items,r=t.length;if(e)for(;r--;)if(t[r].Name===e)return r+1;return-1},ItemAt:function(t){var r=this.items;return t--,t>=0&&t<r.length?r[t]:e},ChangeItemOrder:function(e,t){var r=this.items;if(o,len=r.length,t=Math.max(1,Math.min(len,t))-1,e!=t&&e>0&&e--<=len)if(o=r[e],t>e){do r[e]=r[e+1];while(++e<t)}else{do r[e]=r[e-1];while(--e>t);r[t]=o}}};var ne=function(e){oe.call(this,e)};ne.prototype={_doloadItem:function(e){var t=this,r=t.Add(w(n.ControlType,e[t.getJsonMember("Type")]));r&&r.loadFromJSON(e)},assign:function(e){var t=this;t.RemoveAll(),e.forEach(function(e){t.Add(e.ControlType).assign(e)})},layout:function(){var e=this,t=e.owner,r=e.items,o=t.isSingleDockControl&&t.isSingleDockControl()?0:t.getRect(),n=0,a=r.length;if(o)for(;a>n;)r[n++].layout(o);else 13===r[0].ControlType&&r[0].layout(t.getRect())},generate:function(e){for(var t,r=this.items,o=r.length;o--;)t=r[o],t.Visible&&t.generate(e)},Add:function(t){function r(t,r){var o=e;switch(t){case 1:o=new xe(r);break;case 2:o=new Re(r);break;case 10:o=new Pe(r);break;case 3:o=new we(r);break;case 4:o=new Se(r);break;case 5:o=new Fe(r);break;case 7:o=new Ae(r);break;case 8:o=new ye(r);break;case 9:o=new Ne(r);break;case 11:o=new At(r);break;case 12:o=new Be(r);break;case 13:o=new Le(r);break;case 6:o=new Ee(r)}return o}var o=this,n=r(t,o.owner);return n&&o.items.push(n),n}},N(ne,oe);var ae=function(e){oe.call(this,e)};ae.prototype={_doloadItem:function(e){var t=this;t.items.push(new Xe(t.owner).loadFromJSON(e))},addTo:function(e){var t,r,o=this,n=o.owner.ColumnContent.ContentCells,a=new Xe(o.owner);return o.items.push(a),t=new be(e,!1),e.items.push(t),a.TitleCell=t,t.Column=a,r=new Ce(n),n.items.push(r),a.ContentCell=r,r.Column=a,a},Add:function(){var e=this;return e.addTo(e.owner.ColumnTitle.TitleCells)},Remove:function(e){function t(e,r){var o,n,a=e.indexOf(e);if(a>=0)return e.splice(a,1),1;for(a=e.length,n=0;a>n;n++)if(o=e[n],o.GroupTitle&&t(o.SubTitles.items,r))return 1;return 0}var r,o=this,n=o.owner,a=n.ColumnContent.ContentCells.items;e=o.indexOfCOMIndex(e),e>=0&&(r=o.items[e],a.splice(a.indexOf(r.ContentCell),1),t(n.ColumnTitle.TitleCells.items,r.TitleCell),o.items.splice(e,1))},RemoveAll:function(){var e=this,t=e.owner;e.items=[],t.ColumnContent.ContentCells.items=[],t.ColumnTitle.TitleCells.items=[]}},N(ae,oe);var ie=function(e,t){var r=this;oe.call(r,e),r.supcell=t};ie.prototype={_doloadItem:function(e){var t=this;t.items.push(new be(t,e[t.getJsonMember("GroupTitle")]).loadFromJSON(e))},assign:function(e){var t=this;t.items=[],e.forEach(function(e){var r=new be(t,e.GroupTitle);t.items.push(r),r.assign(e),e.GroupTitle&&r.SubTitles.assign(e.SubTitles)})},AddGroup:function(e,t){var r=this,o=new be(r,!0);return o.Name=e,o.Text=t,r.items.push(o),o},RemoveGroup:function(e){var t=this,r=t.Item(e);r&&r.GroupTitle&&(oe.prototype.Remove.call(t,e),t.items=t.items.concat(r.SubTitles.items))},Add:function(){},Remove:function(e){},RemoveAll:function(){}},N(ie,oe);var le=function(e){oe.call(this,e)};le.prototype={_doloadItem:function(e){var t=this;t.items.push(new Ce(t).loadFromJSON(e))},assign:function(e){var t=this;t.items=[],e.forEach(function(e){var r=new Ce(t);t.items.push(r),r.assign(e)})},Add:function(){},ChangeItemOrder:function(e,t){},Remove:function(e){},RemoveAll:function(){}},N(le,oe);var se=function(e){oe.call(this,e)};se.prototype._createItem=function(){return new Je(this.owner)},N(se,oe);var ce=function(e){oe.call(this,e)};ce.prototype={_createItem:function(){return new Ze(this.owner)},_doloadItem:function(e){!e.PageGroup&&this.Add().loadFromJSON(e)}},N(ce,oe);var ue=function(e){oe.call(this,e)};ue.prototype._createItem=function(){return new Ge(this.owner)},N(ue,oe);var de=function(e){oe.call(this,e)};de.prototype._createItem=function(){return new ke(this.owner)},N(de,oe);var he=function(e){oe.call(this,e)};he.prototype._createItem=function(){return new Qe(this.owner)},N(he,oe);var pe=function(e){var t=this;t.owner=e,t.report=e.report,t.Tag=""};pe.prototype={afterLoad:function(e){},loadFromJSON:function(e){var t=this;return e&&(c(t,e),t.afterLoad(e)),t},assign:function(e){var t,r,o=this,n=o.Font,a=e.onclick,i=e.ondblclick;for(var l in e)o.hasOwnProperty(l)&&(t=e[l],r=typeof t,"object"!==r&&"array"!==r&&(o[l]=t));n&&n.assign(e.Font),a&&(o.onclick=a),i&&(o.ondblclick=i),o.children&&o.children.forEach(function(t){var r=e[t];r&&(r.owner?o[t].assign(r):I(o[t],r))})},registerEventClass:function(){var e=this,t=e.report,r=t.viewer._domevents;e.onclick&&!e.onclickClassID&&(r.push({type:1,fun:e.onclick}),e.onclickClassID=r.length),e.ondblclick&&!e.ondblclickClassID&&(r.push({type:2,fun:e.ondblclick}),e.ondblclickClassID=r.length)},addElementEventClass:function(e){var t=this,r=t.onclickClassID,o=t.ondblclickClassID;r&&e.addClass(i.getDomEventCSSName(r)),o&&e.addClass(i.getDomEventCSSName(o))},getUsingFont:function(){return this.Font.UsingFont()},getJsonMember:function(e){return this.report.isWR?i.wrPropNameEncode(e):e},toFillBack:function(){var e=this;return e.BackColor!==e.owner.BackColor}};var fe=function(e){var t=this;pe.call(t,e),t._borderCustom=!1,t.BackColor=e.BackColor,t.CanGrow=!1,t.CanShrink=!1,t.Font=new q(e.Font),t._freeCell=!0,t.setFreeCell(!1)};fe.prototype={loadFromJSON:function(e){var t=this;return e&&(t.setFreeCell(!!e[t.getJsonMember("FreeCell")]),c(t,e),t.afterLoad(e)),t},afterLoad:function(e){var t=this,r=t.report,o=r.viewer.alpha,n=r.isWR;h(t,"BackColor",o.background),h(t,"ForeColor",o.text),t.Font.loadFromJSON(e.Font,n),t.setBorderCustom(e[t.getJsonMember("BorderCustom")]),t._borderCustom&&t.Border.loadFromJSON(e.Border,o.border,n),t.FreeCell?t.Controls.loadFromJSON(e.Control):t.TextFormat.loadFromJSON(e,n)},assign:function(e){var t,r=this;r.setFreeCell(e.FreeCell),r.setBorderCustom(e.BorderCustom),pe.prototype.assign.call(r,e),r.Font.assign(e.Font),e.Border&&I(r.Border,e.Border),e.FreeCell?(r.Controls.assign(e.Controls),r.isSingleDockControl()&&(t=r.Controls.items[0],!t.onclick&&r.onclick&&(t.onclick=r.onclick),!t.ondblclick&&r.ondblclick&&(t.ondblclick=r.ondblclick))):I(r.TextFormat,e.TextFormat)},attachData:function(){var e=this;e.FreeCell?e.Controls.attachData():e._getWrapperClass().attachData.call(e)},prepare:function(){var e,t=this,r=t.report.viewer,o=t.Controls,n=t.Font.font;t.registerEventClass(),t.FreeCell&&(o.layout(),t.isSingleDockControl()||2===r.options.controlPosition||(e=t.getRect(),Oe.prototype.buildTableLayout.call(t,e.Width(),e.Height())),o.prepare(),t.isSingleDockControl()&&(e=o.items[0],!e.onclick&&t.onclick&&(e.onclick=t.onclick,e.onclickClassID=t.onclickClassID),!e.ondblclick&&t.ondblclick&&(e.ondblclick=t.ondblclick,e.ondblclickClassID=t.ondblclickClassID))),n&&(t.defaultFontStyle=r.selectFontItem(n)),t.tableRows&&t.tableRows.forEach(function(e){e.defaultStyle=r.selectSectionItem(e)}),t.defaultStyle=r.selectCellItem(t)},unprepare:function(){var e=this;e.FreeCell?e.Controls.unprepare():e._getWrapperClass().unprepare.call(e),delete e.defaultFontStyle,delete e.defaultStyle},doGenerate:function(e){var t=this,r=t.report.viewer,o=t.Controls,n=t.Font.font;e.addClass(r.selectCell(t)),n&&e.addClass(r.selectFont(n,t.defaultFontStyle)),t.addStyles&&t.addStyles(e),t.FreeCell?t.isSingleDockControl()?o.items[0].generateInCell(e):(t.addElementEventClass(e),t.tableRows?(e.addStyle("padding","0px"),e=new ee("table",e),e.addStyle("border-collapse","collapse"),Oe.prototype.generateTableRows.call(t,e)):(e.addStyle("position","relative"),o.generate(e))):(t.addElementEventClass(e),Te.prototype._genInnerText.call(t,e))},setFreeCell:function(e){var t,r=this;r._freeCell!==e&&(r._freeCell=e,e?(r.Controls=new ne(r),delete r.ControlType):(t=r._getWrapperClass(),t.createWrapper.call(r),r.ControlType=t.ControlType,delete r.Controls))},setBorderCustom:function(e){var t=this;t._borderCustom!==e&&(t._borderCustom=e,e?t.Border=new X(12):delete t.Border)},setForeColor:function(e){var t=this;t.FreeCell?t.Controls.forEach(function(t){t.ForeColor=e}):t.ForeColor=e},getDisplayText:function(){var e=this;return e._getWrapperClass().getDisplayText.call(e)},setDisplayText:function(e){var t=this;return t._getWrapperClass().setDisplayText.call(t)},getControls:function(){var e=this;return e.FreeCell?e.Controls.items:[e]},isSingleDockControl:function(){var e=this.Controls.items;return 1===e.length&&5===e[0].Dock},isControlPositionClass:function(){return 0},inDynamicRow:function(){return 0},_getDisplayText:function(){var e=this;return e._getWrapperClass()._getDisplayText.call(e)}},V(fe,pe);var ge=function(e,t,r){var o=this;fe.call(o,e),o.row=t,o.col=r,o.ColSpan=1,o.RowSpan=1,o.Text="",o.DataName=""};ge.prototype={generate:function(e){var t=this;
e=new ee("td",e),t.ColSpan>1&&e.addAttribute("colspan",t.ColSpan+""),t.RowSpan>1&&e.addAttribute("rowspan",t.RowSpan+""),t.doGenerate(e)},getOwnerGrid:function(){return this.owner},_getWrapperClass:function(){return ye.prototype},getRect:function(){for(var e=this,t=e.owner,r=e.col,o=e.row,n=r+e.ColSpan,a=o+e.RowSpan,i=0,l=0;n>r;)i+=t.columns[r++].pxWidth;for(;a>o;)l+=t.rows[o++].pxHeight;return new J(0,0,i,l)},inDynamicRow:function(){return this.owner.owner.inDynamicRow()},get FreeCell(){return!!this._freeCell},set FreeCell(e){this.setFreeCell(e)},get BorderCustom(){return!!this._borderCustom},set BorderCustom(e){this.setBorderCustom(e)},get DisplayText(){var e=this;return e.FreeCell?"":e.getDisplayText()},set DisplayText(e){var t=this;t.FreeCell&&t.setDisplayText(e)}},V(ge,fe);var me=function(e){var t=this;fe.call(t,e),t.Column=""};me.prototype={afterLoad:function(e){var t=this;fe.prototype.afterLoad.call(t,e),t.Column=t.owner.owner.Columns.itemByName(t.Column)},getOwnerGrid:function(){return this.owner.owner}},V(me,fe);var Ce=function(e){var t=this;me.call(t,e.owner),t.DataField=""};Ce.prototype={_getWrapperClass:function(){return Se.prototype},afterLoad:function(e){var t=this;me.prototype.afterLoad.call(t,e),t.Column.ContentCell=t},generate:function(e){var t=this,r=t.Column._crossOrderNo;e=new ee("td",e),r&&e.addAttribute("_grcrossno",r),t.doGenerate(e)},isControlPositionClass:function(){return this.FreeCell},get Name(){return this.Column.Name},set Name(e){this.Column.Name=e},get FreeCell(){return!!this._freeCell},set FreeCell(e){this.setFreeCell(e)},get BorderCustom(){return!!this._borderCustom},set BorderCustom(e){this.setBorderCustom(e)},get DisplayText(){var e=this;return e.FreeCell?"":e.getDisplayText()},set DisplayText(e){var t=this;t.FreeCell&&t.setDisplayText(e)},getRect:function(){var e=this;return new J(0,0,e.Column.pxWidth,e.owner.pxHeight)},inDynamicRow:function(){return 1}},V(Ce,me);var be=function(e,t){var r=this;me.call(r,e.owner),r.SupCell=e.supcell,r.Visible=!0,r.GroupTitle=t,r.Text="",r.Height=0,t&&(r._name="",r.SubTitles=new ie(r.owner,r))};be.prototype={_getWrapperClass:function(){return ye.prototype},afterLoad:function(e){var t=this;me.prototype.afterLoad.call(t,e),t.GroupTitle?(t._name=e[t.getJsonMember("Name")],t.SubTitles.loadFromJSON(e.ColumnTitleCell)):t.Column.TitleCell=t},prepare:function(){var e=this;me.prototype.prepare.call(e),e.SubTitles&&e.SubTitles.prepare()},generate:function(e){var t=this;e=new ee("th",e),t.doGenerate(e)},addStyles:function(e){var t=this,r=t.GroupTitle?1:t.owner.layerCount-t.owner.generatingLayer;t.colspan>1&&e.addAttribute("colspan",t.colspan+""),r>1&&e.addAttribute("rowspan",r+"")},getRect:function(){var e=this,t=e.GroupTitle?1:e.owner.layerCount-e.layer,r=e.GroupTitle?e.findLastColumn().pxRight-e.findFirstColumn().pxLeft:e.Column.pxWidth;return new J(0,0,r,e.owner.pxHeight*t)},findFirstColumn:function(){var e=this;return e.GroupTitle?e.SubTitles.items[0].findFirstColumn():e.Column},findLastColumn:function(){var e,t=this,r=t.Column;return t.GroupTitle&&(e=t.SubTitles.items,r=e[e.length-1].findLastColumn()),r},encloseColumnObject:function(e){var t=this;t.owner.owner._ColumnMoveTo(e,t)},get FreeCell(){return!!this._freeCell},set FreeCell(e){this.setFreeCell(e)},get BorderCustom(){return!!this._borderCustom},set BorderCustom(e){this.setBorderCustom(e)},get DisplayText(){var e=this;return e.FreeCell?"":e.getDisplayText()},set DisplayText(e){var t=this;t.FreeCell&&t.setDisplayText(e)},get Name(){var e=this;return e.GroupTitle?e._name:e.Column.Name},set Name(e){var t=this;t.GroupTitle?t._name=e:t.Column.Name=e},EncloseColumn:function(e){var t=this,r=t.owner.owner,o=r.Columns.Item(e);o&&r._ColumnMoveTo(o,t)},AddSubGroupTitle:function(e,t){return this.SubTitles.AddGroup(e,t)}},V(be,me);var ve=function(e){var t=this;pe.call(t,e),t.Left=0,t.Top=0,t.Width=0,t.Height=0,t.Anchor=3,t.Dock=0,t.Center=0,t.AlignColumnSide=3,t.AlignColumn="",t.AlignColumnEx="",t.Locked=!1,t.ShiftMode=1,t.PaddingLeft=0,t.PaddingRight=0,t.PaddingTop=0,t.PaddingBottom=0,t.BackColor=e.BackColor,t.BackStyle=2,t.ForeColor=e.ForeColor?e.ForeColor:R(0,t.report.viewer.alpha.text),t.Visible=!0,t.CustomDraw=!1,t.Border=new X(0),t.Font=new q(e.Font),t.Name="",t.CustomDrawScript=""};ve.prototype={children:["Border"],attachData:function(){},afterLoad:function(e){var t=this,r=t.report.isWR,o=t.report.viewer.alpha;u(t,"Dock",n.DockStyle),u(t,"Center",n.CenterStyle),u(t,"AlignColumnSide",n.AlignColumnSideStyle),u(t,"ShiftMode",n.ShiftMode),u(t,"BackStyle",n.BackStyle),d(t,"Anchor",n.AnchorStyle),h(t,"BackColor",o.background),h(t,"ForeColor",o.text),t.Font.loadFromJSON(e.Font,r),t.Border.loadFromJSON(e.Border,o.border,r)},layout:function(t){var r,o=this,n=o.report,a=n.size2Pixel(o.Width),i=n.size2Pixel(o.Height),l=new J(n.size2Pixel(o.Left),n.size2Pixel(o.Top),a,i),s=n.getRunningColumnByName(o.AlignColumn),c=n.getRunningColumnByName(o.AlignColumnEx);if(l.right+=l.left,l.bottom+=l.top,s&&!s.Visible&&(s=e),c&&!c.Visible&&(c=e),s||c)switch(s&&c?c.pxLeft<s.pxLeft&&(r=c,c=s,s=r):c?s=c:c=s,o.AlignColumnSide){case 1:l.left=s.pxLeft,l.right=l.left+a;break;case 2:l.right=c.pxRight,l.left=l.right-a;break;default:l.left=s.pxLeft,l.right=c.pxRight}else{if(0!==o.Dock)switch(l=t.clone(),o.Dock){case 5:t.left=t.right,t.top=t.bottom;break;case 1:l.right=Math.min(t.right,t.left+a),t.left=l.right;break;case 2:l.bottom=Math.min(t.bottom,t.top+i),t.top=l.bottom;break;case 3:l.left=Math.max(t.left,t.right-a),t.right=l.left;break;case 4:l.top=Math.max(t.top,t.bottom-i),t.bottom=l.top}0!==o.Center&&5!==o.Dock&&(1!==o.Center&&3!==o.Center||(a=l.Width(),l.left=(t.left+t.right-a)/2,l.right=l.left+a),2!==o.Center&&3!==o.Center||(i=l.Height(),l.top=(t.top+t.bottom-i)/2,l.bottom=l.top+i))}o.pxRect=l,o.oAlignColumn=s,o.oAlignColumnEx=c},prepare:function(){var e=this,t=e.report.viewer,r=!e.owner.isSingleDockControl&&e.owner.isControlPositionClass();e.registerEventClass(),e.defaultStyle=t.selectControlItem(e),e.Font.font&&(e.defaultFontStyle=t.selectFontItem(e.Font.font)),r&&(e.defaultPositionStyle=t.selectPositionItem(e))},unprepare:function(){var e=this;delete e.defaultStyle,delete e.defaultFontStyle,delete e.defaultPositionStyle,delete e.oAlignColumn,delete e.oAlignColumnEx},generate:function(e){var t,r=this,o=r.report.viewer,n=r.pxRect;t=new ee("span",e),r.addElementEventClass(t),t.addClass(o.selectControl(r)),r.Font.font&&t.addClass(o.selectFont(r.Font.font,r.defaultFontStyle)),r.defaultPositionStyle?t.addClass(o.selectPosition(r)):(t.addStyle("left",m(n.left)),t.addStyle("top",m(n.top)),t.addStyle("width",m(r.getContentWidth())),t.addStyle("height",m(r.getContentHeight()))),r.generateContent(t)},generateInCell:function(e){var t=this;t.addElementEventClass(e),t.oAlignColumn&&t.setCrossNoAttr(e),t.generateContent(e)},setCrossNoAttr:function(e){var t=this.oAlignColumn._crossOrderNo;t&&e.addAttribute("_grcrossno",t)},toFillBack:function(){var e=this;return 1===e.BackStyle&&e.BackColor!==e.owner.BackColor},getContentWidth:function(){var e=this,t=e.Border;return e.pxRect.Width()-e.PaddingLeft-e.PaddingRight-t.getLeftWidth()-t.getRightWidth()},getContentHeight:function(){var e=this,t=e.Border;return e.pxRect.Height()-e.PaddingTop-e.PaddingBottom-t.getTopWidth()-t.getBottomWidth()},SetBounds:function(e,t,r,o){var n=this;n.Left=e,n.Top=t,n.Width=r-e,n.Height=o-t},BringToFront:function(){var e=this,t=e.owner.Controls;t.ChangeItemOrder(t.indexOf(e),t.length)},SendToBack:function(){var e=this,t=e.owner.Controls;t.ChangeItemOrder(t.indexOf(e),1)}},V(ve,pe);var Te=function(e){var t=this;ve.call(t,e),t.createWrapper(),t.AsTextBox=t};Te.prototype={children:["Border","TextFormat"],afterLoad:function(e){var t=this;ve.prototype.afterLoad.call(t,e),t.TextFormat.loadFromJSON(e,t.report.isWR)},createWrapper:function(){var e=this;e.PaddingLeft=2,e.PaddingRight=1,e.PaddingTop=1,e.PaddingBottom=1,e.CanGrow=!1,e.CanShrink=!1,e.ShrinkFontToFit=!1,e.ForeColor=e.owner.ForeColor?e.owner.ForeColor:R(0,e.report.viewer.alpha.text),e.TextFormat=new Q,e.GetDisplayTextScript=""},generateInCell:function(e){var t=this;t.addElementEventClass(e),t.oAlignColumn&&t.setCrossNoAttr(e),t._genInnerText(e)},generateContent:function(e){var t=this;16&t.TextFormat.TextAlign||(t.TextFormat.WordWrap||64&t.TextFormat.TextAlign?(e.addStyle("display","table"),e=new ee("span",e),e.addStyle("display","table-cell"),e.addStyle("vertical-align",32&t.TextFormat.TextAlign?"middle":"bottom")):e.addStyle("line-height",m(t.getContentHeight()))),t._genInnerText(e)},_genInnerText:function(e){var t=this,r="<br />",o=t.getDisplayText();/[\r\n &<>"]/.test(o)&&(o=o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/"/g,"&quot;").replace(/\r\n/g,r).replace(/\r/g,r).replace(/\n/g,r)),e.innerText=o},getDisplayText:function(){var e=this;return e.displayTextAssigned=!1,e.doingGetDisplayText||(e.doingGetDisplayText=!0,e.report.fireTextBoxGetDisplayText(e),e.doingGetDisplayText=!1),e.displayTextAssigned?e.assignedDisplayText:e._getDisplayText()},setDisplayText:function(e){var t=this;t.assignedDisplayText=e,t.displayTextAssigned=!0}},V(Te,ve);var xe=function(e){var t=this;Te.call(t,e),t.Text="",t.Parameter=""};xe.prototype={ControlType:1,_getDisplayText:function(){var e=this;return e.valueField?e.valueField.DisplayText:e.oParameter?e.oParameter.DisplayText:e.Text},attachData:function(){var e=this;e.Parameter&&(e.oParameter=e.report.ParameterByName(e.Parameter))},unprepare:function(){var e=this;Te.prototype.unprepare.call(e),delete e.oParameter},get DisplayText(){return this.getDisplayText()},set DisplayText(e){this.setDisplayText(e)},get AsStaticBox(){return this}},V(xe,Te);var ye=function(e){var t=this;Te.call(t,e),t.Text=""};ye.prototype={ControlType:8,createWrapper:function(){var e=this;Te.prototype.createWrapper.call(e),e.Text=""},_getDisplayText:function(){return this.textBuilder.generateDisplayText()},attachData:function(){var e=this;e.textBuilder=new s.TextBuilder(e.report,e.Text)},getSummaryExpFields:function(){var e=[];return this.textBuilder.forEach(function(t){t.varItems&&t.varItems.forEach(function(t){4===t.varField.type&&e.push(t.varField)})}),e},getParameterExpFields:function(){var e=[];return this.textBuilder.forEach(function(t){t.varItems&&t.varItems.forEach(function(t){2===t.varField.type&&e.push(t.varField)})}),e},isPureNumericExpression:function(){var e=this;return e.prepare(),e.textBuilder&&1===e.textBuilder.items.length&&e.textBuilder.items[0].isPureNumeric()},get DisplayText(){return this.getDisplayText()},set DisplayText(e){this.setDisplayText(e)},get AsFloat(){var e=this.textBuilder.items[0].calculate();return isNaN(e)?0:e},get Value(){return this.getDisplayText()},get AsMemoBox(){return this}},V(ye,Te);var Se=function(e){var t=this;Te.call(t,e),t.DataField=""};Se.prototype={ControlType:4,createWrapper:function(){var e=this;Te.prototype.createWrapper.call(e),e.DataField=""},attachData:function(){var e=this;e.oDataField=e.report.RunningFieldByName(e.DataField)},unprepare:function(){var e=this;Te.prototype.unprepare.call(e),delete e.oDataField},_getDisplayText:function(){var e=this.oDataField;return e?e.DisplayText:""},get DisplayText(){return this.getDisplayText()},set DisplayText(e){this.setDisplayText(e)},get AsFieldBox(){return this}},V(Se,Te);var Fe=function(e){var t=this;Te.call(t,e),t.SummaryFun=1,t.RankNo=1,t.DataField="",t.DisplayField="",t.Format=""};Fe.prototype={ControlType:5,afterLoad:function(e){var t=this;Te.prototype.afterLoad.call(t,e),u(t,"SummaryFun",n.SummaryFun)},attachData:function(){var e,t,r=this,o=r.Format;r.init(r.DataField,r.DisplayField),o||(e=r.report.RunningFieldByName(r.DataField),e&&(o=e.Format)),t=r.paramExp,t&&1===t.varItems.length&&1===t.varItems[0].type&&6===t.varItems[0].object.FieldType?r.formater=new l.DateTimeFormatter(o):r.formater=new l.NumericFormatter(o)},_getDisplayText:function(){var e,t=this,r=t.SummaryFun,o=t.valueField;if(18===r||19===r||t.displayField)e=o?o.DisplayText:t.value;else{if(o){if(o.IsNull)return"";e=o.AsFloat}else e=t.value;e=t.formater.format(e)}return e},get DisplayText(){return this.getDisplayText()},set DisplayText(e){this.setDisplayText(e)},get Value(){return this.getValue()},set Value(e){this.setValue(e)},get AsSummaryBox(){return this}},V(Fe,Te),V(Fe,U);var we=function(e){var t=this;Te.call(t,e),t.SystemVar=1,t.GroupIndex=1,t.Format=""};we.prototype={ControlType:3,afterLoad:function(e){var t=this;Te.prototype.afterLoad.call(t,e),u(t,"SystemVar",n.SystemVarType)},attachData:function(){var e=this;1===e.SystemVar?e.formater=new l.DateTimeFormatter(e.Format):e.formater=new l.NumericFormatter(e.Format)},_getDisplayText:function(){var e=this;return e.formater.format(e.report.SystemVarValue2(e.SystemVar,e.GroupIndex))},get DisplayText(){return this.getDisplayText()},set DisplayText(e){this.setDisplayText(e)},get AsSystemVarBox(){return this}},V(we,Te);var De=function(e){ve.call(this,e)};De.prototype={generateContent:function(e){var t,r,o=this,n=o;if(o.owner.inDynamicRow()){n=o.cloneDraw();for(t in o)r=o[t],"object"!=typeof r||n[t]||(n[t]=r)}return o.report.registerCanvas(n,e),n},resize:function(){var e=this,t=e.canvas;t.width=Math.min(t.parentNode.clientWidth,window.innerWidth),t.height=Math.min(t.parentNode.clientHeight,window.innerHeight),e.draw(1)}},V(De,ve);var Pe=function(e){var t=this;De.call(t,e),t.L2R=!0,t.U2D=!0,t.LinePen=new Y};Pe.prototype={ControlType:10,children:["LinePen"],afterLoad:function(e){var t=this,r=t.report;ve.prototype.afterLoad.call(t,e),t.LinePen.loadFromJSON(e.Pen,r.viewer.alpha.stroke,r.isWR)},cloneDraw:function(e){var t=this,r=new Pe(t.owner);return r.assign(t),r},draw:function(e){var t,r=this,o=r.canvas,n=new K(o.getContext("2d")),a=0,i=0,l=o.width,s=o.height;n.SelectPen(r.LinePen),r.L2R||(t=a,a=l,l=t),r.U2D||(t=i,i=s,s=t),n.drawLine(a,i,l,s)},get AsLine(){return this}},V(Pe,De);var Re=function(e){var t=this;De.call(t,e),t.ShapeType=4,t.FillColor=0,t.FillStyle=2,t.CornerDx=4,t.CornerDy=4,t.LinePen=new Y};Re.prototype={ControlType:2,children:["LinePen"],afterLoad:function(e){var t=this,r=t.report,o=t.report.viewer.alpha;ve.prototype.afterLoad.call(t,e),u(t,"ShapeType",n.ShapeBoxType),u(t,"FillStyle",n.BackStyle),h(t,"FillColor",o.background),t.LinePen.loadFromJSON(e.Pen,o.stroke,r.isWR)},cloneDraw:function(e){var t=this,r=new Re(t.owner);return r.assign(t),r},draw:function(e){var t,r,o,n=this,a=n.canvas,i=a.width,l=a.height,s=new K(a.getContext("2d")),c=n.LinePen.Width/2,u=1===n.FillStyle;switch(s.SelectPen(n.LinePen),u&&s.setFillColor(n.FillColor),n.ShapeType){case 7:s.drawLine(0,c,i,c);break;case 1:t=s.circle;break;case 2:t=s.ellipse;break;case 3:t=s.rectangle;break;case 6:t=s.square;break;case 4:t=s.roundRectangle,r=1;break;case 5:t=s.roundSquare,r=1}t&&(o=[c,c,i-2*c,l-2*c],r&&o.push(n.CornerDx,n.CornerDy),o.push(u),t.apply(s,o)),u&&s.resetFillStyle(),s.RestorePen()},get AsShapeBox(){return this}},V(Re,De);var Be=function(e){var t=this;De.call(t,e),t.Text="",t.BarcodeType=4,t.BarWidth=0,t.BarRatio=2,t.CheckSum=!1,t.Direction=1,t.Alignment=2,t.CaptionPosition=3,t.CaptionAlignment=2,t.PDF417Rows=0,t.PDF417Columns=0,t.PDF417ErrorLevel=0,t.PDF417Simple=!1,t.QRCodeVersion=0,t.QRCodeErrorLevel=1,t.QRCodeMask=0,t.DtmxEncoding=2,t.DtmxMatrixSize=2,t.DtmxModuleSize=0};Be.prototype={ControlType:12,attachData:function(){var e=this;e.textBuilder=new s.TextBuilder(e.report,e.Text)},afterLoad:function(e){var t=this,r=e[t.getJsonMember("BarcodeType")];switch(ve.prototype.afterLoad.call(t,e),r){case"Code25_Interleaved":t.BarcodeType=1;break;case"Code25_Industrial":t.BarcodeType=2;break;case"Code25_Matrix":t.BarcodeType=3;break;case"Code39Extended":t.BarcodeType=5;break;case"Code93Extended":t.BarcodeType=10;break;default:u(t,"BarcodeType",n.BarcodeType)}u(t,"Direction",n.BarcodeDirection),u(t,"Alignment",n.StringAlignment),u(t,"CaptionPosition",n.BarcodeCaptionPosition),u(t,"CaptionAlignment",n.StringAlignment),u(t,"DtmxEncoding",n.DtmxEncoding),u(t,"DtmxMatrixSize",n.DtmxMatrixSize)},getDisplayText:function(){return this.textBuilder.generateDisplayText()},generateContent:function(e){var t,r=this,o=r.BarcodeType,n=encodeURI(window.rubylong.grhtml5.barcodeURL),a={type:o,text:r.DisplayText,codepage:r.report.CodePage};t=De.prototype.generateContent.call(r,e),1!==r.CaptionPosition&&(a.requireShowText=!0),n&&a.text&&(51===o?(a.Version=r.QRCodeVersion,a.ErrorLevel=r.QRCodeErrorLevel,a.Mask=r.QRCodeMask):50===o?(a.Rows=r.PDF417Rows,a.Columns=r.PDF417Columns,a.ErrorLevel=r.PDF417ErrorLevel,a.Simple=r.PDF417Simple):52===o?(a.Encoding=r.DtmxEncoding,a.MatrixSize=r.DtmxMatrixSize,a.ModuleSize=r.DtmxModuleSize):a.CheckSum=r.CheckSum,n+="?params="+encodeURIComponent(JSON.stringify(a)),window.rubylong.ajax(n,function(e,t){var r=this;t&&(r.data=JSON.parse(e.responseText),r.draw())},t,"POST"))},cloneDraw:function(e){var t=this,r=new Be(t.owner);return r.assign(t),r},draw:function(e){var t=this;t.data&&t._dodraw()},_dodraw:function(){function e(e){return 50===e||51===e||52===e}function t(e){return 15===e||14===e||16===e||17===e||18===e}function r(e){return parseInt(e,16)}function o(){var e,t,o,n,a,i,c,f=l/D,m=s/P,C={init:function(){p.right=U.left,p.bottom=U.top+m},draw:function(){p.right+=f*a,b.fillRect(p,h),p.left=p.right},end:function(){p.right+=f*a,b.fillRect(p,h),p.top=p.bottom,p.bottom+=m,p.left=U.left,p.right=U.left}},v={init:function(){p.left=U.right,p.top=U.bottom-m},draw:function(){p.left-=f*a,b.fillRect(p,h),p.right=p.left},end:function(){p.left-=f*a,b.fillRect(p,h),p.bottom=p.top,p.top-=m,p.left=U.right,p.right=U.right}},F={init:function(){p.bottom=U.top,p.left=U.right-m},draw:function(){p.bottom+=f*a,b.fillRect(p,h),p.top=p.bottom},end:function(){p.bottom+=f*a,b.fillRect(p,h),p.right=p.left,p.left-=m,p.top=U.top,p.bottom=U.top}},w={init:function(){p.top=U.bottom,p.right=U.left+m},draw:function(){p.top-=f*a,b.fillRect(p,h),p.bottom=p.top},end:function(){p.top-=f*a,b.fillRect(p,h),p.left=p.right,p.right+=m,p.top=U.bottom,p.bottom=U.bottom}};switch(50!=y&&(f>m?f=m:m=f),u=f*D,d=m*P,j=(l-u)/2,_=(s-d)/2,E||(g=j,j=_,_=g),U.left+=j,U.right=U.left+u,U.top+=_,U.bottom=U.top+d,S){case 1:c=C;break;case 2:c=v;break;case 3:c=F;break;default:c=w}for(p=U.clone(),c.init(),B=R.length,g=0,t=0;P>t;++t){for(o=r(R[g++])<<4|r(R[g++]),n=128,h=o&n?x:T,a=1,n>>=1,e=1;D>e;++e)0==e%8&&(o=r(R[g++])<<4|r(R[g++]),n=128),i=o&n?x:T,h===i?++a:(c.draw(),h=i,a=1),n>>=1;c.end()}}function n(){switch(y){case 15:I=15,O=0;break;case 16:case 17:case 18:I=12,O=12}}function a(){function e(){var e=m.BarRatio;switch(y){case 1:case 2:case 4:case 14:case 15:case 5:case 13:case 16:case 17:case 18:case 19:case 20:2>e&&(e=2),e>3&&(e=3);break;case 3:2.25>e&&(e=2.25),e>3&&(e=3)}return[1,e,1.5*e,2*e]}function t(e){var t=r(e);return{w:h[t%4],lt:Math.floor(t/4)}}function o(e){for(var r=e.length,o=0;r-- >0;)o+=t(e[r]).w;return o}var n,a,i,d,h=e(),f=o(R),a=m.BarWidth,C=V/A.length/10,v=2*s/5,F=N?s+2*M/3:s;if(G=C*I,k=C*O,c=a?report.UnitToPixels(a):(l-G-k)/f,u=c*f+G+k,H=u>l+1,!H){switch(m.Alignment){case 1:j=G;break;case 2:j=(l-u)/2+G;break;default:j=l-u+G}switch(p=U,S){case 1:p.left+=j;break;case 2:p.right-=j;break;case 3:p.top+=j;break;default:p.bottom-=j}for(g=0;B>g;++g)switch(n=t(R[g]),a=n.w*c,i=2===n.lt?v:3==n.lt?F:s,d=0==n.lt?T:x,S){case 1:p.right=p.left+a,p.bottom=p.top+i,b.fillRect(p,d),p.left=p.right;break;case 2:p.left=p.right-a,p.bottom=p.top+i,b.fillRect(p,d),p.right=p.left;break;case 3:p.bottom=p.top+a,p.left=p.right-i,b.fillRect(p,d),p.top=p.bottom;break;default:p.top=p.bottom-a,p.left=p.right-i,b.fillRect(p,d),p.bottom=p.top}}}function i(){var e,t,r,o,n=1===m.CaptionAlignment?33:2===m.CaptionAlignment?34:36,a=z.left+j;if(E?(3===F&&(_=-_),z.top+=_,z.bottom+=_):(2===F&&(j=-j),z.left+=j,z.right+=j),N)switch(g=0,y){case 15:a-=G,b.drawText(A.substr(g++,1),a,z.top),a=z.left+j+4*c,o=a+42*c,b.drawEqualSpaceText(A.substr(g,6),a,o,z.top),g+=6,a=z.left+j+50*c,o=a+41*c,b.drawEqualSpaceText(A.substr(g,6),a,o,z.top);break;case 14:a+=4*c,o=a+28*c,b.drawEqualSpaceText(A.substr(g,4),a,o,z.top),g+=4,a=z.left+j+36*c,o=a+27*c,b.drawEqualSpaceText(A.substr(g,4),a,o,z.top);break;case 17:case 18:b.FontSizeChangeTo(Math.floor(.77*b.usingFont.Size)),M=f(b.usingFont),V=b.measureTextWidth("0"),a-=G,b.drawText("0",a,z.bottom-M),e=A.substr(6),V=b.measureTextWidth(e),a=z.right-j+k-V,b.drawText(e,a,z.bottom-M),b.FontPointRestore(),a=z.left+j+4*c,o=a+42*c,b.drawEqualSpaceText(A.substr(0,6),a,o,z.top);break;case 16:b.FontSizeChangeTo(Math.floor(.77*b.usingFont.Point)),M=f(b.usingFont),e=A.substr(0,1),V=b.measureTextWidth(e),a-=G,b.drawText(e,a,z.bottom-M),e=A.substr(11),V=b.measureTextWidth(e),a=z.left+j+95*c+Math.max(k-V,2),b.drawText(e,a,z.bottom-M),b.FontPointRestore(),a=z.left+j+11*c,o=a+35*c,++g,b.drawEqualSpaceText(A.substr(g,5),a,o,z.top),a=o+5*c,o=a+35*c,g+=5,b.drawEqualSpaceText(A.substr(g,5),a,o,z.top)}else if(E){switch(m.Alignment){case 1:z.right=z.left+u;break;case 2:z.left=(z.left+z.right-u)/2,z.right=z.left+u;break;default:z.left=z.right-u}b.drawText2(A,z,n)}else{switch(m.Alignment){case 1:z.bottom=z.top+u;break;case 2:z.top=(z.top+z.bottom-u)/2,z.bottom=z.top+u;break;default:z.top=z.bottom-u}switch(t=z.right,m.CaptionAlignment){case 1:r=z.top;break;case 2:r=(z.top+z.bottom-V)/2;break;default:r=z.bottom-V}b.drawTextRotate(A,t,r,270)}}var l,s,c,u,d,h,p,g,m=this,C=m.canvas,b=new K(C.getContext("2d")),v=m.getUsingFont(),T=m.BackColor,x=m.ForeColor,y=m.BarcodeType,S=m.Direction,F=m.CaptionPosition,w=m.data,D=w.cols,P=w.rows,R=w.graph,B=R?R.length:0,A=w.text?w.text:m.DisplayText,e=e(y),E=1===S||2===S,N=t(y)&&1===S&&3===F,V=0,M=f(v),L=e?Math.max(M,10):0,I=0,O=0,G=0,k=0,H=!1,j=0,_=0,W=new J(0,0,C.width,C.height),U=W.clone(),z=W.clone();if(D){if(b.SelectFont(v),1!==F&&(E?2===F?(z.bottom=z.top+M,U.top=z.bottom+L):(z.top=z.bottom-M,U.bottom=z.top-L):2===F?(z.left=z.right-M,U.right=z.left-L):(z.right=z.left+M,U.left=z.right+L)),l=E?U.Width():U.Height(),s=E?U.Height():U.Width(),10>l||10>s)return void b.RestoreFont();1!=F&&(V=b.measureTextWidth(A)),e?o():(n(),a()),H?pdd.drawTextCenter("条宽度太大，条码无法完整显示",(W.left+W.right)/2,(W.top+W.bottom-M)/2):1!=F&&i(),b.RestoreFont()}},get Value(){return this.getDisplayText()},get DisplayText(){return this.getDisplayText()},get AsBarcode(){return this}},V(Be,De);var Ae=function(e){var t=this;ve.call(t,e),t.Alignment=3,t.SizeMode=3,t.TransparentMode=0,t.RotateMode=0,t.ImageIndex=0,t.Picture="",t.ImageFile="",t.DataField=""};Ae.prototype={ControlType:7,afterLoad:function(e){var t=this;ve.prototype.afterLoad.call(t,e),u(t,"SizeMode",n.PictureSizeMode),u(t,"TransparentMode",n.PictureTransparentMode),u(t,"RotateMode",n.PictureRotateMode)},attachData:function(){var e=this;e.oDataField=e.report.RunningFieldByName(e.DataField)},generateContent:function(e){var t,r,o,n,a,l,s,c=this,u=i.pixelsToHtml;c.Picture?n="data:image;base64,"+c.Picture:c.oDataField?(n=c.oDataField.AsString,n.length>256&&(n="data:image;base64,"+n)):c.ImageFile&&(n=c.ImageFile),n&&(5===c.SizeMode?e.addStyle("background-image","url("+n+")"):(t=c.pxRect,t||(t=c.owner.getRect()),r=t.Width(),o=t.Height(),e.addStyle("text-align","center"),e.addStyle("vertical-align","middle"),a=new ee("img",e),l=u(r),s=u(o),l&&a.addAttribute("width",l),s&&a.addAttribute("height",s),a.addAttribute("src",n)))},set Text(e){this[e.length>256?"Picture":"ImageFile"]=e},get AsPictureBox(){return this},LoadFromFile:function(e){this.ImageFile=e}},V(Ae,ve);var Ee=function(e){var t=this;ve.call(t,e)};Ee.prototype={ControlType:6,get AsRichTextBox(){return this},generateContent:function(e){e.innerText="不支持RichTextBox"}},V(Ee,ve);var Ne=function(e){var t=this;ve.call(t,e),t.HideOnRecordsetEmpty=!1,t.RelationFields="",t.Report=new Ke(e.report.viewer,t)};Ne.prototype={ControlType:9,afterLoad:function(e){var t=this,r=e.Report;ve.prototype.afterLoad.call(t,e),t.Report.isWR=t.report.isWR,r&&t.Report.loadFromJSON(r)},prepare:function(){var e=this,t=e.report;ve.prototype.prepare.call(e),t._srChildren||(t._srChildren=[]),t._srChildren.push(e),e.prepareRelationRecordset()},prepareRelationRecordset:function(){var e,t,r,o,n,a,i=this,l=i.RelationFields,s=i.report,c=s.DetailGrid,u=i.Report,d=u.DetailGrid;if(l&&d&&c&&(e=c.Recordset,r=d.Recordset,t=e.decodeFields(l),o=r.decodeFields(l),t.length===o.length&&r.RecordCount)){for(i._rmFields=t,i._rdFields=o,a=i._relations=[],r.First(),n=[],a.push(n),n.push(r.curRecord),r.keepValue(),r.Next();!r.Eof();)r.fieldsKeepedValueChanged(o)&&(n=[],a.push(n),r.keepValue()),n.push(r.curRecord),r.Next();a.sort(function(e,t){for(var r,n,a,i=0,l=o.length;l>i;){if(r=o[i++]._tableMember,n=e[0][r],a=t[0][r],a>n)return-1;if(n>a)return 1}return 0})}},generateContent:function(t){var r=this,o=r.Report.DetailGrid?r.Report.DetailGrid.Recordset:e,n=r._relations;n&&r.attachRelationTable(),(!r.HideOnRecordsetEmpty||!o||o.RecordCount)&&r.Report.generate(t),n&&r.detachRelationTable()},detachRelationTable:function(){var e=this.Report.DetailGrid.Recordset;e._dataTable=e._bakTable,e._relTblIndex=-1,delete e._bakTable},attachRelationTable:function(){function e(){for(var e,r,o=n._rmFields,a=n._rdFields,i=o.length,s=0;i>s;){if(r=t[a[s]._tableMember],e=l[o[s++]._tableMember],e>r)return-1;if(r>e)return 1}return 0}var t,r,o,n=this,a=n._relations,i=n.Report.DetailGrid.Recordset,l=n.report.DetailGrid.Recordset.curRecord,s=a.length-1,c=0;for(i._bakTable=i._dataTable,i._dataTable=[];s>=c;)if(r=Math.floor((c+s)/2),t=a[r][0],o=e(),0>o)c=r+1;else{if(!(o>0)){i._dataTable=a[r],i._relTblIndex=r;break}s=r-1}return!0},attachRelationTable2:function(e){var t=this;t.Report.DetailGrid.Recordset._dataTable=t._relations[e]},get AsSubReport(){return this}},V(Ne,ve);var Ve=function(e){var t=this;pe.call(t,e),t.Visible=!0,t.FixedWidth=!1,t.Width=t.report.cm2Size(3)};Ve.prototype={prepare:function(){self.pxWidth=this.report.size2Pixel(self.Width)},get FreeGrid(){return this.owner}},V(Ve,pe);var Me=function(e){var t=this;pe.call(t,e),t.Visible=!0,t.Height=t.report.cm2Size(.58)};Me.prototype={prepare:function(){self.pxHeight=this.report.size2Pixel(self.Height)},get FreeGrid(){return this.owner}},V(Me,pe);var Le=function(e){var t=this;ve.call(t,e),t.ColumnCount=5,t.RowCount=5,t.TitleRows=1,t.ShowColLine=!0,t.ShowRowLine=!0,t.ColLinePen=new Y,t.RowLinePen=new Y,t.columns=[],t.rows=[],t.cells=[]};Le.prototype={ControlType:13,attachData:function(){var e,t,r,o=this;for(t=o.cells.length,e=0;t>e;e++)r=o.cells[e],r&&r.forEach(function(e){e.attachData(),e.prepare()})},prepareChildren:function(){var e,t=this,r=t.columns,o=t.rows,n=t.cells;for(e=r.length=t.ColumnCount;e--;)r[e]||(r[e]=new Ve(t));for(e=n.length=o.length=t.RowCount;e--;)o[e]||(o[e]=new Me(t)),n[e]||(n[e]=[],n[e].length=t.ColumnCount)},layout:function(e){var t,r,o,n,a=this,i=a.report,l=a.Border;for(r=a.columns.length,o=0,t=0;r>t;t++)n=a.columns[t],n.pxWidth=i.size2Pixel(n.Width),o+=n.Width;for(a.Width=o+i.pixel2Size(l.getLeftWidth()+l.getRightWidth()),r=a.rows.length,o=0,t=0;r>t;t++)n=a.rows[t],n.pxHeight=i.size2Pixel(n.Height),o+=n.Height;a.Height=o+i.pixel2Size(l.getTopWidth()+l.getBottomWidth()),ve.prototype.layout.call(a,e)},prepare:function(){var e=this,t=new $;e.columns.length===e.ColumnCount&&e.rows.length===e.RowCount&&e.cells.length===e.RowCount||e.prepareChildren(),ve.prototype.prepare.call(e),t.addCellBorder(e),e.blankCellStyle=e.report.viewer.addCustomStyle(t)},assign:function(e){var t=this;ve.prototype.assign.call(t,e),e.columns.forEach(function(e,r){var o=new Ve(t);o.assign(e),t.columns[r]=o}),e.rows.forEach(function(e,r){var o=new Me(t);o.assign(e),t.rows[r]=o}),e.cells.forEach(function(e,r){e.forEach(function(e,o){var n=new ge(t,r,o);n.assign(e),t.cells[r]||(t.cells[r]=[]),t.cells[r][o]=n})})},afterLoad:function(e){var t,r,o,n,a=this;if(ve.prototype.afterLoad.call(a,e),a.columns=[],a.rows=[],a.cells=[],a.prepareChildren(),e.FreeGridColumn)for(r=e.FreeGridColumn.length,t=0;r>t;t++)n=e.FreeGridColumn[t],a.columns[n.index-1].loadFromJSON(n);if(e.FreeGridRow)for(r=e.FreeGridRow.length,t=0;r>t;t++)n=e.FreeGridRow[t],a.rows[n.index-1].loadFromJSON(n);if(e.FreeGridCell)for(r=e.FreeGridCell.length,t=0;r>t;t++)n=e.FreeGridCell[t],--n.row,--n.col,o=a.cells[n.row],o=o[n.col]=new ge(a,n.row,n.col),o.loadFromJSON(n)},generateContent:function(e){var t,r,o,n,a=this,i=new ee("table",e),l=new ee("colgroup",i),s=[];for(a.Font.font&&i.addClass(a.report.viewer.selectFont2(a.Font.font)),i.getStyles().addBorder(a.Border),i.addStyle("border-collapse","collapse"),i.addStyle("width","100%"),a.toFillBack()&&i.addBackColorStyle(a.BackColor),n=a.ColumnCount,o=0;n>o;o++)t=new ee("col",l),t.skipend=1,t.addStyle("width",C(100*a.columns[o].pxWidth/a.pxRect.Width()));for(o=0;o<a.RowCount;o++)r=[],r.length=a.ColumnCount,s.push(r);a.cells.forEach(function(e,t){e.forEach(function(e){function t(){for(var t,r=e.row,o=r+e.RowSpan,n=e.col+e.ColSpan;o>r;r++)for(t=e.col;n>t;t++)s[r][t]=1}(e.ColSpan>1||e.RowSpan>1)&&t(),s[e.row][e.col]=e})}),s.forEach(function(e,t){var r,o=a.ColumnCount,n=0,l=new ee("tr",i);l.addStyle("height",m(a.rows[t].pxHeight));do{for(;o>n&&!e[n];)r=new ee("td",l),r.addClass(a.blankCellStyle.getStyleName()),n++;for(;o>n&&1===e[n];)n++;o>n&&(r=e[n])&&(r.generate(l),n=r.col+r.ColSpan)}while(o>n)})},get AsFreeGrid(){return this},ColumnAt:function(e){var t=this,r=t.columns;return r.length!==t.ColumnCount&&t.prepareChildren(),r[e-1]},RowAt:function(e){var t=this,r=t.rows;return r.length!==t.RowCount&&t.prepareChildren(),r[e-1]},CellAt:function(t,r){var o,n=this,a=n.cells,i=e;return a.length!==n.RowCount&&n.prepareChildren(),t>0&&t<=n.RowCount&&r>0&&r<=n.ColumnCount&&(o=a[--t],i=o[--r],i||(i=o[r]=new ge(n,t,r))),i},CellByDataName:function(t){for(var r,o,n,a=this,i=a.cells,l=i.length,s=l;s--;)for(r=i[s],o=r.length;o--;)if(n=r[o],n&&n.DataName===t)return n;return e}},V(Le,ve);var Ie=function(e){var t=this;pe.call(t,e),t.Visible=!0,t.CanGrow=!1,t.CanShrink=!1,t.Height=e.report.cm2Size(t.defaultHeight()),t.BackColor=e.BackColor,t.FormatScript="",t.Font=new q(t.getParentFont())};Ie.prototype={afterLoad:function(e){var t=this,r=t.report;e[t.getJsonMember("BackColor")]||(t.BackColor=t.getParentBackColor()),h(t,"BackColor",r.viewer.alpha.background),t.Font.loadFromJSON(e.Font,r.isWR)},prepare:function(){var e=this,t=e.Controls;e.registerEventClass(),e.pxHeight=e.report.size2Pixel(e.Height),e._singleHidableSR=e.getSingleHidableSR(),e._singleSR=t&&1===t.Count&&9===t.Item(1).ControlType},unprepare:function(){delete self.defaultStyle},generate:function(e){var t=this;t.report.fireSectionFormat(t),t.pxHeight=t.report.size2Pixel(t.Height),t.isToGenerate()&&(t._singleSR&&!t.Group?t.Controls.Item(1).generateContent(e):t.doGenerate(e))},defaultHeight:function(){return 3},getParentBackColor:function(e){return this.owner.BackColor},getParentFont:function(){return this.owner.Font},getSingleHidableSR:function(){return e},isControlPositionClass:function(){return 0},isToGenerate:function(){function e(){var e,r=t._singleHidableSR,o=r._relations;return o&&r.attachRelationTable(),e=!r.Report.DetailGrid||r.Report.DetailGrid.Recordset.RecordCount,o&&r.detachRelationTable(),e}var t=this,r=t.Visible&&t.Height>0;return r&&t._singleHidableSR&&(r=e()),r}},V(Ie,pe);var Oe=function(e){var t=this;Ie.call(t,e),t.Controls=new ne(t)};Oe.prototype={children:["Controls"],afterLoad:function(e){var t=this;Ie.prototype.afterLoad.call(t,e),t.Controls.loadFromJSON(e.Control)},attachData:function(){this.Controls.attachData()},prepare:function(){var e=this,t=e.Controls,r=e.report,o=r.viewer;Ie.prototype.prepare.call(e),t.layout(),2!==o.options.controlPosition&&e.buildTableLayout(r.getReportWidth(),e.pxHeight),t.prepare(),e.tableRows&&(r.reportFitHeight&&re(e.tableRows),e.tableRows.forEach(function(e){e.defaultStyle=o.selectSectionItem(e)})),e.defaultStyle=o.selectSectionItem(e)},buildTableLayout:function(t,r){function o(t,r,o,n){var a,i,l,s=[];for(c.forEach(function(e){s.push({pos:e.pxRect[t],count:1},{pos:e.pxRect[r],count:1})}),s.sort(function(e,t){return e.pos-t.pos}),a=s.length,i=0;a>i&&s[i].pos<o;)s[i++]=e;
if(i>0&&(s.unshift({pos:o,count:i}),++a),!isNaN(n)){for(i=a-1;i>=0&&s[i]&&s[i].pos>n;)s[i--]=e;i=a-1-i,i>=0&&s.push({pos:n,count:i})}return l={pos:-98765},s.forEach(function(t,r){t&&(l.pos===t.pos?(l.count++,s[r]=e):l=t)}),l={pos:-98765},s.forEach(function(t,r){t&&(t.pos-l.pos<8?l.count>t.count?(l.count+=t.count,s[r]=e):(t.count+=l.count,s[i]=e,l=t,i=r):(l=t,i=r))}),s=s.filter(function(e){return e}),a=s.length,a>1&&(s[0].pos<o+4&&(s[0].pos=o),s[0].pos!==o&&(s.unshift({pos:o,count:0}),a++),isNaN(n)||(a--,n-s[a].pos<4&&(s[a].pos=n),s[a].pos!==n&&s.push({pos:n,count:0}))),s}function n(e,t,r){var o=0,n=r.length;c.sort(function(t,r){return t.pxRect[e]-r.pxRect[e]}),c.forEach(function(a){for(var i=a.pxRect[e];n>o&&r[o].pos<i;)o++;(o>=n||o>0&&i-r[o-1].pos<r[o].pos-i)&&--o,a.cell[t]=o})}var a,i,l,s,c,u,d,h,p=this,f=p.report.viewer,g=p.getTableColEdges,m=p.getMergedColumns?p.getMergedColumns():0,C=[],b=[];if(c=p.Controls.items.filter(function(e){return e.cell={control:e},e.Visible}),i=c.length,u=o("top","bottom",0,r),l=u.length-1,g?(d=p.getTableColEdges(),s=d.length-1,8>s&&(h=o("left","right",0,t),h.length>2*s&&(d=h,g=e))):d=o("left","right",0,t),s=d.length-1,!g)for(p.tableCols=[],a=0;s>a;)p.tableCols.push(d[a+1].pos-d[a++].pos);for(n("top","beginRow",u),n("bottom","endRow",u),n("left","beginCol",d),n("right","endCol",d),c.forEach(function(e){var t=e.cell;t.endCol<=t.beginCol&&t.endCol<s&&t.endCol++,t.endRow<=t.beginRow&&t.endRow<l&&t.endRow++}),a=0;l>a;)b.push({section:p,pxHeight:u[a+1].pos-u[a++].pos,cells:[]});for(c=c.filter(function(e){var t=e.cell;return t.beginCol<t.endCol&&t.beginRow<t.endRow}),c.sort(function(e,t){var r=e.cell.beginRow-t.cell.beginRow;return r?r:e.cell.beginCol-t.cell.beginCol}),a=0;l>a;a++)h=[],h.length=s,C.push(h);m&&m.forEach(function(e){var t=e.index;C.forEach(function(e){e[t]=1})}),a=0,c.forEach(function(e){for(var t,r,o=e.cell,n=C[o.beginRow];o.beginCol<o.endCol&&n[o.beginCol];)o.beginCol++;for(;o.endCol>o.beginCol&&n[o.endCol-1];)o.endCol--;if(o.beginCol<o.endCol){for(t=o.beginRow;t<o.endRow;t++)for(r=o.beginCol;r<o.endCol;r++)C[t][r]=1;n[o.beginCol]=e,a++}}),1===f.options.controlPosition||m||i&&a/i>.8?(C.forEach(function(e,t){var r,o,n,a=b[t].cells;r=o=0;do{for(;s>o&&!e[o];)o++;for(o>r&&(a.push({beginCol:r,endCol:o}),r=o);s>o&&1===e[o];)o++;r=o,s>r&&(n=e[r])&&(n=n.cell,a.push(n),r=o=n.endCol)}while(s>o)}),p.tableRows=b):(delete p.tableCols,delete p.tableRows,p.Controls.items.forEach(function(e){delete e.cell}))},unprepare:function(){var e=this;Ie.prototype.unprepare.call(e),e.Controls.unprepare()},doGenerate:function(e){var t=this,r=t.report.viewer;e=new ee(t.tableRows?"table":"div",e),t.addElementEventClass(e),e.addClass(r.selectSection(t)),t.tableRows?(e.addStyle("border-collapse","collapse"),t.generateTableRows(e)):(e.addStyle("position","relative"),t.Controls.generate(e))},generateTableRows:function(e,t){var r,o,n=this,a=n.report,i=a.viewer,l=n.owner!==a||a.reportFitWidth,s=n.tableCols,c=0;s&&(r=new ee("colgroup",e),l&&(e.addStyle("width","100%"),s.forEach(function(e){c+=e})),s.forEach(function(e){o=new ee("col",r),o.skipend=1,o.addStyle("width",l?C(100*e/c):m(e))})),n.tableRows.forEach(function(r,o){function a(e){e.ContentCell.generate(l),e.mergingElement=l.children[l.children.length-1],e.ContentCell.getUsingFont()!==n.getUsingFont()&&e.mergingElement.addClass(i.selectFont2(e.ContentCell.getUsingFont())),e.ContentCell.BackColor!==n.BackColor&&e.mergingElement.addBackColorStyle(e.ContentCell.BackColor),e.mergedHeader.todoMerge=0}var l;l=new ee("tr",e),l.addClass(i.selectSection(r)),r.cells.forEach(function(e){var r,n,s,c=e.control;if(!o&&t)for(;(s=t[0])&&s.index<=e.beginCol;)a(s),t.shift();r=new ee("td",l),n=e.endCol-e.beginCol,n>1&&r.addAttribute("colspan",n+""),e.endRow&&(n=e.endRow-e.beginRow,n>1&&r.addAttribute("rowspan",n+""),c.Visible&&(13!==c.ControlType?(r.addClass(i.selectControl(c)),c.Font.font&&r.addClass(i.selectFont(c.Font.font,c.defaultFontStyle))):r.addStyle("padding","0px"),c.generateInCell(r)))}),!o&&t&&t.forEach(function(e){a(e)})})},getRect:function(){var e=this;return new J(0,0,e.report.getReportWidth(),e.pxHeight)},getSingleHidableSR:function(){var t=this,r=t.Controls.items,o=r[0];return 1===r.length&&9===o.ControlType&&o.HideOnRecordsetEmpty?o:e},inDynamicRow:function(){return 0}},V(Oe,Ie);var Ge=function(e){var t=this;Oe.call(t,e),t.Name=""};Ge.prototype={},V(Ge,Oe);var ke=function(e){var t=this;Oe.call(t,e),t.Name=""};ke.prototype={},V(ke,Oe);var He=function(e){var t=this;Ie.call(t,e),t.Height=t.report.cm2Size(.58)};He.prototype={defaultHeight:function(){return.58}},V(He,Ie);var je=function(e){var t=this;He.call(t,e),t.ContentCells=new le(t),t.AlternatingBackColor=t.BackColor};je.prototype={afterLoad:function(e){var t=this;He.prototype.afterLoad.call(t,e),e[t.getJsonMember("AlternatingBackColor")]?h(t,"AlternatingBackColor",t.report.viewer.alpha.background):t.AlternatingBackColor=t.BackColor,t.ContentCells.loadFromJSON(e.ColumnContentCell)},prepare:function(){var e,t=this,r=t.report.viewer;He.prototype.prepare.call(t),t.defaultStyle=r.selectSectionItem(t),t.AlternatingBackColor!==t.BackColor&&(e=t.BackColor,t.BackColor=t.AlternatingBackColor,t.altSectionStyle=r.selectSectionItem(t),t.BackColor=e),t.ContentCells.prepare()},generate:function(e,t){var r=this;r.owner.Recordset.MoveTo(t),He.prototype.generate.call(r,e)},doGenerate:function(e){var t=this,r=t.report.viewer,o=t.owner,n=o.Recordset.RecordNo;e=new ee("tr",e),t.addElementEventClass(e),e.addAttribute(a.CONTENT_RECNO,n+""),t.altSectionStyle&&n%2?(t._BackColor=t.BackColor,t._defaultStyle=t.defaultStyle,t.BackColor=t.AlternatingBackColor,t.defaultStyle=t.altSectionStyle,e.addClass(r.selectSection(t)),t.BackColor=t._BackColor,t.defaultStyle=t._defaultStyle):e.addClass(r.selectSection(t)),o.showingColumns.forEach(function(t){o.hasMergedColumn&&t.mergedHeader?t.mergedHeader.todoMerge&&(t.ContentCell.generate(e),t.mergingElement=e.children[e.children.length-1]):t.ContentCell.generate(e)}),o.hasMergedColumn&&o.Groups.forEach(function(e){e.Header.todoMerge&&(e.Header.todoMerge=0)})},getSingleHidableSR:function(){for(var t,r,o=this,n=o.ContentCells.items,a=n.length,i=0,l=0;a>i;)t=n[i++],t._freeCell&&(l+=t.Controls.Count,1===l&&(r=t.Controls.Item(1)));return 1===l&&9===r.ControlType&&r.HideOnRecordsetEmpty?r:e},SetCellsBackColor:function(e){this.ContentCells.forEach(function(t){t.BackColor=e})},SetCellsForeColor:function(e){this.ContentCells.forEach(function(t){t.setForeColor(e)})}},V(je,He);var _e=function(t){var r=this;He.call(r,t),r.TitleCells=new ie(r,e)};_e.prototype={afterLoad:function(e){var t=this;He.prototype.afterLoad.call(t,e),t.TitleCells.loadFromJSON(e.ColumnTitleCell)},prepare:function(){function e(t){var n=1;return t.showingItems=[],t.forEach(function(a){var i,l,s;a.layer=o,a.GroupTitle?a.Visible&&(o++,i=e(a.SubTitles)+1,o--,l=a.SubTitles.showingItems,l.length>0&&(t.showingItems.push(a),i>n&&(n=i),a.colspan=0,l.forEach(function(e){a.colspan+=e.colspan}))):(s=a.Column,s.Visible&&s.pxWidth>0&&(t.showingItems.push(a),a.colspan=1,s.pxLeft=r.columnsTotalWidth,s.index=r.showingColumns.length,r.columnsTotalWidth+=s.pxWidth,r.showingColumns.push(s)))}),n}var t=this,r=t.owner,o=0;He.prototype.prepare.call(t),r.columnsTotalWidth=0,r.showingColumns=[],t.layerCount=e(t.TitleCells),t.pxHeight/=t.layerCount,t.TitleCells.prepare(),t.defaultStyle=t.report.viewer.selectSectionItem(t)},unprepare:function(){},doGenerate:function(e){function t(e){e.forEach(function(e){e.layer===o.generatingLayer&&e.generate(r),e.GroupTitle&&t(e.SubTitles.showingItems)})}var r,o=this,n=o.report.viewer;for(o.pxHeight/=o.layerCount,o.generatingLayer=0;o.generatingLayer<o.layerCount;)r=new ee("tr",e),o.addElementEventClass(r),r.addClass(n.selectSection(o)),t(o.TitleCells.showingItems),o.generatingLayer++},FindColumnTitlesOfTitleCell:function(t){function r(t,o){var n,a,i,l=t.items.length;for(n=0;l>n;n++){if(a=t.items[n],a===o)return t;if(a.GroupTitle&&(i=r(a.SubTitles,o)))return i}return e}return r(this.TitleCells,t)},SetCellsBackColor:function(e){function t(r){r.forEach(function(r){r.BackColor=e,r.GroupTitle&&t(r.SubTitles)})}t(this.TitleCells)},SetCellsForeColor:function(e){function t(r){r.forEach(function(r){r.setForeColor(e),r.GroupTitle&&t(r.SubTitles)})}t(this.TitleCells)}},V(_e,He);var We=function(e){var t=this;Oe.call(t,e),t.Height=t.report.cm2Size(1.2)};We.prototype={generate:function(e,t){var r=this,o=r.owner;o.recordset.MoveTo(t),o.owner.Recordset.MoveTo((r===o.Header?o.beginNoField:o.endNoField).Value),Oe.prototype.generate.call(r,e)},doGenerate:function(t){function r(e){var t=n.owner,r=n===t.Header?a.GROUPH_INDEX:a.GROUPF_INDEX;e.addAttribute(a.GROUP_RECNO,t.recordset.recordNo),e.addAttribute(r,t.index)}var o,n=this,i=n.report.viewer,l=n.owner.owner,s=l.showingColumns,c=s.length;l.hasMergedColumn&&(o=[],s.forEach(function(e){e.mergedHeader&&e.mergedHeader.todoMerge&&(n.owner.Footer!==n||n.owner===l.Groups.Item(l.Groups.Count)&&e.mergedHeader!==n.owner.Header)&&o.push(e)}),o.length||(o=e)),n.tableRows&&!n.tableCols?(n.generateTableRows(t,o),t.children.slice(-n.tableRows.length).forEach(function(e){n.addElementEventClass(e),r(e)})):(t=new ee("tr",t),t.addClass(i.selectSection(n)),n.addElementEventClass(t),r(t),t=new ee("td",t),c>1&&t.addAttribute("colspan",c),n.tableCols?(t=new ee("table",t),t.addClass(i.selectSection(n)),t.addStyle("border-collapse","collapse"),n.generateTableRows(t)):(t.addStyle("position","relative"),n.Controls.generate(t)))},prepare:function(){var e=this;!e.groupMergedColumns&&Oe.prototype.prepare.call(e)},getTableColEdges:function(){var e,t=this.owner.owner.showingColumns;return e=t.map(function(e){return{pos:e.pxLeft,count:1}}),e.push({pos:t[t.length-1].pxRight,count:1}),e},getMergedColumns:function(){var e,t,r=this;return e=r.owner.index,t=r.owner.owner.showingColumns.filter(function(t){var o,n,a=t.mergedHeader;return a&&((n=(o=a.owner).index)<e||n===e&&r===o.Footer&&o.Header.IncludeFooter)}),0===t.length&&(t=0),t},getParentBackColor:function(e){return this.owner.owner.BackColor},getParentFont:function(){return this.owner.owner.Font},inDynamicRow:function(){return 1}},V(We,Oe);var Ue=function(e){var t=this;We.call(t,e),t.OccupiedColumns="",t.OccupyColumn=!1,t.SameAsColumn=!0,t.IncludeFooter=!1,t.VAlign=1};Ue.prototype={afterLoad:function(e){var t=this;We.prototype.afterLoad.call(t,e),u(t,"VAlign",n.OCGroupHeaderVAlign)},prepare:function(){var e,t=this;t.OccupiedColumns&&(e=t.owner.owner.Columns.decodeItems(t.OccupiedColumns),e=e.filter(function(e){return e.Visible}),e.length>0&&(t.groupMergedColumns=e,e.forEach(function(e){e.mergedHeader=t,t.owner.owner.hasMergedColumn=1}))),We.prototype.prepare.call(t)},unprepare:function(){},generate:function(e,t){var r=this;r.groupMergedColumns?(r.curItemBegin=e.children?e.children.length:0,r.todoMerge=1):We.prototype.generate.call(r,e,t)},get Group(){return this.owner}},V(Ue,We);var ze=function(e){We.call(this,e)};ze.prototype={generate:function(e,t){var r,o=this,n=o.owner.Header,a=n.groupMergedColumns;We.prototype.generate.call(o,e,t),a&&(r=e.children.length-n.curItemBegin,!n.IncludeFooter&&o.isToGenerate()&&r--,r>1&&a.forEach(function(e){e.mergingElement&&e.mergingElement.addAttribute("rowspan",r+"")}))},get Group(){return this.owner}},V(ze,We);var Je=function(t){var r=this;pe.call(r,t),r.FieldType=1,r._name="",r._dbFieldName="",r._tableMember=e,r.Format="",r.Length=0,r.RTrimBlankChars=!1,r.GetDisplayTextScript=""};Je.prototype={afterLoad:function(e){var t,r=this;t=e[r.getJsonMember("Type")],t&&(r.FieldType=t),t=e[r.getJsonMember("Name")],t&&(r.Name=t),t=e[r.getJsonMember("DBFieldName")],t&&(r.DBFieldName=t),u(r,"FieldType",n.FieldType)},prepare:function(){var e=this,t=e.FieldType;6===t?e.formater=new l.DateTimeFormatter(e.Format):5===t?e.formater=new l.BooleanFormatter(e.Format):2!==t&&3!==t&&4!==t||(e.formater=new l.NumericFormatter(e.Format))},unprepare:function(){delete this.formater},isNumeric:function(){var e=this.FieldType;return 2===e||3===e||4===e},get Value(){var t=this,r=t.owner.curRecord;return r?r[t._tableMember]:e},set Value(t){var r=this,o=r.owner.curRecord;if(o){if(t!==e&&null!==t)switch(r.FieldType){case 2:case 3:case 4:t=+t;break;case 5:t=S(t);break;case 6:t=T(t);break;default:t+=""}else t=e;o[r._tableMember]=t}},get AsBoolean(){return S(this.Value)},set AsBoolean(e){this.Value=e},get AsCurrency(){return+this.Value},set AsCurrency(e){this.Value=e},get AsDateTime(){return b(this.Value)},set AsDateTime(e){this.Value=e},get AsFloat(){var e,t=this;if(6===t.FieldType){var r=new z;r.value=t.Value,e=r.AsFloat}else e=+t.Value;return isNaN(e)?0:e},set AsFloat(e){var t,r=this;6===r.FieldType&&(t=new z,t.AsFloat=e,e=t.value),r.Value=e},get AsInteger(){return Math.floor(this.AsFloat)},set AsInteger(e){this.AsFloat=Math.floor(+e)},get AsString(){var e=this;return e.IsNull?"":e.Value+""},set AsString(e){this.Value=e},get DisplayText(){var e=this,t=e.FieldType,r=e.Value;return e.displayTextAssigned=0,e.doingGetDisplayText||(e.doingGetDisplayText=1,e.report.fireFieldGetDisplayText(e),e.doingGetDisplayText=0),e.displayTextAssigned?e.assignedDisplayText:e.IsNull?"":1===t||7===t?r+"":e.formater.format(r)},set DisplayText(e){var t=this;t.assignedDisplayText=e+"",t.displayTextAssigned=1},get IsNull(){var t=this.Value;return t===e||null===t},get DataSize(){return 0},get DataBuffer(){return e},get Name(){return this._name},set Name(e){var t=this;t._tableMember&&t._tableMember!==t._name||(t._tableMember=e),t._name=e},get DBFieldName(){return this._name},set DBFieldName(e){var t=this;t._dbFieldName=e,e&&(t._tableMember=e)},get RunningDBField(){var e=this;return e._dbFieldName||e._name},Clear:function(){this.Value=e}},V(Je,pe);var Ye=function(e){var t=this;pe.call(t,e),t.QuerySQL="",t.Fields=new se(t),t.SortAsc=!0,t.SortCaseSensitive=!1,t.SortFields="",t.XmlTableName="",t.FetchRecordScript="",t.BeforePostRecordScript="",t.ProcessRecordScript="",t._dataTable=[],t.recordNo=0};Ye.prototype={children:["Fields"],afterLoad:function(e){this.Fields.loadFromJSON(e.Field)},attachDataTable:function(e){var t=this;t._dataTable=e,t.MoveTo(0)},prepareTableData:function(){function t(t,r){if(t.hasOwnProperty(r))return r;r=r.toUpperCase();for(name in t)if(r===name.toUpperCase())return name;return e}var r,o,n,a,i,l=this,s=l._dataTable,c=l.Fields.items,u=s.length,d=c.length;if(DEBUG)for(;d--;)o=c[d];for(;u--;)for(r=s[u],d=c.length;d--;){if(o=c[d],i=o._fts,a=o._tableMember,i===e&&(a=t(r,a))){switch(o.FieldType){case 1:i="string"!=typeof r[a];break;case 2:case 3:case 4:i="number"!=typeof r[a];break;case 5:i="boolean"!=typeof r[a];break;case 6:i=!Date.prototype.isPrototypeOf(r[a]);break;default:i=!1}o._fts=i,o._tableMember=a}if(n=r[a],null!==n&&""!==n||(n=e,r[a]=n),i&&n!==e&&r.hasOwnProperty(a))switch(o.FieldType){case 1:r[a]=n+"";break;case 2:case 3:case 4:r[a]=+n;break;case 5:r[a]=S(n);break;case 6:r[a]=v(n)}}l.SortFields&&l.Resort(l.SortFields,l.SortAsc,l.SortCaseSensitive)},prepare:function(){var e=this,t=e._dataTable,r=t.length,o=0;if(e.Fields.prepare(),e.prepareTableData(),e.isDetailGridRecordset()){for(;r>o;)e.MoveTo(o++),e.report.fireBeforePostRecord();e.MoveTo(0)}},unprepare:function(){this.Fields.unprepare()},decodeFields:function(e){return this.Fields.decodeItems(e)},isDetailGridRecordset:function(){var e=this;return e.owner===e.report.DetailGrid},isAppendingRecord:function(){return 1===this.editStatus},keepValue:function(){var e=this;e.keepedRecord=e.curRecord},fieldsKeepedValueChanged:function(t){var r=this;return t.some(function(t){var o=t._tableMember,n=r.keepedRecord[o],a=r.curRecord[o];return a>n||n>a||(n===e||a===e)&&n!==a})},sortRecords:function(t,r){for(var o=this,n=o._dataTable,a=n.length,i=0,l=[];a>i;)l.push(i++);return t.length>0&&(t.forEach(function(e){e.fieldName=e.field._tableMember}),l.sort(function(r,o){var a;return t.some(function(t){var i=n[r][t.fieldName],l=n[o][t.fieldName];return i!==e&&l!==e?1===t.field.FieldType?(t["case"]||(i=i.toUpperCase(),l=l.toUpperCase()),a=i.localeCompare(l)):a=l>i?-1:i>l?1:0:a=i===e&&l===e?0:i===e?-1:1,t.asc||(a=-a),a}),a})),r?l:(i=[],l.forEach(function(e){i.push(n[e])}),o._dataTable=i,void o.MoveTo(0))},get RecordCount(){var e=this;return e._dataTable?e._dataTable.length:0},get RecordNo(){return this.recordNo},FieldByName:function(e){return this.Fields.itemByName(e)},FieldByDBName:function(t){var r,o=this.Fields.items,n=o.length;for(t=t.toUpperCase(),r=0;n>r;r++)if(o[r].RunningDBField.toUpperCase()===t)return o[r];return e},Append:function(){var e=this;e.editStatus=1,e.recordNo=e._dataTable.length,e.curRecord={}},Edit:function(){var t,r,o=this,n=o.Fields.items,a=n.length,i=o.curRecord,l={};if(o.recordNo>=0&&o.recordNo<o._dataTable.length){for(o.editStatus=2;a--;)t=n[a],r=t._tableMember,i[r]!==e&&(6===t.FieldType?l[r]=T(i[r]):l[r]=i[r]);o.curRecord=l}},Cancel:function(){var e=this;e.editStatus&&(1===e.editStatus?e.Last():e.curRecord=e._dataTable[e.recordNo],e.editStatus=0)},Post:function(){var e=this;e.editStatus&&(e.isDetailGridRecordset()&&e.report.fireBeforePostRecord(),1===e.editStatus?e._dataTable.push(e.curRecord):e._dataTable[e.recordNo]=e.curRecord,e.editStatus=0)},First:function(){this.MoveTo(0)},Next:function(){var e=this;e.MoveTo(e.recordNo+1)},Prior:function(){var e=this;e.MoveTo(e.recordNo-1)},Last:function(){var e=this;e.MoveTo(e._dataTable.length-1)},MoveBy:function(e){var t=this;t.MoveTo(t.recordNo+e)},Bof:function(){var e=this;return e.recordNo<0||!e._dataTable.length},Eof:function(){var e=this;return e.recordNo>=e._dataTable.length},MoveTo:function(e){var t=this,r=t._dataTable;t.recordNo=e,t.curRecord=r[Math.min(Math.max(0,e),r.length-1)]},Empty:function(){this.attachDataTable([])},AddField:function(e,t){var r=this.Fields.Add();return r.Name=e,r.FieldType=t,r},RemoveAllFields:function(){this.Fields.RemoveAll()},Resort:function(e,t,r){function o(){var o=[],n=e.split(";");return n.forEach(function(e){function n(e){e=e.trim().toUpperCase(),"ASC"===e?l.asc=!0:"DESC"===e?l.asc=!1:"CASE"===e?l["case"]=!0:"CASEIN"===e&&(l["case"]=!1)}var a,l={};e=e.trim(),a=e.split(" "),a[0]=a[0].trim(),l.field=i.Fields.Item(a[0]),l.field&&(l.asc=t,l["case"]=r,a.length>1&&n(a[1]),a.length>2&&n(a[2]),o.push(l))}),o}var n,a,i=this,l=[];e&&(n=o(),a=n.length,a>0&&(i.report.fireBeforeSort(e,i),i.isDetailGridRecordset()&&(i.owner.Groups.forEach(function(e){i.decodeFields(e.ByFields).forEach(function(e){l.indexOf(e)<0&&l.push(e)})}),n.forEach(function(e){var t=l.indexOf(e.field);0>t?l.push(e):l[t]=e}),l.forEach(function(e,o){e.field||(l[o]={field:e,asc:t,"case":r})}),n=l,a=n.length)),i.sortRecords(n,0))}},V(Ye,pe);var Xe=function(e){var t=this;pe.call(t,e),t.Name="",t.Visible=!0,t.FixedWidth=!1,t.Width=t.report.cm2Size(3)};Xe.prototype={prepare:function(){var e=this;e.pxWidth=e.report.size2Pixel(e.Width)},get pxRight(){var e=this;return e.pxLeft+e.pxWidth}},V(Xe,pe);var Ze=function(e){var t=this;pe.call(t,e),t.Header=new Ue(t),t.Footer=new ze(t),t.Name="",t.ByFields="",t.SortSummaryBox="",t.SortAsc=!1,t.GroupBeginScript="",t.GroupEndScript=""};Ze.prototype={children:["Header","Footer"],afterLoad:function(e){var t=this;t.Header.loadFromJSON(e.GroupHeader),t.Footer.loadFromJSON(e.GroupFooter)},prepare:function(e){function t(e){e.forEach(function(e){function o(e){function n(e){var t,o,n,a=r.summaryItems.length+"",i="";r.summaryItems.push(e),e.SummaryFun?(e.value=0,28===e.SummaryFun&&(t=r.owner.Groups.indexOf(r),t>0&&(o=new U,o.SummaryFun=-1,o.init(),r.owner.Groups.items[t-1].summaryItems.push(o))),e.displayField?(n=e.displayField.FieldType,i=e.displayField.Format):n=18===e.SummaryFun||19===e.SummaryFun?1:3):(n=e.oParameter.DataType,i=e.oParameter.Format),e.valueField=r.recordset.AddField(a,n),e.valueField.Format=i}var a=e.ControlType;5===a?n(e):8===a?(e.getSummaryExpFields().forEach(function(e){n(e)}),e.getParameterExpFields().forEach(function(e){n(e)})):1===a?e.oParameter&&n(e):13===a&&e.cells.forEach(function(e){e.forEach(function(e){e.FreeCell?t(e.Controls):o(e)})})}o(e)})}var r=this;r.index=e,r.Header.prepare(),r.Footer.prepare(),r.oByFields=r.owner.Recordset.decodeFields(r.ByFields),r.SortSummaryBox&&(r.sortSummaryBoxObj=r.Footer.Controls.itemByName(r.SortSummaryBox),r.sortSummaryBoxObj||(r.sortSummaryBoxObj=r.Header.Controls.itemByName(r.SortSummaryBox)),r.sortSummaryBoxObj&&5!==r.sortSummaryBoxObj.ControlType&&delete r.sortSummaryBoxObj),r.recordset=new Ye(r),r.beginNoField=r.recordset.AddField("b",2),r.endNoField=r.recordset.AddField("e",2),r.groupItemNo=0,r.summaryItems=[],t(r.Header.Controls),t(r.Footer.Controls),r.recordset.prepare()},unprepare:function(){},inphaseByDetail:function(e){var t=this,r=t.recordset;if(!r.isAppendingRecord()&&r.RecordCount){for(;t.beginNoField.Value>e&&!r.Bof();)r.Prior();for(;t.endNoField.Value<e&&!r.Eof();)r.Next()}},get Parent(){return this.owner}},V(Ze,pe);var qe=function(e){var t=this;pe.call(t,e),t.FixCols=0,t.BackColor=e.BackColor,t.ShowColLine=!0,t.ShowRowLine=!0,t.Font=new q(e.Font),t.Border=new X(15),t.ColLinePen=new Y,t.RowLinePen=new Y,t.Recordset=new Ye(t),t.ColumnContent=new je(t),t.ColumnTitle=new _e(t),t.Columns=new ae(t),t.Groups=new ce(t)};qe.prototype={children:["Border","ColLinePen","RowLinePen","Recordset","Groups"],afterLoad:function(e){var t=this,r=t.report.viewer.alpha,o=t.report.isWR;h(t,"BackColor",r.background),t.Border.loadFromJSON(e.Border,r.border,o),t.ColLinePen.loadFromJSON(e.ColLine,r.stroke,o),t.RowLinePen.loadFromJSON(e.RowLine,r.stroke,o),t.Font.loadFromJSON(e.Font,o),t.Recordset.loadFromJSON(e.Recordset),t.Groups.loadFromJSON(e.Group),t.Columns.loadFromJSON(e.Column),t.ColumnContent.loadFromJSON(e.ColumnContent),t.ColumnTitle.loadFromJSON(e.ColumnTitle),t.IsCrossTab=e[t.getJsonMember("IsCrossTab")],t.IsCrossTab&&t.CrossTab.loadFromJSON(e.CrossTab)},assign:function(e){function t(e,o){o.forEach(function(o){var n;o.GroupTitle?(n=e.AddGroup("",""),n.assign(o),t(n.SubTitles,o.SubTitles)):(n=r.Columns.addTo(e),n.assign(o.Column),n.TitleCell.assign(o),n.ContentCell.assign(o.Column.ContentCell))})}var r=this;pe.prototype.assign.call(r,e),r.ColumnContent.assign(e.ColumnContent),r.ColumnTitle.assign(e.ColumnTitle),t(r.ColumnTitle.TitleCells,e.ColumnTitle.TitleCells),r.IsCrossTab=e.IsCrossTab,r.IsCrossTab&&r.CrossTab.assign(e.CrossTab)},attachData:function(){function e(t){t.forEach(function(t){t.attachData(),t.GroupTitle&&e(t.SubTitles)})}var t=this;t.Recordset.prepare(),t.ColumnContent.ContentCells.forEach(function(e){e.attachData()}),e(t.ColumnTitle.TitleCells),t.Groups.forEach(function(e){e.Header.Controls.attachData(),e.Footer.Controls.attachData()})},buildColumnsOrder:function(){function e(t){t.forEach(function(t){t.GroupTitle?e(t.SubTitles):(t.Column.orderNo=r.length,r.push(t.Column))})}var t=this,r=[];e(t.ColumnTitle.TitleCells),t.Columns.items=r},beginGroupItem:function(e){var t=this;t.rows.push({header:e.Header,recordNo:e.groupItemNo}),e.recordset.Append(),e.beginNoField.Value=t.Recordset.recordNo,e.groupRecordCount=0,e.summaryItems.forEach(function(e){e.SummaryFun&&e.beginSummaryValue()}),t.report.fireGroupBegin(e)},endGroupItem:function(t){var r=this,o=r.report;r.rows.push({footer:t.Footer,recordNo:t.groupItemNo++}),t.summaryItems.forEach(function(e){e.SummaryFun&&e.endSummaryValue()}),t.summaryItems.forEach(function(t){var r=t.SummaryFun;r?-1!==r&&t.value!==e&&(t.valueField.AsFloat=t.value):t.valueField.Value=t.oParameter.Value}),o.fireGroupEnd(t),o.DetailGrid.CrossTab&&o.DetailGrid.CrossTab.GroupEndProcess(t),t.endNoField.Value=r.Recordset.recordNo,t.recordset.Post()},prepare:function(){function e(r){r.forEach(function(r){function o(r){var n=r.ControlType;5===n?t.globalSummaryItems.push(r):8===n?ye.prototype.getSummaryExpFields.call(r).forEach(function(e){t.globalSummaryItems.push(e)}):13===n&&r.cells.forEach(function(t){t.forEach(function(t){t.FreeCell?e(t.Controls):o(t)})})}o(r)})}var t=this,r=t.report;t.CrossTab?(t.buildColumnsOrder(),t.CrossTab.prepare()):(t.Columns.prepare(),t.ColumnContent.prepare(),t.ColumnTitle.prepare(),t.Groups.forEach(function(e,t){e.prepare(t)}),t.globalSummaryItems=[],r.ReportHeaders.items.concat(r.ReportFooters.items).forEach(function(t){e(t.Controls)}))},unprepare:function(){var e=this;e.CrossTab&&e.CrossTab.unprepare()},generate:function(e){function t(){var e=n.ownerReport,t=l.options.detailgridResize;return 1===t||2===t&&window.innerWidth&&o.width<window.innerWidth&&(!e||e.owner._singleSR)}var r,o=this,n=o.report,i=o.Recordset,l=n.viewer,s=l._detailgrids,c=new ee("table",e),u=new ee("colgroup",c),d=new ee("thead",c),h=new ee("tbody",c);c.addClass(a.DG_CSS),c.addAttribute("id",a.DG_ID+s.length),s.push(o),i._relTblIndex>=0&&c.addAttribute("_grrelTblIndex",i._relTblIndex),o.Font.font&&c.addClass(l.selectFont2(o.Font.font)),c.getStyles().addBorder(o.Border),c.addStyle("border-collapse","collapse"),c.addStyle("width",t()?"100%":m(o.width)),o.toFillBack()&&c.addBackColorStyle(o.BackColor),o.showingColumns.forEach(function(e){r=new ee("col",u),r.skipend=1,r.addStyle("width",C(100*e.pxWidth/o.columnsTotalWidth))}),o.ColumnTitle.generate(d),o.generatingRowNo=1,o.rows.forEach(function(e,t){var r;e.header?(r=e.header,r.generate(h,e.recordNo)):e.footer?(r=e.footer,r.generate(h,e.recordNo)):(r=o.ColumnContent,r.generate(h,e)),r.Visible&&r.Height>0&&++o.generatingRowNo})},buildRows:function(){function e(e){e.summaryItems.forEach(function(e){e.SummaryFun&&e.summaryCurRecord()}),e.groupRecordCount++}function t(e){function t(){var t,r=l.length,o=e.owner.rows,n=[];1>=r||(t=l[0].beginRowNo,l.forEach(function(t){e.recordset.MoveTo(t.groupItemNo),t.sortValue=e.sortSummaryBoxObj.valueField.AsFloat}),l.sort(function(t,r){return e.SortAsc?t.sortValue-r.sortValue:r.sortValue-t.sortValue}),l.forEach(function(e){n=n.concat(o.slice(e.beginRowNo,e.endRowNo))}),n.forEach(function(e){o[t++]=e}))}var r,o,n,a=e.owner.rows,i=a.length,l=[];for(r=0;i>r;){for(n={},o=a[r],o.footer&&o.footer.owner.index<e.index&&(t(),l=[],r++);i>r;)if(o=a[r++],o.header&&o.header.owner.index===e.index){n.beginRowNo=r-1,n.groupItemNo=o.recordNo;break}for(;i>r;)if(o=a[r++],o.footer&&o.footer.owner.index===e.index){n.endRowNo=r,l.push(n);break}}t()}var r,o,n,a=this,i=a.report,l=a.Recordset,s=a.Groups.items,c=s.length,u=0;for(a.rows=[],a.globalSummaryItems.forEach(function(e){e.beginSummaryValue()}),l.First(),l.keepValue(),s.forEach(function(e){a.beginGroupItem(e)});!l.Eof();){for(r=0;c>r&&!l.fieldsKeepedValueChanged(s[r].oByFields);r++);if(c>r){for(l.Prior(),o=c-1;o>=r;o--)a.endGroupItem(s[o]);for(l.Next(),o=r;c>o;o++)a.beginGroupItem(s[o])}i.fireProcessRecord(l),s.forEach(function(t){e(t)}),a.globalSummaryItems.forEach(function(e){e.summaryCurRecord()}),a.rows.push(l.recordNo),l.keepValue(),l.Next()}for(i.fireProcessEnd(),o=c-1;o>=0;o--)a.endGroupItem(s[o]);a.globalSummaryItems.forEach(function(e){e.endSummaryValue()}),s.forEach(function(e){e.sortSummaryBoxObj&&(t(e),u=1)}),u&&(n=[],o=0,a.sortedTable=[],s.forEach(function(e){e.sortedTable=[],e.groupItemNo=0}),a.rows.forEach(function(e){var t;e.header?(t=e.header.owner,t.recordset.MoveTo(e.recordNo),t.recordset.Edit(),t.beginNoField.Value=o,e.recordNo=t.groupItemNo):e.footer?(t=e.footer.owner,t.endNoField.Value=o,t.recordset.Post(),t.sortedTable.push(t.recordset._dataTable[e.recordNo]),e.recordNo=t.groupItemNo++):(a.sortedTable.push(l._dataTable[e]),e=o++),n.push(e)}),a.rows=n,l.attachDataTable(a.sortedTable),delete a.sortedTable,s.forEach(function(e){e.recordset.attachDataTable(e.sortedTable),delete e.sortedTable}))},onmousedown:function(e){function t(){var t,r,o,n=e.target;if("TABLE"===n.tagName.toUpperCase())return 0;for(;!o;){if(r&&(n=r.parentNode.parentNode.parentNode),t=n.tagName.toUpperCase(),"TH"===t)return 0;for(;"TD"!==t;)if(n=n.parentNode,t=n.tagName.toUpperCase(),"TH"===t)return 0;r=n.parentNode,o=r.hasAttribute(a.CONTENT_RECNO)||r.hasAttribute(a.GROUP_RECNO)}return n}function r(){var t,r=e.target,o=e.currentTarget,n=r.tagName.toUpperCase();if("TH"===n||"TABLE"===n)return 0;for(;o!==t;){if(t&&(r=t.parentNode),n=r.tagName.toUpperCase(),"TH"===n)return 0;for(;"TD"!==n;)if(r=r.parentNode,n=r.tagName.toUpperCase(),"TH"===n)return 0;t=r.parentNode.parentNode.parentNode}return r}function o(t){var r=i.report.viewer.options,o=t.parentNode,n=r.selectionCell?t:o;o.parentNode.parentNode===e.currentTarget&&r.selectionHighlight&&i.curSelObj!==n&&(i.curSelObj&&i.curSelObj.classList.remove(a.SH_CSS),n.classList.add(a.SH_CSS),i.curSelObj=n),i.clickedCell=t}function n(e){function t(e){var t=n.parentNode.parentNode;t.hasAttribute("_grrelTblIndex")&&i.report.ownerSR.attachRelationTable2(t.getAttribute("_grrelTblIndex")),i.Recordset.MoveTo(e)}var r,o,n=e.parentNode;n.hasAttribute(a.CONTENT_RECNO)?t(n.getAttribute(a.CONTENT_RECNO)):n.hasAttribute(a.GROUP_RECNO)&&(r=n.hasAttribute(a.GROUPH_INDEX),o=i.Groups.items[+n.getAttribute(r?a.GROUPH_INDEX:a.GROUPF_INDEX)],o.recordset.MoveTo(n.getAttribute(a.GROUP_RECNO)),t((r?o.beginNoField:o.endNoField).Value))}var i=this,l=t(),s=r();l&&o(l),s&&n(s)},getClickedRow:function(){var e,t,r=this,o=r.clickedCell,n={};return o&&(e=o.parentNode,e.hasAttribute(a.CONTENT_RECNO)?(n.type="content",n.recordNo=e.getAttribute(a.CONTENT_RECNO)):e.hasAttribute(a.GROUP_RECNO)&&(t=e.hasAttribute(a.GROUPH_INDEX),n.type=t?"groupheader":"groupfooter",n.groupIndex=+e.getAttribute(t?a.GROUPH_INDEX:a.GROUPF_INDEX))),n},clearColumns:function(){var e=this;e.ColumnContent.ContentCells.RemoveAll(),e.ColumnTitle.TitleCells.RemoveAll(),e.Columns.RemoveAll()},get width(){var e=this,t=e.Border;return e.columnsTotalWidth+t.getLeftWidth()+t.getRightWidth()},_ColumnMoveTo:function(e,t){var r=this,o=r.ColumnTitle.FindColumnTitlesOfTitleCell(e.TitleCell),n=t?t.SubTitles:r.ColumnTitle.TitleCells;r.MoveTitleTo(e.TitleCell,o,n,-1)},MoveTitleTo:function(e,t,r,o){t.items.splice(t.items.indexOf(e),1),0>o?r.items.push(e):r.items.splice(o,0,e)},get IsCrossTab(){return!!this.CrossTab},set IsCrossTab(e){var t=this;e?t.CrossTab||(t.CrossTab=new ft(t)):delete t.CrossTab},AddColumn:function(e,t,r,o){var n=this.Columns.Add();return n.Name=e,n.Width=o,n.ContentCell.DataField=r,n.TitleCell.Text=t,n},ClearColumns:function(){this.Columns.RemoveAll()},FindGroupTitleCell:function(e){function t(r){var o,n=r.items.length,a=r.itemByName(e);if(!a)for(o=0;n>o;o++)if(a=r.items[o],a.GroupTitle&&(a=t(a.SubTitles,e)))return a;return a}return t(this.ColumnTitle.TitleCells,e)},AddGroupTitle:function(e,t){return this.ColumnTitle.TitleCells.AddGroup(e,t)},ClearGroupTitles:function(){var e,t,r=this,o=r.Columns.Count,n=r.ColumnTitle.TitleCells,a=[];for(e=1;o>=e;e++)ColumnMoveToEnd(e);for(o=n.Count,e=0;o>e;e++)t=n.items[e],!t.GroupTitle&&a.push(t);n.items=a},ColumnMoveToEnd:function(t){var r=this,o=r.Columns.Item(t);o&&sel._ColumnMoveTo(o,e)},ColumnMoveTo:function(t,r,o){var n,a=this,i=a.Columns.Item(t),l=i?i.TitleCell:a.FindGroupTitleCell(t),s=r?a.FindGroupTitleCell(r):e,c=r?s?s.SubTitles:e:a.ColumnTitle.TitleCells;l&&c&&(n=a.ColumnTitle.FindColumnTitlesOfTitleCell(l),a.MoveTitleTo(l,n,c,o))},StartNewGroup:function(e){var t,r=this,o=r.Recordset,n=r.Groups.items,a=n.length,i=r.Groups.Item(e);if(i){for(o.Prior(),t=a-1;t>=i.index;t--)r.endGroupItem(n[t]);for(o.Next(),t=i.index;a>t;t++)r.beginGroupItem(n[t])}},ColumnByShowOrder:function(t){function r(t,o,n){var a,i,l=t.Count;for(a=0;l>a;a++)if(i=t.items[a],i.GroupTitle){if(i=r(i.SubTitles,o,n))return i}else{if(o==n)return i;o++}return e}var o=0;return r(this.ColumnTitle.TitleCells,o,t)}},V(qe,pe);var Qe=function(t){var r=this;pe.call(r,t),r.DataType=1,r.Name="",r.Format="",r.Value=e};Qe.prototype={afterLoad:function(t){var r=this;u(r,"DataType",n.ParameterDataType),r.Value!==e&&r.setValue(r.Value)},prepare:function(){var e=this;6===e.DataType?e.formater=new l.DateTimeFormatter(e.Format):5===e.DataType?e.formater=new l.BooleanFormatter(e.Format):2!==e.DataType&&3!==e.DataType||(e.formater=new l.NumericFormatter(e.Format))},unprepare:function(){delete this.formater},setValue:function(t){var r=this;if(null!==t||t!==e)switch(r.DataType){
case 2:t=Math.floor(+t);break;case 3:t=+t;break;case 5:t=S(t);break;case 6:t=v(t);break;default:t+=""}r.Value=t},get AsBoolean(){return!!this.Value},set AsBoolean(e){this.setValue(e)},get AsDateTime(){return T(this.Value)},set AsDateTime(e){this.setValue(e)},get AsFloat(){var e=this,t=e.Value;if(6===e.DataType){var r=new z;r.value=t,t=r.AsFloat}else t=+t;return isNaN(t)?0:t},set AsFloat(e){var t,r=this;6===r.DataType&&(t=new z,t.AsFloat=e,e=t.value),r.setValue(e)},get AsInteger(){return Math.floor(this.AsFloat)},set AsInteger(e){this.AsFloat=Math.floor(+e)},get AsString(){return this.Value+""},set AsString(e){this.setValue(e)},get DisplayText(){var t=this,r=t.Value;if(r===e)return"";switch(t.DataType){case 1:return r+"";default:return t.formater.format(r)}},get IsNull(){return this.Value===e},Clear:function(){this.Value=e}},V(Qe,pe);var Ke=function(t,r){var o=this;o.viewer=t,o.report=o,r&&(o.ownerSR=r),o.Font=new q(e),o.Font.font=new Z,o.Parameters=new he(o),o.ReportHeaders=new ue(o),o.ReportFooters=new de(o),o.XmlTableName="",o.Unit=1,o.CodePage=0,o.BackColor=16777215|t.alpha.background<<24,o.QuerySQL="",o.Title="",o.Author="",o.Description="",o.GlobalScript="",o.InitializeScript="",o.ProcessBeginScript="",o.ProcessEndScript="",o.BeforeSortScript="",o.Printer={DesignPaperWidth:21,DesignPaperLength:29.7,DesignPaperLeftMargin:2.5,DesignPaperRightMargin:2.5,DesignPaperOrientation:1}};Ke.prototype={loadFromJSON:function(e){var t=this,r=t.isWR,o=t.Printer,n=e.Printer;t.Clear(),c(t,e),h(t,"BackColor",t.report.viewer.alpha.background),t.Font.loadFromJSON(e.Font,r),t.Parameters.loadFromJSON(e.Parameter),t.ReportHeaders.loadFromJSON(e.ReportHeader),t.ReportFooters.loadFromJSON(e.ReportFooter),e.DetailGrid&&t.InsertDetailGrid().loadFromJSON(e.DetailGrid),e.Printer&&(n.Width&&(o.DesignPaperWidth=n.Width),n.Height&&(o.DesignPaperLength=n.Height),n.hasOwnProperty("LeftMargin")&&(o.DesignPaperLeftMargin=n.LeftMargin),n.hasOwnProperty("RightMargin")&&(o.DesignPaperRightMargin=n.RightMargin),n.Oriention&&(o.DesignPaperOrientation=2),t.Printer=o)},generateHtml:function(){function e(t,r){r&&(t.push(r.beginText()),r.children?r.children.forEach(function(r){e(t,r)}):t.push(r.innerText),t.push(r.endText()))}var t=this,r=[],o={htmlElements:[],addChild:function(e){o.htmlElements.push(e)}};return t.generate(o),o.htmlElements.forEach(function(t){e(r,t)}),r.join("")},generate:function(e){var t,r=this,o=r.ReportHeaders,n=r.ReportFooters;r.fireInitialize(),!r.ownerSR&&r.matchTables(),r.DetailGrid&&r.fireFetchRecord(),r.fireProcessBegin(),!r.ownerSR&&r.prepare(),r.singleChart?r.singleChart.generateContent(e):(t=r.RunningDetailGrid,r.reportFitHeight&&re(o.items.concat(n.items)),t&&t.buildRows(r),o.generate(e),t&&t.generate(e),n.generate(e)),!t&&r.fireProcessEnd()},matchTables:function(){function e(e,t){function r(e){function t(e,t){var r=this;r.isRecordset=e,r.tableName=t.XmlTableName,r.object=t}var o,n,a;if(e)for(b.push(new t(!1,e)),e.DetailGrid&&b.push(new t(!0,e.DetailGrid.Recordset)),n=e.FindFirstControl();n;)a=n.ControlType,11===a?(o=n.Recordset,o.Fields.Count>0&&b.push(new t(!0,o))):9===a&&r(n.Report),n=e.FindNextControl()}function o(e,t,r){function o(e,t){var r,o=e.length,n=0;for(r=0;o>r;r++)t.indexOf(e[r])>=0&&n++;return 100*n/o}var n=t.recordCount,a=t.fieldNames,i=0;if(e.length&&t.fieldNames.length){if(i=o(e,a),!i)return 0;100===i&&e.length===a.length?i=200:i+=o(a,e),i+=r&&n>1||!r&&1===n?5:-5}return i}function n(e){return e>=200}function a(){var t,r,o,n=e,a=[];for(t=n.Parameters.items.length;t--;)a.push(n.Parameters.items[t].Name.toUpperCase());for(r=n.FindFirstControl();r;)o=r.ControlType,1===o||8===o||7===o||12===o?a.push(r.Name.toUpperCase()):13===o&&r.cells.forEach(function(e){e.forEach(function(e){e.DataName&&a.push(e.DataName.toUpperCase())})}),r=n.FindNextControl();return a}function i(e){for(var t=e[0],r=1,o=e.length;o>r;r++)e[r].weight>t.weight&&(t=e[r]);return t}function l(e,t,r){r.matchWeight<e&&(r.matchWeight=e,r.reportTableInfo=t)}var s,c,u,d,h,p,f,g,m,C,b=[];for(r(e),u=b.length,s=0;u>s;++s){if(h=b[s],h.tableName){if(c=t.indexOf(h.tableName),c>=0){t[c].turnToFullMatched();continue}h.tableName=""}if(h.isRecordset){for(m=h.object.Fields.items,C=[],c=0,d=m.length;d>c;)C.push(m[c++].RunningDBField.toUpperCase());for(f=[],d=t.length,c=0;d>c;)if(p=t[c++],!p.isFullMatched()){if(g=o(C,p,!0),n(g)){l(g,h,p),f=[];break}g>0&&f.push({dataTableInfo:p,weight:g})}f.length&&(c=i(f),l(c.weight,h,c.dataTableInfo))}}if(t.some(function(e){return!e.isMatched()}))for(u=b.length,s=0;u>s;++s)if(h=b[s],!h.isRecordset&&!h.tableName){for(C=a(),f=[],d=t.length,c=0;d>c;)if(p=t[c++],!p.isFullMatched()){if(g=o(C,p,!1),n(g)){l(g,h,p),f=[];break}g>0&&f.push({dataTableInfo:p,weight:g})}f.length&&(c=i(f),l(c.weight,h,c.dataTableInfo))}for(u=t.length,s=0;u>s;)p=t[s++],h=p.reportTableInfo,h&&h.object.attachDataTable(p.table)}var t=this,r=t.viewer.tables,o=[],n=function(e,t){var r,o=this,n=o.fieldNames=[],a=Math.min(t.length,50);for(o.tableName=e,o.table=t,o.matchWeight=0;a--;){r=t[a];for(var i in r)i=i.toUpperCase(),n.indexOf(i)<0&&n.push(i)}};n.prototype={isFullMatched:function(){return this.matchWeight>=200},turnToFullMatched:function(){this.matchWeight=200},isMatched:function(){return this.matchWeight>=40},get recordCount(){return this.table.length}};for(var a in r)o.push(new n(a,r[a]));1===o.length&&o[0].recordCount>1&&t.DetailGrid?t.DetailGrid.Recordset.attachDataTable(o[0].table):e(t,o)},attachDataTable:function(e){var t,r,o=this,n=e[0];for(var a in n)t=n[a],r=o.ParameterByName(a),r?r.setValue(t):(r=o.ControlByName(a),r&&(r.hasOwnProperty("Text")||7===r.ControlType)&&(r.Text=t+""))},prepare:function(){var e=this,t=e.ownerSR,r=e.Printer,o=e.ReportHeaders,n=e.ReportFooters;e.designWidth=t?t.pxRect?t.pxRect.Width():t.owner.getRect().Width():e.size2Pixel((1===r.DesignPaperOrientation?r.DesignPaperWidth:r.DesignPaperLength)-r.DesignPaperLeftMargin-r.DesignPaperRightMargin),e.DetailGrid&&e.DetailGrid.attachData(),o.attachData(),n.attachData(),e.Parameters.prepare(),e.DetailGrid&&e.DetailGrid.prepare(),o.prepare(),n.prepare(),e._srChildren&&e._srChildren.forEach(function(e){e.Report.prepare()}),t||!e.viewer.options.singleChartFill||e.DetailGrid||o.Count+n.Count!==1||1!==(o.items[0]||n.items[0]).Controls.Count||(e.singleChart=(o.items[0]||n.items[0]).Controls.items[0],11!==e.singleChart.ControlType&&delete e.singleChart)},unprepare:function(){var e=this;e.Parameters.unprepare(),e.DetailGrid&&(e.DetailGrid.unprepare(),e.RunningDetailGrid=e.DetailGrid),delete e._srChildren,delete e.singleChart,delete e.canvasControls},getUsingFont:function(){return this.Font.font},getRunningColumnByName:function(t){var r=this;return r.RunningDetailGrid?r.RunningDetailGrid.Columns.itemByName(t):e},getReportWidth:function(){var e=this;return e.RunningDetailGrid?e.RunningDetailGrid.width:e.designWidth},get reportFitHeight(){var e=this;return!e.RunningDetailGrid&&e.viewer.options.reportFitHeight},get reportFitWidth(){return this.viewer.options.reportFitWidth},get toFillHolder(){var e=this;return e.reportFitHeight||e.singleChart},get isDynamicSize(){var e=this,t=e.viewer.options;return e.toFillHolder||t.reportFitWidth||t.detailgridResize},pixel2Size:function(e){return e/=96,1===this.Unit&&(e*=2.54),e},size2Pixel:function(e){return 1===this.Unit&&(e/=2.54),96*e},cm2Size:function(e){return 1===this.Unit?e:e/2.54},registerCanvas:function(e,t){var r=this,o=new ee("canvas",t),n=te();o.addAttribute("id",n),r.isDynamicSize?(o.addStyle("width","100%"),o.addStyle("height","100%"),o.addStyle("display","block")):(o.addAttribute("width",e.pxRect.Width()+""),o.addAttribute("height",e.pxRect.Height()+"")),e.canvasID=n,r.canvasControls||(r.canvasControls=[]),r.canvasControls.push(e)},prepareCanvas:function(){for(var e,t=this,r=t.canvasControls,o=r.length;o-- >0;)e=r[o],e.canvas=document.getElementById(e.canvasID),e.prepareCanvas&&e.prepareCanvas()},resizeCanvas:function(){for(var e=this,t=e.canvasControls,r=t.length;r-- >0;)t[r].resize()},renderCanvas:function(){for(var e=this,t=e.canvasControls,r=t.length;r-- >0;)t[r].draw(1)},executeEventScript:function(e,t,r){gr.script.execEvent(e,t,r,this)},fireInitialize:function(){var e=this;e.InitializeScript&&e.executeEventScript(e.InitializeScript,"InitializeScript",e),e.OnInitialize&&e.OnInitialize()},fireFetchRecord:function(){var e=this;e.FetchRecordScript&&e.executeEventScript(e.FetchRecordScript,"FetchRecordScript",e.DetailGrid.Recordset),e.OnFetchRecord&&e.OnFetchRecord()},fireBeforePostRecord:function(e){var t=this,r=t.DetailGrid.Recordset;r.BeforePostRecordScript&&t.executeEventScript(r.BeforePostRecordScript,"BeforePostRecordScript",r),t.OnBeforePostRecord&&t.OnBeforePostRecord()},fireBeforeSort:function(e,t){var r=this;r.BeforeSortScript&&r.executeEventScript(r.BeforeSortScript,"BeforeSortScript",t),r.OnBeforeSort&&t.isDetailGridRecordset()&&r.OnBeforeSort()},fireProcessBegin:function(){var e=this;e.ProcessBeginScript&&e.executeEventScript(e.ProcessBeginScript,"ProcessBeginScript",e),e.OnProcessBegin&&e.OnProcessBegin()},fireProcessEnd:function(){var e=this;e.ProcessEndScript&&e.executeEventScript(e.ProcessEndScript,"ProcessEndScript",e),e.OnProcessEnd&&e.OnProcessEnd()},fireProcessRecord:function(e){var t=this;e.ProcessRecordScript&&t.executeEventScript(e.ProcessRecordScript,"ProcessRecordScript",e),t.OnProcessRecord&&t.OnProcessRecord()},fireGroupBegin:function(e){var t=this;e.GroupBeginScript&&t.executeEventScript(e.GroupBeginScript,"GroupBeginScript",e),t.OnGroupBegin&&t.OnGroupBegin(e)},fireGroupEnd:function(e){var t=this;e.GroupEndScript&&t.executeEventScript(e.GroupEndScript,"GroupEndScript",e),t.OnGroupEnd&&t.OnGroupEnd(e)},fireSectionFormat:function(e){var t=this;e.FormatScript&&t.executeEventScript(e.FormatScript,"FormatScript",e),t.OnSectionFormat&&t.OnSectionFormat(e)},fireFieldGetDisplayText:function(e){var t=this;e.GetDisplayTextScript&&t.executeEventScript(e.GetDisplayTextScript,"FieldGetDisplayTextScript",e),t.OnFieldGetDisplayText&&t.DetailGrid&&t.RunningDetailGrid.Recordset===e.owner&&t.OnFieldGetDisplayText(e)},fireTextBoxGetDisplayText:function(e){var t=this;e.GetDisplayTextScript&&t.executeEventScript(e.GetDisplayTextScript,"TextBoxGetDisplayTextScript",e),t.OnTextBoxGetDisplayText&&t.OnTextBoxGetDisplayText(e)},fireControlCustomDraw:function(e){},fireChartRequestData:function(e){var t=this;t.OnChartRequestData&&t.OnChartRequestData(e)},get Version(){return a.VERSION},get FloatControls(){var e=this;return e._floatControls||(e._floatControls=new ne(e)),e._floatControls},get ImageList(){return{}},get ParentReport(){var t=this;return t.ownerSR?t.ownerSR.Report:e},get Utility(){return gr.utility},get Running(){return!!this.viewer.running},get DisplayMode(){return 1},get IsBlank(){var e=this;return e.DetailGrid&&e.PageHeader&&e.PageFooter&&!e.ReportHeaders.Count&&!e.ReportFooters.Count},ControlByName:function(t){function r(o){function n(o){function n(o){return o.FreeCell?r(o.Controls):o.DataName.toUpperCase()===t?o:e}for(var a,i,l,s,c=o.length;c--;)if(l=o[c])for(a=l.length;a--;)if(s=l[a],i=s?n(s):0)return i;return e}for(var a,i=o.items,l=i.length;l--;){if(a=i[l],a.Name.toUpperCase()===t)return a;if(13===a.ControlType&&(a=n(a.cells)))return a}return e}function o(t){return t.FreeCell?r(t.Controls):e}function n(t){for(var r,a,i=t.items.length;i--;)if(r=t.items[i],a=o(r),r.GroupTitle&&!a&&(a=n(r.SubTitles)),a)return a;return e}function a(e){for(var t=e.length;t--;)if(c=r(e[t].Controls))return c}var i,l,s,c,u=this;if(t=t.toUpperCase(),c=a(u.ReportHeaders.items)||a(u.ReportFooters.items))return c;if(u.DetailGrid){for(i=u.DetailGrid.Groups.items,l=i.length;l--;)if(s=i[l],c=r(s.Header.Controls)||r(s.Footer.Controls))return c;for(i=u.DetailGrid.ColumnContent.ContentCells.items,l=i.length;l--;)if(c=o(i[l]))return c;return n(u.DetailGrid.ColumnTitle.TitleCells)}return e},ColumnByName:function(t){var r=this;return r.DetailGrid?r.DetailGrid.Columns.itemByName(t):e},FieldByName:function(e){return this.RunningFieldByName(e)},FieldByDBName:function(t){var r=this.RunningDetailGrid;return r?r.Recordset.FieldByDBName(t):e},ParameterByName:function(e){return this.Parameters.itemByName(e)},FindFirstControl:function(){function e(e){e.FreeCell&&(l=l.concat(e.Controls.items))}function t(r){r.forEach(function(r){e(r),r.GroupTitle&&t(r.SubTitles)})}var r,o,n,a=this,i=a.DetailGrid,l=[];for(o=a.ReportHeaders.Count,r=0;o>r;r++)l=l.concat(a.ReportHeaders.items[r].Controls.items);for(o=a.ReportFooters.Count,r=0;o>r;r++)l=l.concat(a.ReportFooters.items[r].Controls.items);if(i){for(o=i.Groups.Count,r=0;o>r;r++)n=i.Groups.items[r],l=l.concat(n.Header.Controls.items),l=l.concat(n.Footer.Controls.items);i.ColumnContent.ContentCells.forEach(function(t){e(t)}),t(i.ColumnTitle.TitleCells)}return l.length>0&&(a.findControls=l,a.findControlIndex=-1),a.FindNextControl()},FindNextControl:function(){var t=this;return t.findControls&&(++t.findControlIndex,t.findControlIndex>=t.findControls.length&&(delete t.findControls,delete t.findControlIndex)),t.findControls?t.findControls[t.findControlIndex]:e},RunningFieldByName:function(t){var r=this.RunningDetailGrid;return r?r.Recordset.FieldByName(t):e},PixelsToUnit:function(e){return this.pixel2Size(e)},UnitToPixels:function(e){return this.size2Pixel(e)},SystemVarValue:function(e){return this.SystemVarValue2(e,0)},SystemVarValue2:function(e,t){var r,o,n,a=this,i=a.RunningDetailGrid;if(1===e)r=new Date;else if(i)switch(o=i.Recordset,e){case 4:r=o.RecordNo+1;break;case 19:r=o.RecordCount;break;case 8:r=i.generatingRowNo;break;default:n=i.Groups.items[t-1],n&&(21===e?r=n.recordset.RecordCount:(n.inphaseByDetail(o.RecordNo),r=20===e?n.recordset.isAppendingRecord()?n.recordset.RecordCount:n.recordset.RecordNo:22===e?o.RecordNo-n.beginNoField.Value:n.endNoField.Value-n.beginNoField.Value,r++))}return r},AddParameter:function(e,t){var r=this.Parameters.Add();return r.Name=e,r.DataType=t,r},InsertDetailGrid:function(){var e=this;return e.DetailGrid||(e.DetailGrid=new qe(e),e.RunningDetailGrid=e.DetailGrid),e.DetailGrid},InsertPageHeader:function(){return new Ge(this)},InsertPageFooter:function(){return new Ge(this)},Clear:function(){var e=this;Ke.call(e,e.viewer),e.DeleteDetailGrid()},DeleteDetailGrid:function(){var t=this;t.DetailGrid=e,t.RunningDetailGrid=e},DeletePageHeader:function(){},DeletePageFooter:function(){}};var $e="",et="_hta",tt="_htaa",rt="_htc",ot="_htca",nt="_htn",at="_htx",it="_hp",lt="_vp",st="_htp",ct="_vtp",ut=function(){this.Flag=0};ut.prototype={get CalcHTotal(){return 1&this.Flag},set CalcHTotal(e){var t=this;e?t.Flag|=1:t.Flag&=-2},get CalcHAverage(){return 2&this.Flag},set CalcHAverage(e){var t=this;e?t.Flag|=2:t.Flag&=-3},get CalcHAverageA(){return 4&this.Flag},set CalcHAverageA(e){var t=this;e?t.Flag|=4:t.Flag&=-5},get CalcHCount(){return 8&this.Flag},set CalcHCount(e){var t=this;e?t.Flag|=8:t.Flag&=-9},get CalcHCountA(){return 16&this.Flag},set CalcHCountA(e){var t=this;e?t.Flag|=16:t.Flag&=-17},get CalcHMin(){return 32&this.Flag},set CalcHMin(e){var t=this;e?t.Flag|=32:t.Flag&=-33},get CalcHMax(){return 64&self.Flag},set CalcHMax(e){var t=this;e?t.Flag|=64:t.Flag&=-65},onBySummaryFun:function(e){var t=this;t.CalcHTotal=!0,2===e?t.CalcHAverage=!0:15===e?t.CalcHAverageA=!0:3===e?t.CalcHCount=!0:13===e?t.CalcHCountA=!0:4===e?t.CalcHMin=!0:5===e&&(t.CalcHMax=!0)}};var dt=function(t){var r=this;r.originObject=e,r.HTotalFlag=new ut,r.HSubtotalFlag=new ut,r.MiscFlag=0,r.DatafieldIndex=-1,r.TotalValue=0,r.EntireTotalValue=0,t&&L(r,t,0)};dt.prototype={CopyAddField:function(e,t){var r=this,o=e.Fields.Add();return r.originObject.FieldType?(o.assign(r.originObject),r.originObject.isNumeric()&&(o.FieldType=3)):r.NumericField&&(o.FieldType=3,o.Format=r.originObject.textBuilder.items[0].format),o.Name=t,o.DBFieldName="",o},CombineCalcFlag:function(e){var t=this;t.HTotalFlag.Flag|=e.HTotalFlag.Flag,t.HSubtotalFlag.Flag|=e.HSubtotalFlag.Flag,t.MiscFlag|=e.MiscFlag},SetFlagBySummaryFun:function(e,t){var r=this;3===t?r.HSubtotalFlag.onBySummaryFun(e):r.HTotalFlag.onBySummaryFun(e)},get CalcHPercent(){return 1&this.MiscFlag},set CalcHPercent(e){var t=this;e?t.MiscFlag|=1:t.MiscFlag&=-2},get CalcVPercent(){return 2&this.MiscFlag},set CalcVPercent(e){var t=this;e?t.MiscFlag|=2:t.MiscFlag&=-3},get CalcTotalHPercent(){return 4&this.MiscFlag},set CalcTotalHPercent(e){var t=this;e?t.MiscFlag|=4:t.MiscFlag&=-5},get CalcTotalVPercent(){return 8&this.MiscFlag},set CalcTotalVPercent(e){var t=this;e?t.MiscFlag|=8:t.MiscFlag&=-9},get CalcHTotalExclude(){return 16&this.MiscFlag},set CalcHTotalExclude(e){var t=this;e?t.MiscFlag|=16:t.MiscFlag&=-17},get NumericField(){return 32&this.MiscFlag},set NumericField(e){var t=this;e?t.MiscFlag|=32:t.MiscFlag&=-33}};var ht=function(e,t){var r=this;r.Group=e,r.DataFieldInfo=t,r.DataSumBoxes=[]},pt=function(t){var r=this;r.PriorCrossTitleCell=e,r.OriginTextBox=t,r.PriorTitleText=""},ft=function(e){var t=this;pe.call(t,e),t.HCrossFields="",t.VCrossFields="",t.ListCols=1,t.TotalCols=0,t.SubtotalCols=0,t.HResort=!0,t.HSortAsc=!0,t.VResort=!0,t.VSortAsc=!0,t.HTotalAtFirst=!1,t.HPercentColumns="",t.VPercentColumns="",t.TotalExcludeColumns="",t.TotalHPercentColumns="",t.TotalVPercentColumns="",t.DisabledSumFields="",t.PercentFormat="0.##%",t.HCrossPeriodType=0,t.BeginDateParameter="",t.EndDateParameter="",t.GroupAutoSum=!0};ft.prototype={loadFromJSON:function(e){var t=this;e&&(pe.prototype.loadFromJSON.call(t,e),u(t,"HCrossPeriodType",n.PeriodType))},prepare:function(){function r(){var e=d.ParameterByName(u.BeginDateParameter),t=d.ParameterByName(u.EndDateParameter),r={};return e&&(r.begin=e.AsDateTime),t?(r.end=t.AsDateTime,e||(r.begin=b(r.end))):r.end=b(r.begin),r.end<r.begin&&(e=r.begin,r.begin=r.end,r.end=e),r}function o(){function o(){function e(e){var t=e.orderNo;return ne>t?1:ae>t?2:ie>t?3:4}function t(t,r){function o(e){ge.indexOf(e.originObject)<0&&(E.some(function(t){return t.originObject!==e.originObject?!1:(t.CombineCalcFlag(e),!0)})||(e.NumericField=e.originObject.isNumeric(),E.push(e)))}function n(e,t){e?e.varItems.forEach(function(e){var r=e.varField;1===r.type&&(t.originObject=r.object,o(t))}):(t.originObject=E[0].originObject,o(t))}var a,i=new dt,l=e(r),s=1!==l,c=t.ControlType;4===l?(i.HTotalFlag.CalcHTotal=1,fe.indexOf(r)>=0&&(i.CalcHTotalExclude=1),he.indexOf(r)>=0&&(i.CalcTotalHPercent=1),pe.indexOf(r)>=0&&(i.CalcTotalVPercent=1)):3===l?i.HSubtotalFlag.CalcHTotal=1:2===l&&(ue.indexOf(r)>=0&&(i.CalcHPercent=1),de.indexOf(r)>=0&&(i.CalcVPercent=1),i.CalcHPercent&&(i.HTotalFlag.CalcHTotal=1)),4===c||7===c?s&&(i.originObject=t.oDataField,i.originObject&&o(i)):5===c?(i.SetFlagBySummaryFun(t.SummaryFun,l),n(t.paramExp,i)):12===c?s&&(i.originObject=t,E.push(i)):8===c&&(a=!1,t.textBuilder.forEach(function(e){e.varItems&&e.varItems.forEach(function(e){var t,r=e.varField;4===r.type?(t=new dt(i),t.SetFlagBySummaryFun(r.SummaryFun,l),n(r.paramExp,t),a=!0):1===r.type&&s&&(t=new dt(i),t.originObject=r.object,o(t))}),!a&&s&&(i.originObject=t,i.NumericField=t.isPureNumericExpression(),E.push(i))}))}function r(e){e.forEach(function(e){e.GroupTitle?r(e.SubTitles.items):e.Column.ContentCell.getControls().forEach(function(r){t(r,e.Column)})})}function o(r){r.Controls.forEach(function(r){var o=S.itemByName(r.AlignColumn)||S.itemByName(r.AlignColumnEx);o&&1!==e(o)&&t(r,o)})}r(P),w.forEach(function(e){o(e.Footer),o(e.Header)}),c=0,E.forEach(function(e){e.DatafieldIndex=c,++c,e.CalcHPercent&&++c,e.CalcVPercent&&++c})}function a(){E.forEach(function(e){e.originObject.FieldType&&f.Fields.Remove(e.originObject.Name)})}function b(e){var t=f.Fields.Add();return t.Name=e,t.FieldType=3,t}function M(){function e(e){e.Controls.items=e.Controls.items.filter(function(e){var t=C.itemByName(e.AlignColumn)||C.itemByName(e.AlignColumnEx);return!t||t.orderNo<u.ListCols})}p.buildColumnsOrder(),s.forEach(function(t){e(t.Footer),e(t.Header)})}function k(e,r,o,a,i,l,c){function b(e,t){var r,o;e.FreeCell?(t.setFreeCell(!0),O(t,e),e.Controls.forEach(function(e){function n(){return 2===u.HCrossPeriodType||3===u.HCrossPeriodType||4===u.HCrossPeriodType||6===u.HCrossPeriodType||7===u.HCrossPeriodType}function a(){function e(e){var t=new z;return t.value=e,Math.floor(t.AsFloat)}var t,r=u.curPeriod.begin.getFullYear(),o=u.curPeriod.begin.getMonth()+1,n=u.curPeriod.begin.getDate();switch(u.HCrossPeriodType){case 2:t="第"+Math.floor((e(u.curPeriod.begin)-e(te.begin))/7+1)+"周";break;case 3:t=11>n?"上":21>n?"中":"下",t=o+"月"+t+"旬";break;case 4:t=16>n?"上":"下",t=o+"月"+t+"半月";break;case 6:t=g(r,2)+"-"+(o+2)/3+"季度";break;case 7:t=7>o?"上":"下",t=g(r,"00")+"-"+t+"半年"}return t}var i,l;r=e.ControlType,e.TextFormat?(o=t.Controls.Add(1),o.assign(e),i=n()&&4===r&&e.DataField===u.HCrossFields?a():e.getDisplayText(),o.Text=i):(o=t.Controls.Add(r),o.assign(e),7===r?e.DataField&&(o.DataField="",l=d.FieldByName(e.DataField),l&&(7===l.FieldType?o.Picture=l.Value:(i=l.DisplayText,o.ImageIndex=parseInt(i),isNaN(o.ImageIndex)&&(o.ImageIndex=0,o.ImageFile=i)))):12===r&&(o.Text=e.get_DisplayText()))})):t.assign(e)}function T(){var t,n,s=0;2===o&&(t=me[c-le],n=t?t[i]:0,s=n&&n.PriorCrossTitleCell&&n.PriorTitleText===n.OriginTextBox.getDisplayText()&&!l),s?r=n.PriorCrossTitleCell:(r=(r?r.SubTitles:m).AddGroup("",""),b(e,r),r.Name=S,n&&(n.PriorCrossTitleCell=r,n.PriorTitleText=n.OriginTextBox.getDisplayText())),e.SubTitles.forEach(function(e){k(e,r,o,a,i+1,!s,c)})}function x(){function a(e){var t;return E.some(function(r){return r.originObject.Name!==e?!1:(t=r,!0)}),t}function i(e,t){var r;return u.HPercentSums.some(function(o){return o.Group!==e||o.DataFieldInfo!==t?!1:(r=o,!0)}),r}function l(e,r){var n,a=t(e);return 4===o||1===o?a?(r+=$e+a,n=r):L.CalcHPercent?(n=r+$e,r+=st):L.CalcVPercent?(r+=ct,n=r):(r+=$e,n=r):3===o?(r+=y+a,n=r):(r+=y,n=r,L.CalcHPercent?r+=it:L.CalcVPercent&&(r+=lt,n=r)),n=F(n),{DataField:r,SummaryDataField:n}}function c(e,t){var r,o=0,n="";return e.varItems.forEach(function(a){o<a.beginIndex&&(n+=e.expText.substring(o,a.beginIndex)),1===a.varField.type?(r=l(t,a.varField.object.Name),n+=r.SummaryDataField):n+=a.varField.getExpText(),o=a.endIndex}),n+=e.expText.substr(o)}function g(e,t){return e="[#"+e,t&&(e+=":"+t),e+="#]"}function m(e,t){var r,o=0,a="";return e.varItems.forEach(function(i){var l=i.varField,s=l.type;o<i.beginIndex&&(a+=e.expText.substring(o,i.beginIndex)),4===s?(r=c(l.paramExp,l.SummaryFun),a+=t?D(n.SummaryFun,l.SummaryFun)+"("+r+(l.RankNo?","+l.RankNo:"")+")":r):a+=l.getExpText(),o=i.endIndex}),a+=e.expText.substr(o)}function T(){s.forEach(function(e,t){function r(e,t){t.isToGenerate()&&e.Controls.forEach(function(e){var r,o,a,i=e.ControlType,s=e.AlignColumn||e.AlignColumnEx;s===M.Name&&(r=t.Controls.Add(i),r.assign(e),r.AlignColumn=V.Name,r.AlignColumnEx="",5===i?e.DataField&&(r.DataField=c(e.paramExp,e.SummaryFun),r.Tag=e.DataField,n.push(r)):8===i?(o="",e.textBuilder.forEach(function(e){o+=e.varItems?g(m(e,!0),e.format):e.text}),r.Text=o):4===i&&(a=d.FieldByName(r.DataField),a&&(r.DataField=l(0,originFieldName).SummaryDataField)))})}var o,n=[];o=w[t],r(o.Footer,e.Footer),r(o.Header,e.Header),n.forEach(function(t){var r,o;L.CalcHPercent&&(t.Format=u.PercentFormat,r=a(t.Tag),o=i(e,r),o||(o=new ht(e,r),u.HPercentSums.push(o)),B?o.TotalSumBox=t:o.DataSumBoxes.push(t))})})}var x,P,R=1!==o,B=4===o,N=u.GroupAutoSum&&R,V=C.addTo(r?r.SubTitles:p.ColumnTitle.TitleCells),M=e.Column,L=new dt;V.assign(M),V.Name=S,2!==o&&3!==o||(V._crossOrderNo=A),b(e,V.TitleCell),V.ContentCell.assign(M.ContentCell),x=V.ContentCell.getControls(),P=1===x.length,B?(he.indexOf(M)>=0&&(L.CalcHPercent=1),pe.indexOf(M)>=0&&(L.CalcVPercent=1)):(ue.indexOf(M)>=0&&(L.CalcHPercent=1),de.indexOf(M)>=0&&(L.CalcVPercent=1)),x.forEach(function(e,t){function r(t){s.forEach(function(r,o){function n(e,t){return e.isToGenerate()&&e.Controls.items.some(function(e){return e.AlignColumn===t.Name||e.AlignColumnEx===t.Name})}function l(r){var o,n,a,i;return r.isToGenerate()&&(o=r.Controls.Add(5),o.assign(e),o.Dock=0,o.TextAlign=e.TextAlign,o.AlignColumn=V.Name,o.DataField=t.summaryDataField,v.ShowColLine&&(n=o.Border,n.Styles|=4,a=v.ColLinePen.Width,i=e.Border,i&&4&i.Styles&&i.Pen.Width>0?a+=i.Pen.Width:n.Pen.Color=v.ColLinePen.Color,n.Pen.Width=a),P?(o.Top=0,o.Height=r.Height,16777215!==V.ContentCell.BackColor&&16777215===r.BackColor&&(o.BackStyle=1,o.BackColor=V.ContentCell.BackColor)):(o.Top=e.Top,o.Height=e.Height,1===e.BackStyle()&&(o.BackStyle=1,o.BackColor=e.BackColor))),o}var s,c,d,h=w[o];n(h.Footer,M)||n(h.Header,M)||(s=l(r.Footer),s||(s=l(r.Header)),s&&(s.Format=t.format,L.CalcHPercent&&(s.Format=u.PercentFormat,c=a(t.originDataField),d=i(r,c),d||(d=new ht(r,c),u.HPercentSums.push(d)),B?d.TotalSumBox=s:d.DataSumBoxes.push(s))))})}function n(){var o,n,a=e.DataField,i=e.SummaryFun;5===p&&(a||(a=E[0].originObject.Name),n=e.Format,V.ContentCell.Controls?(e=new Se(V.ContentCell),e.assign(x[t]),V.ContentCell.Controls.items[t]=e):V.ContentCell.assign(x[t])),d=l(i,a),e.DataField=d.DataField,7!==p&&(n&&(o=f.Fields.Item(d.DataField),o&&(o.Format=n)),N&&r({summaryDataField:d.SummaryDataField,originDataField:a,format:""}))}function c(){var o,n,a,i,s=!1;s=h&&Q(e,y),s||(n=M.ContentCell.getControls()[t],o=(a=n.textBuilder.items[0])&&a.varItems.some(function(e){return 4===e.varField.type}),o?(i=m(a,!1),e.Text=g(i,a.format),N&&r({summaryDataField:F(i),originDataField:"",format:a.format})):R&&(d=l(0,e.Name),e.Text="[#"+d.DataField+"#]",N&&r({summaryDataField:d.SummaryDataField,originDataField:e.Name,format:""})))}var d,p=e.ControlType;4===p||5===p||7===p?n():12===p?1!==o&&(d=l(e.Name,0),e.Text="[#"+d.DataField+"#]"):8===p&&c()}),R&&T()}var y=a?(2===o?"_":"_S")+a:"",S=e.Name+y;e.GroupTitle?T():x()}function H(){var e=T.Fields;f.Fields.forEach(function(t){N.push({crossField:t,originField:e.itemByName(t.Name)})})}function j(){E.forEach(function(e){function t(e,t,o){r=e.CopyAddField(f,t+o),r.GetDisplayTextScript="",V.push(r)}var r,o=e.HTotalFlag,n=e.originObject.Name;o.CalcHTotal&&t(e,n,$e),o.CalcHAverage&&t(e,n,et),o.CalcHAverageA&&t(e,n,tt),o.CalcHCount&&t(e,n,rt),o.CalcHCountA&&t(e,n,ot),o.CalcHMin&&t(e,n,nt),o.CalcHMax&&t(e,n,at),e.CalcTotalHPercent&&(r=b(n+st),r.Format=u.PercentFormat,V.push(r)),e.CalcTotalVPercent&&(r=b(n+ct),r.Format=u.PercentFormat,V.push(r))})}function _(){var t=P.length;for(l=ce;t>l;l++)k(P[l],e,4,e,0,!0,-1)}function W(e){var t,r=e.getControls();e.GroupTitle&&1===r.length&&(t=r[0],t.TextFormat&&(me[me.length-1].push(new pt(t)),1===e.SubTitles.items.length&&W(e.SubTitles.items[0])))}function U(){var e=[];u.HResort&&R.forEach(function(t){e.push({field:t,asc:u.HSortAsc,"case":1})}),ee=T.sortRecords(e,1)}function J(t){var r,o;for(r="_"+t,R.forEach(function(e){o=f.Fields.Add(),o.assign(e),o.Name+=r,o.DBFieldName="",o._hfval=e.Value,L.push(o)}),E.forEach(function(e){var t=e.originObject.Name+r;V.push(e.CopyAddField(f,t)),e.CalcHPercent&&(o=b(t+it),o.Format=u.PercentFormat,V.push(o)),e.CalcVPercent&&(o=b(t+lt),o.Format=u.PercentFormat,V.push(o))}),l=le;se>l;l++)k(P[l],e,2,t,0,!1,l)}function Y(){function t(){var e;return P[le].GroupTitle&&1===me.length&&me[0].length>=1&&(e=me[0][0]).PriorCrossTitleCell&&e.PriorTitleText!==e.OriginTextBox.getDisplayText()}function r(){var t,r,o;for(I.push(A),t=I.length,r="_S"+t,E.forEach(function(e){o=e.originObject.Name+r,G.push(e.CopyAddField(f,o+$e)),e.HSubtotalFlag.CalcHAverage&&G.push(e.CopyAddField(f,o+et)),e.HSubtotalFlag.CalcHAverageA&&G.push(e.CopyAddField(f,o+tt)),e.HSubtotalFlag.CalcHCount&&G.push(e.CopyAddField(f,o+rt)),e.HSubtotalFlag.CalcHCountA&&G.push(e.CopyAddField(f,o+ot)),e.HSubtotalFlag.CalcHMin&&G.push(e.CopyAddField(f,o+nt)),e.HSubtotalFlag.IsCalcHMax&&G.push(e.CopyAddField(f,o+at))}),l=se;ce>l;l++)k(P[l],e,3,t,0,!1,-1)}ee.forEach(function(e,o){(e<u.VAddedItemRecordOffsetBegin||e>=u.VAddedItemRecordOffsetEnd)&&(T.MoveTo(e),o&&!T.fieldsKeepedValueChanged(R)||(u.SubtotalCols>0&&o&&t()&&(T.MoveTo(ee[o-1]),r(),T.MoveTo(e)),T.keepValue(),J(++A)),T.curRecord._CrossNo_=A)}),u.SubtotalCols>0&&r()}function X(){function e(){return te?u.curPeriod=i.periodRangeNext(u.curPeriod,u.HCrossPeriodType):(te=r(),x(te.begin),x(te.end),y(te.end),u.curPeriod=i.periodRangeBy(te.begin,u.HCrossPeriodType)),u.curPeriod.begin<te.end}for(var t,o,n=ee.length,a=0;e();)for(t=R[0].AsDateTime,R[0].AsDateTime=u.curPeriod.begin,J(++A),R[0].AsDateTime=t;n>a&&(T.MoveTo(ee[a]),o=R[0].AsDateTime,!(o<u.curPeriod.begin||o>=u.curPeriod.end));)T.curRecord._CrossNo_=A,a++}function Z(){u.HPercentSums.forEach(function(e){function t(e){e.isToGenerate()&&(r=e.Controls.Add(5),r.DataField=o)}var r,o;e.TotalSumBox||(o=e.DataFieldInfo.originObject.Name+$e,t(e.Group.Footer),!r&&t(e.Group.Header),r.Visible=!1,e.TotalSumBox=r)})}function q(){var e=V.splice(0,$);V=V.concat(e)}function Q(e,t){var r,o=e.Text,n=o.indexOf(":");return n>0&&o.substring(2,n)===R[0].Name?(r="G"===t?"[#"+oe:o.substr(0,n)+t,r+=o.substr(n),e.Text=r,1):0}function K(){function e(){var e,t=R[0],r=new Date(2009,7,30),o=t.AsDateTime;for(e=0;7>e;++e)t&&(t.AsDateTime=r),J(++A),y(r);t.AsDateTime=o}function t(e){var t=R[0];e.Controls.forEach(function(e){4===e.ControlType?t.Name===e.DataField&&(e.DataField=oe):8===e.ControlType&&Q(e,"G")})}var r,o,n=p.Groups.items[0];e(),n&&(r=f.Fields.Add(),r.FieldType=2,r.Name=re,B.push(r),n.ByFields=re,r=f.Fields.Add(),r.FieldType=6,r.Format=R[0].Format,r.Name=oe,B.push(r),t(n.Header),t(n.Footer)),S.Count>1&&(o=S.items[1].ContentCell.BackColor,C.Item(1).ContentCell.BackColor=o,C.Item(7).ContentCell.BackColor=o)}var $,ee,te,re="_Month_",oe="_Date_",ne=0,ae=1,ie=1,le=-1,se=-1,ce=-1,ue=[],de=[],he=[],pe=[],fe=[],ge=[],me=[];if(h){if(u.GroupAutoSum=!1,T.Fields.forEach(function(e){6===e.FieldType&&R.push(e)}),!R.length)throw new Error("None date field!")}else{if(ue=S.decodeItems(u.HPercentColumns),de=S.decodeItems(u.VPercentColumns),he=S.decodeItems(u.TotalHPercentColumns),pe=S.decodeItems(u.TotalVPercentColumns),fe=S.decodeItems(u.TotalExcludeColumns),R=T.decodeFields(u.HCrossFields),!R.length)throw new Error("生成交叉表不成功，没有定义'横向交叉数据字段'！");B=T.decodeFields(u.VCrossFields),ge=T.decodeFields(u.DisabledSumFields),ne=u.ListCols,ie=S.Count-u.TotalCols,ae=ie-u.SubtotalCols}if(se=P.length,ce=se,P.forEach(function(e,t){var r=e.findFirstColumn().orderNo;r===ne&&(le=t),r===ae&&(se=t),r===ie&&(ce=t)}),o(),a(),M(),p.clearColumns(),h)K();else{if(!E.length)throw new Error("生成交叉表不成功，不存在交叉数据项！");if(0>=le)throw new Error("生成交叉表不成功，不存在交叉数据列！");for(U(),l=0;le>l;++l)k(P[l],e,1,e,0,!0,-1);for(H(),j(),$=V.length,u.HTotalAtFirst&&_(),l=le;se>l;l++)me.push([]),W(P[l]);0===u.HCrossPeriodType?Y():X(),!u.HTotalAtFirst&&_(),$>0&&q(),Z()}}function a(){function t(){var e=[];u.VResort&&(B.forEach(function(t){e.push({field:t,asc:u.VSortAsc,"case":1})}),R.forEach(function(t){e.push({field:t,asc:u.HSortAsc,"case":1})})),s=T.sortRecords(e,1)}function o(e,t){E.forEach(function(r,o){var n,a=c*e+r.DatafieldIndex;r.NumericField?(n=r.originObject.AsFloat,V[a].AsFloat+=n,r.CalcHTotalExclude&&r.TotalValue||(r.TotalValue+=n,t&&(t[e*E.length+o]+=n))):V[a].IsNull&&(V[a].Value=r.originObject.Value)})}function n(){f.Append(),N.forEach(function(e){e.crossField.Value=e.originField.Value}),L.forEach(function(e){e.Value=e._hfval}),E.forEach(function(e){e.TotalValue=0})}function a(){function e(e,t,a,i,l){function s(){var l,s,u=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(r=e;t>r;++r)l=V[c*r+a.DatafieldIndex],l.IsNull||(s=l.AsFloat,isNaN(s)||(u>s&&(u=s),s>d&&(d=s)));i.CalcHMin&&(u<Number.MAX_VALUE&&(n[o].AsFloat=u),o++),i.CalcHMax&&(d>-Number.MAX_VALUE&&(n[o].AsFloat=d),o++)}var u=t-e,d=u;if(i.CalcHAverageA||i.CalcHCountA)for(r=e;t>r;r++)V[c*r+a.DatafieldIndex].IsNull&&--d;n[o].AsFloat=l,o++,i.CalcHAverage&&(u>0&&(n[o].AsFloat=l/u),o++),i.CalcHAverageA&&(d>0&&(n[o].AsFloat=l/d),o++),i.CalcHCount&&(n[o].AsFloat=u,o++),i.CalcHCountA&&(n[o].AsFloat=d,o++),(i.CalcHMin||i.CalcHMax)&&s()}function t(){var t=G.length/I.length,a=0;I.forEach(function(i,l){var s=M(E.length,0);for(r=a;i>r;++r)E.forEach(function(e,t){s[t]+=V[c*r+e.DatafieldIndex].AsFloat;
});n=G,o=t*l,E.forEach(function(t,r){e(a,i,t,t.HSubtotalFlag,s[r])}),a=i})}var r,o=c*A,n=V;for(E.forEach(function(t){t.HTotalFlag.Flag&&(e(0,A,t,t.HTotalFlag,t.TotalValue,V),t.CalcTotalHPercent&&(n[o].AsFloat=1,o++),t.CalcTotalVPercent&&o++,t.EntireTotalValue+=t.TotalValue)}),r=0;A>r;++r)E.forEach(function(e){e.CalcHPercent&&(o=c*r+e.DatafieldIndex,0!=e.TotalValue?V[o+1].AsFloat=V[o].AsFloat/e.TotalValue:V[o+1].Clear())});I.length&&t(),f.Post()}function i(){var e,t,r,o,n,a,i;for(f.First();!f.Eof();){for(f.Edit(),e=0,t=0,r=0,o=0;A>o;++o)E.forEach(function(r,l){r.CalcVPercent&&(n=c*o+r.DatafieldIndex,a=V[n].AsFloat,i=d[o*E.length+l],r.CalcHPercent&&++n,++n,i&&(V[n].AsFloat=a/i),e+=a,t+=i)}),o===I[r]&&(E.forEach(function(o){o.CalcVPercent&&(n=c*r+o.DatafieldIndex+1+(o.CalcHPercent?1:0),t&&(G[n].AsFloat=e/t))}),r++);n=c*A,E.forEach(function(e){var t=e.HTotalFlag;a=V[n].AsFloat,t.CalcHTotal&&++n,t.CalcHAverage&&++n,t.CalcHAverageA&&++n,t.CalcHCount&&++n,t.CalcHCountA&&++n,t.CalcHMin&&++n,t.CalcHMax&&++n,e.CalcTotalHPercent&&++n,e.CalcTotalVPercent&&(e.EntireTotalValue&&(V[n].AsFloat=a/e.EntireTotalValue),++n)}),f.Post(),f.Next()}}function l(){var t,i,l,c,u=r(),d=[],h=0;for(d.push({field:R[0],asc:1,"case":1}),s=T.sortRecords(d,1),t=s.length;u.begin<=u.end;){for(;t>h&&(T.MoveTo(s[h]),!(R[0].AsDateTime>=u.begin));)h++;for(i=u.begin.getDay(),l=u.begin.getMonth(),n(),B.length&&(B[0].AsInteger=l+1,B[1].AsDateTime=u.begin),c=i;7>c;++c){for(L[c].AsDateTime=u.begin;t>h&&(T.MoveTo(s[h]),!(R[0].AsDateTime>u.begin));)o(c,e),h++;if(y(u.begin),u.begin>u.end||B.length&&l!==u.begin.getMonth())break}a()}}var s,d=M(A*E.length,0);h?l():(t(),s.forEach(function(e,t){(e<u.HAddedItemRecordOffsetBegin||e>=u.HAddedItemRecordOffsetEnd)&&(T.MoveTo(e),t&&!T.fieldsKeepedValueChanged(B)||(T.keepValue(),t&&a(),n())),T.curRecord._CrossNo_&&o(T.curRecord._CrossNo_-1,d)}),a(),E.some(function(e){return e.CalcVPercent||e.CalcTotalVPercent})&&i())}var l,s,c,u=this,d=u.report,h=9===u.HCrossPeriodType,p=new qe(d),f=p.Recordset,m=p.ColumnTitle.TitleCells,C=p.Columns,v=u.owner,T=v.Recordset,S=v.Columns,w=v.Groups.items,P=v.ColumnTitle.TitleCells.items,R=[],B=[],A=0,E=[],N=[],V=[],L=[],I=[],G=[];u.HAddedItemRecordOffsetBegin=-1,u.HAddedItemRecordOffsetEnd=-1,u.VAddedItemRecordOffsetBegin=-1,u.VAddedItemRecordOffsetEnd=-1,u.HPercentSums=[],p.assign(v),p.IsCrossTab=0,s=p.Groups.items,o(),a(),d.RunningDetailGrid=p,p.attachData(),p.prepare()},unprepare:function(){},GroupEndProcess:function(e){var t=this;t.HPercentSums.forEach(function(t){var r;t.Group===e&&(r=t.TotalSumBox.Value,t.DataSumBoxes.forEach(function(e){r?e.Value/=r:e.Value=0}),t.TotalSumBox.Value=1)})},getClickedCellHCrossFieldValue:function(e){var t,r,o=this.report.RunningDetailGrid,n=o.clickedCell,a=n?n.getAttribute("_grcrossno"):0;return a&&(t=o.Recordset.Fields.Item(e+"_"+a),t&&(r=t.Value)),r},getClickedCellHCrossPeriod:function(){var e,t=this,r=t.report.RunningDetailGrid,o=r.clickedCell,n=o?"_"+o.getAttribute("_grcrossno"):0;return n&&(e=i.periodRangeBy(r.Recordset.Fields.Item(t.HCrossFields+n).AsDateTime,t.HCrossPeriodType)),e},get Recordset(){var t=this.report,r=t.RunningDetailGrid;return r!=t.DetailGrid?r.Recordset:e},HBeginAddItem:function(){var e=this;e.HAddedItemRecordOffsetBegin=e.report.RunningDetailGrid.Recordset.RecordCount},HEndAddItem:function(){var e=this;e.HAddedItemRecordOffsetEnd=e.report.RunningDetailGrid.Recordset.RecordCount},VBeginAddItem:function(){var e=this;e.VAddedItemRecordOffsetBegin=e.report.RunningDetailGrid.Recordset.RecordCount},VEndAddItem:function(){var e=this;e.VAddedItemRecordOffsetEnd=e.report.RunningDetailGrid.Recordset.RecordCount},GetCurPeriodBeginDate:function(){return this.curPeriod.begin},GetCurPeriodEndDate:function(){return this.curPeriod.end}},V(ft,pe);var gt=.25,mt=96/2.54,Ct=[3381606,39423,16737996,3394764,10079232,6737100,10040319,3407718,16737843,13421568,6723993,14535833,3342489,8965273,13369497,14535833,13395507,10092424,10066278,14522879],bt=Ct.length,vt=4,Tt=8,xt=4,yt=function(e,t){var r,o,n=0;for(e>=1&&(t=0),r=0;t>r;r++)e*=10;for(o=e;o>1;)++n,o/=10;if(o=.15>o?.1:.3>o?.2:.75>o?.5:1,t>0&&(n-=t),n>0)for(r=0;n>r;r++)o*=10;else for(r=n;0>r;r++)o/=10;return o},St=function(e){oe.call(this,e)};N(St,oe),St.prototype._createItem=function(){return new Bt(this.owner)};var Ft=function(e,t){var r=this;r.seriesIndex=e,r.groupIndex=t},wt=function(e,t,r){var o=this;Ft.call(o,e,t),o.rect=r};wt.prototype={inRange:function(e,t){return this.rect.PtInRect(e,t)},tooltipPos:function(){var e=this.rect;return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}}};var Dt=function(e,t,r,o,n,a,i){var l=this;Ft.call(l,e,t),l.x=r,l.y=o,l.r=n,l.beginAngle=a,l.endAngle=i};Dt.prototype={inRange:function(e,t){function r(){var r=e-o.x,n=t-o.y,a=Math.sqrt(r*r+n*n),i=Math.atan2(n,r);return 0>n&&(i+=2*Math.PI),{angle:360-j(i),distance:a}}var o=this,n=r();return o.beginAngle<=n.angle&&n.angle<o.endAngle&&n.distance<o.r},tooltipPos:function(){var e=this,t=-_(e.beginAngle+e.endAngle)/2,r=e.r/2;return{x:e.x+Math.cos(t)*r,y:e.y+Math.sin(t)*r}}};var Pt=function(e,t,r,o,n){var a=this;Ft.call(a,e,t),a.x=r,a.y=o,a.r=n};Pt.prototype={inRange:function(e,t){var r=this,o=e-r.x,n=t-r.y;return Math.sqrt(o*o+n*n)<=r.r},tooltipPos:function(){var e=this;return{x:e.x+4,y:e.y-4-At.prototype.options.tooltipFontSize}}};var Rt=function(e){var t=this;pe.call(t,e),t.LinePen=new Y,t.CoordLinePen=new Y,t.Label="",t.Max=0,t.Min=0,t.Space=0,t.TextAngle=0,t.TextVisible=!0,t.TextFormat="0.##",t.LineVisible=!0,t.CoordLineVisible=!1,t.MarginBeginWeight=25,t.MarginEndWeight=25,t.Scales=[],t.CustomCoordLines=[]};Rt.prototype={children:["LinePen","CoordLinePen"],afterLoad:function(e){var t=this,r=t.report.viewer.alpha.chartStroke,o=t.report.isWR;t.LinePen.loadFromJSON(e.LinePen,r,o),t.CoordLinePen.loadFromJSON(e.CoordLinePen,r,o)},CalcLabelHeight:function(){var e=this;return e.Used&&e.Label?e.owner.fontHeight+xt/2:0},CalcHorzAxisHeight:function(e){return this.DoCalcAxisSize(!0,e)},CalcVertAxisWidth:function(){return this.DoCalcAxisSize(!1,!1)},DoCalcAxisSize:function(e,t){var r,o=this,n=o.owner,a=[],i=o.owner.fontHeight,l=0;if(o.Used){if(o.TextVisible&&(!e||!n.IsDrawNegativeGraph())){if(t)a.push("1Agf");else if(o.IsValueAxis)if(o.Scales.length)o.Scales.forEach(function(e){a.push(e.Text)});else for(r=o.DrawMin;r<o.DrawMax+o.GetScaleTiny();r+=o.DrawSpace)a.push(o.ScaleFormatParser.format(r));else for(r=0;r<n.GroupCount;r++)a.push(n.GroupLabels[r]);-270===o.TextAngle?(a.forEach(function(e){l=Math.max(l,e.length)}),l*=i):(a.forEach(function(e){l=Math.max(l,n.context.measureTextWidth(e))}),e&&(l=Math.abs(Math.sin(_(o.TextAngle))*l)+1+i))}n.Chart3DReal&&n.IsHorzGraph()&&n.YAxis===o&&(l+=n.yView3DDepth),o.LineVisible&&(l+=vt),l&&(l+=xt)}return l},CalcGroupPos:function(e,t){var r=this,o=r.owner,n=o.IsHorzGraph()?o.CalcColumnBarCount():o.CalcBarCount(),a=r.MarginBeginWeight+r.MarginEndWeight+100*(o.GroupCount-1)+(n>0?o.BarWidthPercent:0),i=a?e*r.MarginBeginWeight/a:0,l=a?e*r.MarginEndWeight/a:0,s=e-i-l,c=n>0?o.BarWidthPercent:0,u=100*t,d=u+c,h={};return a-=r.MarginBeginWeight+r.MarginEndWeight,h.BeginPos=i,h.EndPos=i,a>0&&(h.BeginPos+=s*u/a,h.EndPos+=s*d/a),h.LabelMiddlePos=(h.BeginPos+h.EndPos)/2,h},DrawHorzAxisLabel:function(e){var t=this,r=t.owner.context;!e.IsRectEmpty()&&t.Label&&r.drawText(t.Label,(e.left+e.right-r.measureTextWidth(t.Label))/2,(e.top+e.bottom-t.owner.fontHeight)/2)},DrawVertAxisLabel:function(e){var t=this,r=t.owner.context;!e.IsRectEmpty()&&t.Label&&r.drawTextRotate(t.Label,(e.left+e.right-t.owner.fontHeight)/2,(e.top+e.bottom+r.measureTextWidth(t.Label))/2,90)},DrawAxisTextsPrepare:function(e){var t,r=this,o=r.owner,n=[];if(r.IsValueAxis)if(r.Scales.length)r.Scales.forEach(function(t){n.push({Text:t.Text,PosVal:r.CalcValuePos(t.PosVal,e)})});else for(t=r.DrawMin;t<r.DrawMax+r.GetScaleTiny();t+=r.DrawSpace)n.push({Text:r.ScaleFormatParser.format(t),PosVal:r.CalcValuePos(t,e)});else for(t=0;t<o.GroupCount;t++)n.push({Text:o.GroupLabels[t]||"",PosVal:r.CalcGroupPos(e,t).LabelMiddlePos});return n},DrawHorzAxis:function(e,t,r){function o(e,t,r,o,n){var a,i,l,s,c=h.owner.context,u=r.length,d=h.owner.fontHeight;if(o?(i=e.bottom-1,h.LineVisible&&(i-=vt),p.Chart3DReal&&(i-=p.yView3DDepth),t+=p.xView3DDepth):(i=e.top+1,h.LineVisible&&(i+=vt)),-270===h.TextAngle)for(s=c.measureTextWidth("A"),a=e.left+t-s,o&&(i-=d*u),l=0;u>l;l++)c.drawText(r.charAt(l),a,i),i+=d;else s=c.measureTextWidth(r),a=e.left+t-Math.abs(s/2*Math.cos(_(h.TextAngle)))+Math.abs(d/2*Math.sin(_(h.TextAngle))),o&&(i-=d),n||(i-=d+2*vt-1),c.drawTextRotate(r,a,i,h.TextAngle)}var n,a,i,l,s,c,u,d,h=this,p=h.owner,f=p.context,g=e.Width()-p.xView3DDepth,m=p.IsDrawNegativeGraph(),C=h.IsValueAxis,b=h.LinePen,v=b.clone(),T=b.clone();h.Used&&!e.IsRectEmpty()&&(v.Width=.5,T.Width=.5,T.Color=A(b.Color),h.LineVisible&&(f.SelectPen(b),a=e.left,i=a+p.xView3DDepth,l=a+g,s=l+p.xView3DDepth,c=r?e.bottom:e.top,u=c-p.yView3DDepth,d=r?t.bottom-2*p.yView3DDepth:t.top,f.DrawHorzLine(c,a,l),p.Chart3DReal&&(p.YAxis.Used||!p.Y2Axis.Used||p.IsHorzGraph()?(f.drawPolyLine([l,c,s,u,i,u],0),f.drawPolyLine([s,u,s,d,i,d],0)):(f.drawPolyLine([s,u,i,u,a,c],0),f.drawPolyLine([s,d,i,d,i,u],0))),f.RestorePen()),n=h.DrawAxisTextsPrepare(g),f.SelectPen(v),n.forEach(function(n,a){var i,l,s=p.IsScatterGraph()||!m||(h.IsValueAxis?n.PosVal>=0:p.Value(0,a)>=0),c=e.left+n.PosVal;h.LineVisible&&(r?(c+=p.xView3DDepth,l=e.bottom-p.yView3DDepth,i=l-vt):(i=e.top+1,l=s?e.top+1+vt:e.top+1-vt),f.DrawVertLine(c,i,l),p.Chart3DReal&&!C&&(r&&(c-=p.xView3DDepth,i+=p.yView3DDepth+vt),f.SelectPen(T),f.drawLine(c,i,c+p.xView3DDepth,i-p.yView3DDepth),f.RestorePen())),h.TextVisible&&o(e,n.PosVal,n.Text,r,s),h.CoordLineVisible&&!C&&h.IsValueAxis&&(f.SelectPen(h.CoordLinePen),i=t.top+1,l=t.bottom-p.yView3DDepth,r&&(i-=p.yView3DDepth,l-=p.yView3DDepth),f.DrawVertLine(c+p.xView3DDepth,i,l),f.RestorePen()),C=!1}),f.RestorePen(),h.CustomCoordLines.forEach(function(n){var a=h.CalcValuePos(n.PosVal,g);n.Text&&o(e,a,n.Text,r,!0),f.SelectPen(n.LinePen),f.DrawVertLine(e.left+a,t.top+1,t.bottom),f.RestorePen()}))},DrawVertAxis:function(e,t,r,o){function n(e,t,r,o){var n=d.owner.context;n.drawText(r,o?e.left+(d.LineVisible?vt:0):e.right-n.measureTextWidth(r)-(d.LineVisible?vt:0),t-d.owner.fontHeight/2)}var a,i,l,s,c,u,d=this,h=d.owner,p=h.context,f=e.Height()-h.yView3DDepth,g=d.LinePen,m=g.clone(),C=g.clone();!e.IsRectEmpty()&&d.Used&&(m.Width=.5,C.Width=.5,C.Color=A(g.Color),d.LineVisible&&(p.SelectPen(g),a=r?e.left-h.xView3DDepth:e.right,i=e.bottom,o&&(i-=h.yView3DDepth),l=i-f,p.DrawVertLine(a,l,i+1),h.Chart3DReal&&(s=a+h.xView3DDepth,c=i-h.yView3DDepth,p.drawPolyLine([a,i,s,c,s,c-f,a,l],0)),p.RestorePen()),p.SelectPen(m),u=d.DrawAxisTextsPrepare(f),u.forEach(function(a,i){var l,s,c=d.IsValueAxis?e.bottom-a.PosVal:e.top+a.PosVal+(o?0:h.yView3DDepth),u=c;d.LineVisible&&a.PosVal!=d.DrawMin&&(l=e.right-vt,s=e.right,r&&(l=e.left,s=e.left+vt),p.DrawHorzLine(u,l,s),h.Chart3DReal&&(p.SelectPen(C),r?(l=e.left-h.xView3DDepth,u+=h.yView3DDepth):l=e.right,p.drawLine(l,u,l+h.xView3DDepth,u-h.yView3DDepth),p.RestorePen())),d.TextVisible&&n(e,c,a.Text,r),d.CoordLineVisible&&d.IsValueAxis&&(p.SelectPen(d.CoordLinePen),u-=h.yView3DDepth,p.DrawHorzLine(u,t.left+h.xView3DDepth+g.Width,t.right),p.RestorePen())}),p.RestorePen(),d.CustomCoordLines.forEach(function(o){var a=e.bottom-d.CalcValuePos(o.PosVal,f);o.Text&&n(e,a,o.Text,r),p.SelectPen(o.LinePen),p.DrawHorzLine(a-h.yView3DDepth,t.left+h.xView3DDepth+g.Width,t.right),p.RestorePen()}))},PrepareDraw:function(){var e=this;e.Used=!1,e.IsValueAxis=!1,e.DrawMax=-Number.MAX_VALUE,e.DrawMin=Number.MAX_VALUE,e.DrawSpace=0,e.ScaleFormatParser=new l.NumericFormatter(e.TextFormat)},PrepareDrawRange:function(){var e=this;e.Max?e.DrawMax=e.Max:e.Scales.forEach(function(t){e.DrawMax=Math.max(e.DrawMax,t.PosVal)}),e.Min?e.DrawMin=e.Min:e.DrawMin>0&&e.DrawMax>0?e.DrawMin=0:e.DrawMin<0&&e.DrawMax<0?e.DrawMax=0:e.owner.NegativeAsZero&&(e.DrawMin=0),e.DrawMax<=e.DrawMin&&(e.DrawMin=0,e.DrawMax=100)},PrepareDrawSpace:function(e,t,r){var o,n=this;n.Space?n.DrawSpace=n.Space:(o=n.owner.fontHeight*t,n.DrawSpace=(n.DrawMax-n.DrawMin)*o/e,n.DrawSpace=yt(n.DrawSpace,n.ScaleFormatParser.positiveAnalyser.precision)),n.DrawMax<=n.DrawMin&&(n.DrawMax=n.DrawMin+1,n.DrawSpace=.2),n.DrawSpace<2*n.GetScaleTiny()&&(n.DrawSpace=2*n.GetScaleTiny()),n.Max||n.Min||r||(n.DrawMax>0&&(n.DrawMax=n.DrawSpace*Math.ceil(n.DrawMax/n.DrawSpace)),n.DrawMin<0&&(n.DrawMin=n.DrawSpace*Math.floor(n.DrawMin/n.DrawSpace)))},GetScaleTiny:function(){var e=this;return(e.DrawMax-e.DrawMin)/1e4},CalcValuePos:function(e,t){var r=this;return(e-r.DrawMin)*t/(r.DrawMax-r.DrawMin)},get ScaleCount(){return this.Scales.length},AddCustomScale:function(e,t){this.Scales.push({PosVal:e,Text:t})},EmptyCustomScale:function(){this.Scales=[]},GetScaleText:function(e){return this.Scales[e].Text},GetScaleValue:function(e){return this.Scales[e].PosVal},AddCustomCoordLine:function(e,t,r,o,n){var a=new Y;a.Width=r,a.Style=n,a.Color=o,this.CustomCoordLines.push({PosVal:e,Text:t,LinePen:a})},EmptyCustomCoordLine:function(){this.CustomCoordLines=[]}},V(Rt,pe);var Bt=function(e){var t=this;pe.call(t,e),t.ChartType=1,t.ByY2Axis=!1,t.SeriesName="",t.XValueField="",t.YValueField="",t.ZValueField="",t.FillColor=0,t.FillColorAuto=!0,t.LabelText="",t.LabelAsGroup=!1,t.LabelInBar=!1,t.LabelTextAngle=0,t.TooltipText="",t.ValueFormat="0.##",t.MarkerStyle=3,t.MarkerSize=4,t.MarkerColor=16777215,t.MarkerColorAuto=!0,t.MarkerLegendShow=!0,t.BorderPen=new Y,t.MarkerPen=new Y};Bt.prototype={afterLoad:function(e){var t=this,r=t.report.viewer.alpha,o=r.chartGraph,a=r.chartStroke,i=t.report.isWR;"StepBarChart"===t.ChartType?t.ChartType=4:u(t,"ChartType",n.ChartType),u(t,"MarkerStyle",n.PointMarkerStyle),h(t,"FillColor",o),h(t,"MarkerColor",o),t.BorderPen.loadFromJSON(e.BorderPen,a,i),t.MarkerPen.loadFromJSON(e.MarkerPen,a,i)},PrepareDraw:function(){var e=this;e.ValueFormatParser=new l.NumericFormatter(e.ValueFormat)},IsHorzGraph:function(){var e=this;return 11===e.ChartType||12===e.ChartType||13===e.ChartType},IsPercent100Graph:function(){var e=this;return 2===e.ChartType||10===e.ChartType||13===e.ChartType},IsBarChart:function(){var e=this;return 1===e.ChartType||4===e.ChartType||10===e.ChartType||11===e.ChartType||12===e.ChartType||13===e.ChartType},IsScatterGraph:function(){var e=this;return 5===e.ChartType||6===e.ChartType||8===e.ChartType||9===e.ChartType},CanGroupLabelChart:function(){var e=this;return 1===e.ChartType||11===e.ChartType},HasPointMarker:function(){var e=this;return 3===e.ChartType||7===e.ChartType||5===e.ChartType||6===e.ChartType||8===e.ChartType||9===e.ChartType},Support3D:function(){var e=this;return 1===e.ChartType||4===e.ChartType||10===e.ChartType||11===e.ChartType||12===e.ChartType||13===e.ChartType||2===e.ChartType}},V(Bt,pe);var At=function(e){var t=this;De.call(t,e),t.XAxis=new Rt(t),t.YAxis=new Rt(t),t.Y2Axis=new Rt(t),t.Series=new St(t),t.Recordset=new Ye(t),t.TitleFont=new q(t.Font),t.ValueFont=new q(t.Font),t.Title="",t.Chart3D=!1,t.Chart3DViewAngle=35,t.LegendVisible=!0,t.LegendValueVisible=!1,t.LegendShowSum=!1,t.LegendAtBottom=!1,t.LegendColumnCount=0,t.LegendSumLabel="",t.SeriesField="",t.SeriesAuto=!0,t.GroupField="",t.GroupAuto=!0,t.GroupCount=5,t.SeriesCount=2,t.AbsNegativeValue=!1,t.NegativeBarColor=255,t.BarWidthPercent=70,t.NegativeAsZero=!1,t.SingleSeriesColored=!0,t.Bar3DAxisDepth=25,t.Pie3DHeightDepth=25,t.BubbleScalePerCm=0,t.SeriesLabels=[],t.GroupLabels=[],t.values=[]};At.prototype={ControlType:11,children:["Border","XAxis","YAxis","Y2Axis","Series"],options:{tooltipBoxColor:"rgba(0,0,0,.8)",tooltipBoxCorner:4,tooltipFontSize:14,tooltipFontStyle:"normal",tooltipTitleFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",tooltipFontColor:"#fff"},afterLoad:function(e){var t,r,o=this,n=o.report.viewer.alpha,a=n.chartGraph,i=n.chartStroke,l=o.report.isWR;if(De.prototype.afterLoad.call(o,e),h(o,"NegativeBarColor",a),o.XAxis.loadFromJSON(e.XAxis,i),o.YAxis.loadFromJSON(e.YAxis,i),o.Y2Axis.loadFromJSON(e.Y2Axis,i),o.Series.loadFromJSON(e.ChartSeries),o.Recordset.loadFromJSON(e.Recordset),o.TitleFont.loadFromJSON(e.TitleFont,l),o.ValueFont.loadFromJSON(e.ValueFont,l),o.prepareValues(),t=e[o.getJsonMember("GroupLabel")],t&&(o.GroupLabels=t.split("\r")),t=e[o.getJsonMember("SeriesLabel")],t&&(o.SeriesLabels=t.split("\r")),t=e[o.getJsonMember("Value")]){for(t=t.split(","),r=t.length;r-- >0;)t[r]=+t[r];for(o.values=[],r=0;r<o.SeriesCount;)o.values.push(t.slice(r++*o.GroupCount,r*o.GroupCount))}},assign:function(e){var t=this;De.prototype.assign.call(t,e),t.TitleFont.assign(e.TitleFont),t.ValueFont.assign(e.ValueFont)},attachData:function(){var e=this,t=e.Recordset;t.prepare(),e.oSeriesField=t.FieldByName(e.SeriesField),e.oGroupField=t.FieldByName(e.GroupField),e.Series.forEach(function(e){e.oYValueField=t.FieldByName(e.YValueField),e.IsScatterGraph()&&(e.oXValueField=t.FieldByName(e.XValueField),9===e.ChartType&&(e.oZValueField=t.FieldByName(e.ZValueField)))}),e.loadDrawingData()},loadDrawingData:function(){function e(){return t.Series.items.every(function(e){return e.oYValueField&&(!e.IsScatterGraph()||e.oXValueField&&(9!==e.ChartType||e.oZValueField))})}var t=this,r=e();r?t.applyDataFromRecordset():t.values||t.EmptyValues()},applyDataFromRecordset:function(){var t,r,o,n,a,i,l=this,s=l.Recordset,c=l.Series.items,u=c[0].IsScatterGraph();for(l.SeriesAuto&&l.oSeriesField&&(l.SeriesCount=0,l.SeriesLabels=[]),!u&&l.GroupAuto&&l.oGroupField&&(l.GroupCount=0,l.GroupLabels=[]),l.EmptyValues(),s.First();!s.Eof();)t=0,l.oSeriesField&&(r=l.oSeriesField.DisplayText,t=l.GetSeriesIndexByLabel(r,!1),0>t&&l.SeriesAuto&&(t=l.SeriesCount,l.SeriesLabels.push(r),++l.SeriesCount)),o=0,l.oGroupField&&!u&&(n=l.oGroupField.DisplayText,o=l.GetGroupIndexByLabel(n,!1),0>o&&l.GroupAuto&&(o=l.GroupCount,l.GroupLabels.push(n),++l.GroupCount)),c.forEach(function(r,n){n&&(t=n),u?l.AddXYZValue(t,r.oXValueField.AsFloat,r.oYValueField.AsFloat,r.oZValueField?r.oZValueField.AsFloat:e):(a=r.oYValueField.AsFloat,i=l.Value(t,o),i&&(a+=i),l.SetValue(t,o,a))}),s.Next()},showTooltip:function(t,r){var o=this,n=o.options,a=o.context;if(t||(t=e),o.activeShape!==t&&(o.activeShape=t,a.ctx.clearRect(0,0,o.canvas.width,o.canvas.height),o.draw(),t)){var i=o.graphSerieses[t.seriesIndex];if(i.TooltipTextBuilder){var l,s=a.ctx.font,c=i.TooltipTextBuilder.generateChartDisplayText(t.seriesIndex,t.groupIndex),u=t.tooltipPos(),d=n.tooltipFontSize+2,h=0;if(a.ctx.font=p(n.tooltipFontSize,n.tooltipFontStyle,n.tooltipTitleFontFamily),i.tooltipLines>1){l=[];for(var f,g,m=0;(f=c.indexOf("\n",m))>=0;)g=c.substring(m,f-("\r"===c.charAt(f-1)?1:0)),l.push(g),h=Math.max(h,a.measureTextWidth(g)),m=f+1;g=c.substr(m),l.push(g),h=Math.max(h,a.measureTextWidth(g))}else h=a.measureTextWidth(c);var C=new J(u.x,u.y,u.x+h,u.y+d*i.tooltipLines-2);if(C.InflateRect(n.tooltipBoxCorner,n.tooltipBoxCorner),C.OffsetRect(Math.min(o.canvas.width-C.right,0),Math.min(o.canvas.height-C.bottom,0)),a.setFillStyle(n.tooltipBoxColor),a.roundRectangle(C.left,C.top,C.Width(),C.Height(),n.tooltipBoxCorner,n.tooltipBoxCorner,1),a.setFillStyle(n.tooltipFontColor),l){var b=C.left+n.tooltipBoxCorner,v=C.top+n.tooltipBoxCorner;l.forEach(function(e){a.drawText(e,b,v),v+=d})}else a.drawTextCenter(c,(C.left+C.right)/2,(C.top+C.bottom-n.tooltipFontSize)/2);a.resetFillStyle(),a.ctx.font=s}}},prepareCanvas:function(){function e(){var e,t,r=n.Series.items,o=r.length;for(e=0;o>e;e++)if(t=r[e],t.LabelText&&(t.LabelTextBuilder=new s.TextBuilder(n,t.LabelText)),t.TooltipText){t.TooltipTextBuilder=new s.TextBuilder(n,t.TooltipText),t.tooltipLines=1;for(var i=0;(i=t.TooltipText.indexOf("\n",i))>=0;)++i,++t.tooltipLines;a=1}}function t(){var e=_(n.Chart3DViewAngle);n.xView3DDepth=Math.cos(e)*n.Bar3DAxisDepth,n.yView3DDepth=Math.sin(e)*n.Bar3DAxisDepth}function r(){var e,t,r=n.Series.items,o=n.graphs=[],a=n.graphSerieses=[];for(e=0;e<n.SeriesCount;e++){t=e<r.length?r[e]:r[0],a.push(t);for(var i=0;i<o.length;i++)if(t.ChartType===a[o[i][0]].ChartType){o[i].push(e);break}i===o.length&&o.push([e])}}function o(e){var t,r,o=n.shapes.length;if(n.graphs.length>1)for(t=0;o>t;t++)if(r=n.shapes[t],!r.rect&&r.inRange(e.x,e.y))return r;for(t=0;o>t;t++)if(r=n.shapes[t],r.inRange(e.x,e.y))return r;return 0}var n=this,a=0;n.Chart3DReal=n.Chart3D&&n.Support3D(),n.xView3DDepth=0,n.yView3DDepth=0,n.Chart3DReal&&t(),e(),r(),a&&H(n,["mousemove","touchstart","touchmove","mouseout"],function(e){var t,r;"mouseout"!==e.type&&(t=k(e),r=o(t)),n.showTooltip(r,t)})},cloneDraw:function(e){var t=this,r=new At(t.owner);return r.assign(t),r},draw:function(e){function t(){function e(){var e,o,n;c.DrawBubbleScalePerCm=c.BubbleScalePerCm,c.DrawBubbleScalePerCm<=0&&(e=r*t*gt,o=e/(mt*mt),c.DrawBubbleScalePerCm=g/o),n=Math.sqrt(p/c.DrawBubbleScalePerCm)*mt,0===v.Max&&(v.DrawMax+=(v.DrawMax-v.DrawMin)*(n/2)/t),0==b.Max&&(b.DrawMax+=(b.DrawMax-b.DrawMin)*(n/2)/r)}var t,r,o=c.IsScatterGraph(),n=c.Series.items,a=n[0].ChartType,u=10===a||13===a,p=0,g=0;for(b.PrepareDraw(),v.PrepareDraw(),T.PrepareDraw(),l=n.length,i=0;l>i;i++)n[i].PrepareDraw(this);b.Used=!0,b.IsValueAxis=!1,v.IsValueAxis=!0,T.IsValueAxis=!0,c.Title&&(x=f(c.getUsingTitleFont())+Tt),o?(b.IsValueAxis=!0,m.forEach(function(e){e.forEach(function(e){var t,r=c.values[e],o=r?r.length:0,n=b,a=c.YAxisOfSeries(C[e]);for(a.Used=!0,i=0;o>i;i++)t=r[i],t.y<a.DrawMin&&(a.DrawMin=t.y),t.y>a.DrawMax&&(a.DrawMax=t.y),t.x<n.DrawMin&&(n.DrawMin=t.x),t.x>n.DrawMax&&(n.DrawMax=t.x),p<t.z&&(p=t.z),g+=t.z})}),b.PrepareDrawRange()):m.forEach(function(e){var t,r,o=C[e[0]].ChartType,n=4===o||10===o||12===o||13===o;for(t=0;t<c.GroupCount;t++)if(r=0,e.forEach(function(e){var o=c.Value(e,t),a=c.YAxisOfSeries(C[e]);n?r+=o:(a.Used=!0,c.AbsNegativeValue&&(o=Math.abs(o)),o<a.DrawMin&&(a.DrawMin=o),o>a.DrawMax&&(a.DrawMax=o))}),n){var a=C[e[0]],i=c.YAxisOfSeries(a);i.Used=!0,u?(i.DrawMin=0,i.DrawMax=100):(r<i.DrawMin&&(i.DrawMin=r),r>i.DrawMax&&(i.DrawMax=r))}}),v.Used||T.Used||(v.Used=!0),v.Used&&(s=v.DrawMax),T.Used&&s<T.DrawMax&&(s=T.DrawMax),v.PrepareDrawRange(),T.PrepareDrawRange(),t=h-x-b.CalcLabelHeight()-b.CalcHorzAxisHeight(!0),t=Math.max(t,1),v.PrepareDrawSpace(t,3,u),T.PrepareDrawSpace(t,3,u),o&&(r=d-v.CalcLabelHeight()-v.CalcVertAxisWidth()-T.CalcLabelHeight()-T.CalcVertAxisWidth(),r=Math.max(r,1),b.PrepareDrawSpace(r,6,!1),t=h-x-b.CalcLabelHeight()-b.CalcHorzAxisHeight(!1),t=Math.max(t,1),9===n[0].ChartType&&e())}function r(){var e;c.LegendAtBottom?(e=c.DrawHorzSideLegend(p),p.bottom-=e+Tt):(e=c.DrawVertSideLegend(p),p.right-=e+Tt)}function o(){g.SelectFont(c.getUsingTitleFont()),g.drawTextCenter(c.Title,(p.left+p.right)/2,p.top+Tt/2),g.RestoreFont()}function n(e){var t,r,o,n,a,i,l,u,d=c.Series.items,h=b.CalcLabelHeight(),p=b.CalcHorzAxisHeight(!1),x=v.CalcLabelHeight(),y=v.CalcVertAxisWidth(),S=T.CalcLabelHeight(),F=T.CalcVertAxisWidth(),w=0,D=0,P=!1;for(r=d.length,t=0;r>t;t++)if(o=d[t],o.LabelTextBuilder&&!o.LabelInBar){P=!0;break}if(!P&&c.Title||(w=f(c.getUsingValueFont())/(o.LabelTextBuilder?1:2),c.IsDrawNegativeGraph()&&(D=w),o.LabelTextAngle&&(g.SelectFont(c.getUsingValueFont()),w=Math.max(Math.abs(g.measureTextWidth(o.ValueFormatParser.format(s))*Math.sin(_(o.LabelTextAngle))),w),g.RestoreFont())),a=new J(e.left+x+y,e.top+w,e.right-S-F,e.bottom-h-p-D),l=new J(e.left,e.top+w,e.left+x,e.bottom-h-p-D),v.DrawVertAxisLabel(l),u=new J(e.right-S,l.top,e.right,l.bottom),T.DrawVertAxisLabel(u),l.left=l.right,l.right+=y,v.DrawVertAxis(l,a,!1),u.right=u.left,u.left-=F,T.DrawVertAxis(u,a,!0),i=new J(e.left+x+y,e.bottom-h,e.right-S-F,e.bottom),b.DrawHorzAxisLabel(i),c.IsDrawNegativeGraph()?(i.top=l.bottom-v.CalcValuePos(0,l.Height()),i.bottom=i.top+p):(i.top=a.bottom,i.bottom=i.top+p),c.Chart3D&&b.DrawHorzAxis(i,a,!1),!a.IsRectEmpty()&&(c.IsScatterGraph()||c.GroupCount)){for(g.SelectFont(c.getUsingValueFont()),r=m.length,t=0;r>t;t++)switch(o=m[t],n=C[o[0]].ChartType){case 1:c.DrawBar(o,a);break;case 4:case 10:c.DrawStackedBar(o,n,a);break;case 3:case 7:c.DrawLine(o,n,a);break;case 9:c.DrawBubble(o,a);break;default:c.DrawXYScatterGraph(o,n,a)}g.RestoreFont()}!c.Chart3D&&b.DrawHorzAxis(i,a,!1)}function a(e){var t,r,o,n,a,i,l,u,d=c.Series.items,h=b.CalcLabelHeight(),p=b.CalcVertAxisWidth(),f=v.CalcLabelHeight(),x=v.CalcHorzAxisHeight(!1),y=T.CalcLabelHeight(),S=T.CalcHorzAxisHeight(!1),F=0,w=0,D=!1;for(r=d.length,t=0;r>t;t++)if(o=d[t],o.LabelTextBuilder&&!o.LabelInBar){D=!0;break}if(D&&(g.SelectFont(c.getUsingValueFont()),F=g.measureTextWidth(o.ValueFormatParser.format(s)),c.IsDrawNegativeGraph()&&(w=F),g.RestoreFont()),a=new J(e.left+h+p+w,e.top+f+x,e.right-F,e.bottom-y-S),l=new J(a.left,e.top,a.right,e.top+f),v.DrawHorzAxisLabel(l),u=new J(l.left,e.bottom-y,l.right,e.bottom),T.DrawHorzAxisLabel(u),l.top=l.bottom,l.bottom+=x,v.DrawHorzAxis(l,a,!0),u.bottom=u.top,u.top-=S,T.DrawHorzAxis(u,a,!1),i=new J(e.left,a.top,e.left+h,a.bottom),b.DrawVertAxisLabel(i),i.left=i.right,i.right+=p,c.Chart3D&&b.DrawVertAxis(i,a,!1,v.Used),!a.IsRectEmpty()&&c.GroupCount){for(g.SelectFont(c.getUsingValueFont()),r=m.length,t=0;r>t;t++)switch(o=m[t],n=C[o[0]].ChartType){case 11:c.DrawColumnBar(o,a);break;case 12:case 13:c.DrawStackedColumnBar(o,n,a)}g.RestoreFont()}!c.Chart3D&&b.DrawVertAxis(i,a,!1)}var i,l,s,c=this,u=c.canvas,d=u.width,h=u.height,p=new J(0,0,d,h),g=c.context=new K(u.getContext("2d")),m=c.graphs,C=c.graphSerieses,b=c.XAxis,v=c.YAxis,T=c.Y2Axis,x=0;c.fontHeight=f(c.getUsingFont()),c.valueFontHeight=f(c.getUsingValueFont()),g.SelectFont(c.getUsingFont()),g.setDefaultFillColor(c.ForeColor),c.report.singleChart&&(p.left+=c.PaddingLeft,p.top+=c.PaddingTop,p.right-=c.PaddingRight,p.bottom-=c.PaddingBottom),c.toUpdateShapes=e,e&&(c.shapes=[]),t(),c.LegendVisible&&c.SeriesCount&&r(),c.Title&&o(),p.top+=x,p.IsRectEmpty()||(2===c.Series.items[0].ChartType?c.DrawPie(p):c.IsHorzGraph()?a(p):n(p)),g.RestoreFont()},DrawPie:function(e){var t,r,o,n,a=this,i=a.context,l=0,s=0,c=e.Height(),u=e.Width(),d=u*c,h=Number.MAX_VALUE,p=-1,f=-1;for(t=0;t<a.GroupCount;t++){for(r=0;r<a.SeriesCount;r++)i.SelectFont(a.getUsingValueFont()),a.graphSerieses[r].LabelTextBuilder&&(l=Math.max(l,i.measureTextWidth(a.GetDrawValueText(r,t)))),i.RestoreFont();s=Math.max(s,i.measureTextWidth(a.GroupLabel(t)))}for(t=1;t<=a.GroupCount;t++)r=Math.floor((a.GroupCount+t-1)/t),o=Math.min(u/r,c/t),o=d-o*o*a.GroupCount,h>o&&(h=o,p=r,f=t);for(i.SelectFont(a.getUsingValueFont()),o=0;o<a.GroupCount;o++)t=Math.floor(o/p),r=o%p,n=new J(e.left+u*r/p,e.top+c*t/f,e.left+u*(r+1)/p,e.top+c*(t+1)/f),a.Chart3DReal?i.drawTextCenter("三维饼图暂不支持!!!",(n.left+n.right)/2,(n.top+n.bottom-16)/2):a.DrawOne2DPie(o,n,l,s);i.RestoreFont()},DrawOne2DPie:function(e,t,r){function o(){var r,o,f,m,b,v,T=u.getUsingValueFont(),x=T.Italic?h(T):0,y=new J(0,0,0,0);for(c=0,n=0;g>n;n++)s=_(C[n]),o=i+Math.cos(s)*a,f=l-Math.sin(s)*a,v=u.GetDrawValueText(n,e),b=d.measureTextWidth(v)+x,r=new J(o,f,o+b,f+p),s<Math.PI/2?(r.OffsetRect(2,-p),1===c&&r.top<y.bottom&&(m=y.right-r.left+2,r.right+m<t.right?r.OffsetRect(m,0):r.OffsetRect(0,y.bottom-r.top),d.drawLine(o,f,r.left,r.bottom-b.cy/3)),c=1):s<Math.PI?(r.OffsetRect(-b-2,-p),2===c&&r.top<y.bottom&&(m=r.right-y.left+2,r.left-m>t.left?r.OffsetRect(-m,0):r.OffsetRect(0,y.bottom-r.top),d.drawLine(o,f,r.right,r.bottom-b.cy/3)),c=2):s<1.5*Math.PI?(r.OffsetRect(-b-2,0),3===c&&r.bottom>y.top&&(m=r.right-y.left+2,r.left-m>t.left?r.OffsetRect(-m,0):r.OffsetRect(0,r.bottom-y.top),d.drawLine(o,f,r.right,r.top+b.cy/3)),c=3):(r.OffsetRect(2,0),4===c&&r.bottom>y.top&&(m=y.right-r.left+2,r.right-m<t.right?r.OffsetRect(m,0):r.OffsetRect(0,r.bottom-y.top),d.drawLine(o,f,r.left,r.top+b.cy/3)),c=4),u.DrawLabelText(v,(r.left+r.right)/2,r.top),y=r}var n,a,i,l,s,c,u=this,d=u.context,h=u.fontHeight,p=u.valueFontHeight,f=!1,g=u.SeriesCount,m=0,C=[];for(n=0;g>n;n++)m+=u.Value(n,e),u.graphSerieses[n].LabelTextBuilder&&(f=!0);if(!(0>=m||(i=t.Width()-2*r-2*xt,l=t.Height()-h-2*p-2*xt,0>=i||0>=l||(a=Math.min(i,l)/2,f?t.InflateRect(-xt,-xt):t.InflateRect(a-i/2,a-l/2),t.bottom-=h,t.IsRectEmpty())))){for(u.DrawLabelText(u.GroupLabel(e),(t.left+t.right)/2,t.bottom),i=(t.left+t.right)/2,l=(t.top+t.bottom)/2,s=0,n=0;g>n;n++)c=s+360*u.Value(n,e)/m,u.toUpdateShapes&&u.shapes.push(new Dt(n,e,i,l,a,s,c)),d.setFillColor(u.GetGraphFillColor(n)),d.pie(i,l,a,s,c),f&&C.push((s+c)/2),s=c;d.resetFillStyle(),f&&o()}},DrawColumnBar:function(e,t){var r,o,n,a,i,l,s,c,u,d,h,p,f,g=this,m=g.context,C=g.graphSerieses,b=g.CalcColumnBarCount(),v=g.CalcFirtColumnBarIndex(e),T=t.Width()-g.xView3DDepth,x=t.Height()-g.yView3DDepth,y=g.IsDrawNegativeGraph()?g.YAxis.CalcValuePos(0,T):t.left+1,S=e.length,F=g.IsDrawNegativeGraph(),w=[];for(a=0;a<g.GroupCount;a++)for(c=g.XAxis.CalcGroupPos(x,a),u=c.EndPos-c.BeginPos,r=t.top+c.BeginPos,g.Y2Axis.Used&&(r+=g.yView3DDepth),o=S;o-- >0;)i=e[o],l=C[i],n=g.Value(i,a),d=g.AbsNegativeValue&&0>n,d&&(n=-n),f=new J(0,r+u*(v+o)/b,0,r+u*(v+o+1)/b),p=g.YAxisOfSeries(l).CalcValuePos(n,T),F?(f.left=t.left+y,f.right=Math.min(t.left+p,t.right),y>p&&(p=f.left,f.left=f.right,f.right=p)):(f.left=t.left,f.right=Math.min(t.left+Math.max(0,p),t.right)),w.push(f),g.toUpdateShapes&&g.shapes.push(new wt(i,a,f)),h=d?g.NegativeBarColor:g.GetGraphFillColor(g.IsColorSingleBar()?a:i),g.DrawRectBar(f,h,l.BorderPen,!0,!0,n>=0);for(a=0;a<g.GroupCount;a++)if(l=C[e[0]],l.LabelAsGroup){for(s=g.GetDrawValueText(e[0],a),p=-9999,o=0;S>o;o++)f=w[a*S+o],p<f.right&&(p=f.right);g.DrawValueText(l,s,p+xt+m.measureTextWidth(s)/2,(w[a*S].top+w[a*S+S-1].bottom+g.valueFontHeight)/2)}else for(o=0;S>o;o++)i=e[o],l=C[i],l.LabelTextBuilder&&(s=g.GetDrawValueText(i,a),f=w[a*S+o],l.LabelInBar?g.DrawHorzBarText(s,f):g.DrawValueText(l,s,f.right+xt+m.measureTextWidth(s)/2,(f.top+f.bottom+g.valueFontHeight)/2))},DrawStackedColumnBar:function(e,t,r){var o,n,a,i,l,s,c,u,d,h,p,f,g,m,C=this,b=C.context,v=C.graphSerieses,T=C.CalcColumnBarCount(),x=C.CalcFirtColumnBarIndex(e),y=r.Width()-C.xView3DDepth,S=r.Height()-C.yView3DDepth,F=e.length,w=[];for(a=0;a<C.GroupCount;a++){for(s=C.XAxis.CalcGroupPos(S,a),c=s.EndPos-s.BeginPos,d=r.top+s.BeginPos,C.Y2Axis.Used&&(d+=C.yView3DDepth),f=d+c*x/T,g=d+c*(x+1)/T,h=r.left,o=0;F>o;o++)i=e[o],l=v[i],n=C.Value(i,a),13===t&&(n*=100/C.CalcGroupTotalValue(e,a)),p=Math.max(0,C.YAxisOfSeries(l).CalcValuePos(n,y)),m=new J(h,f,Math.min(r.right,h+p),g),w.push(m),C.toUpdateShapes&&C.shapes.push(new wt(i,a,m)),u=C.GetGraphFillColor(i),C.DrawRectBar(m,u,l.BorderPen,!0,o===F-1,!0),h+=p;if(l.LabelInBar)for(o=0;F>o;o++)i=e[o],l=v[i],l.LabelTextBuilder&&C.DrawHorzBarText(C.GetDrawValueText(i,a),w[a*F+o]);else i=e[0],l=v[i],n=C.GetDrawValueText(i,a),C.DrawValueText(l,n,h+xt+b.measureTextWidth(n)/2,(f+g+C.valueFontHeight)/2)}},DrawBar:function(e,t){var r,o,n,a,i,l,s,c,u,d,h,p,f,g=this,m=g.graphSerieses,C=g.CalcBarCount(),b=g.CalcFirtBarIndex(e),v=g.IsDrawNegativeGraph(),T=t.Height()-g.yView3DDepth,x=v?g.YAxis.CalcValuePos(0,T):t.bottom+1,y=e.length,S=[];for(a=0;a<g.GroupCount;a++)for(c=g.XAxis.CalcGroupPos(t.Width()-g.xView3DDepth,a),u=c.EndPos-c.BeginPos,n=b,r=0;y>r;r++)i=e[r],l=m[i],o=g.Value(i,a),d=g.AbsNegativeValue&&0>o,d&&(o=-o),f=new J(t.left+c.BeginPos+u*n/C,0,t.left+c.BeginPos+u*(n+1)/C,0),p=g.YAxisOfSeries(l).CalcValuePos(o,T),v?(f.top=Math.max(t.bottom-p,t.top),f.bottom=t.bottom-x,x>p&&(p=f.top,f.top=f.bottom,f.bottom=p)):(f.top=t.bottom-p,f.bottom=t.bottom),S.push(f),g.toUpdateShapes&&g.shapes.push(new wt(i,a,f)),h=d?g.NegativeBarColor:g.GetGraphFillColor(g.IsColorSingleBar()?a:i),g.DrawRectBar(f,h,l.BorderPen,!1,!0,o>=0),++n;for(a=0;a<g.GroupCount;a++)if(i=e[0],l=m[i],l.LabelAsGroup){for(s=g.GetDrawValueText(i,a),p=9999,r=0;y>r;r++)f=S[a*y+r],p>f.top&&(p=f.top);g.DrawValueText(l,s,(S[a*y].left+S[a*y+y-1].right+g.xView3DDepth)/2,p-xt/2-g.yView3DDepth)}else for(r=0;y>r;r++)i=e[r],l=m[i],l.LabelTextBuilder&&(s=g.GetDrawValueText(i,a),f=S[a*y+r],l.LabelInBar?g.DrawVertBarText(s,f):(p=f.top-xt/2-g.yView3DDepth,g.IsDrawNegativeGraph()&&t.bottom-x<f.bottom&&(p=f.bottom+g.valueFontHeight),
g.DrawValueText(l,s,(f.left+f.right+g.xView3DDepth)/2,p)))},DrawStackedBar:function(e,t,r){var o,n,a,i,l,s,c,u,d,h,p,f,g,m=this,C=m.graphSerieses,b=m.CalcBarCount(),v=m.CalcFirtBarIndex(e),T=r.Width()-m.xView3DDepth,x=r.Height()-m.yView3DDepth,y=e.length,S=[];for(a=0;a<m.GroupCount;a++){for(s=m.XAxis.CalcGroupPos(T,a),c=s.EndPos-s.BeginPos,h=r.left+s.BeginPos+c*v/b,p=r.left+s.BeginPos+c*(v+1)/b,f=r.bottom,o=0;y>o;o++)i=e[o],l=C[i],n=m.Value(i,a),10===t&&(n*=100/m.CalcGroupTotalValue(e,a)),d=m.YAxisOfSeries(l).CalcValuePos(n,x),g=new J(h,Math.min(Math.max(f-d,r.top),f),p,f),S.push(g),m.toUpdateShapes&&m.shapes.push(new wt(i,a,g)),u=m.GetGraphFillColor(i),m.DrawRectBar(g,u,l.BorderPen,!1,o===y-1,!0),f-=d;if(l.LabelInBar)for(o=0;y>o;o++)i=e[o],l=C[i],l.LabelTextBuilder&&m.DrawVertBarText(m.GetDrawValueText(i,a),S[a*y+o]);else i=e[0],l=C[i],m.DrawValueText(l,m.GetDrawValueText(i,a),(h+p+m.xView3DDepth)/2,f-xt/2-m.yView3DDepth)}},DrawRectBar:function(e,t,r,o,n,a){function i(e,t){s.setFillColor(e),s.SelectPen(new Y(1,e,1)),s.drawPolyLine(t,1,1),s.RestorePen(),s.resetFillStyle()}var l=this,s=l.context,c=A(t),u=E(t),d=[];l.Chart3DReal&&(d.length=8,d[0]=e.right-1,d[1]=e.top,d[2]=d[0]+l.xView3DDepth,d[3]=d[1]-l.yView3DDepth,(n||o)&&(d[4]=d[2]-e.Width(),d[5]=d[3],d[6]=e.left,d[7]=d[1],i(c,d)),!n&&o||(d[4]=d[2],d[5]=e.bottom-l.yView3DDepth,d[6]=e.right-1,d[7]=e.bottom,i(u,d))),l.Chart3DReal?(s.setFillColor(t),s.rectangle2(e,1),s.resetFillStyle()):s.drawBar(e,r,t,o?a?1:3:a?0:2)},DrawLine:function(e,t,r){var o,n,a,i,l,s,c,u,d=this,h=d.context,p=e.length,f=[];for(o=0;p>o;o++)f.push([]);for(n=0;n<d.GroupCount;n++)for(c=r.left+d.XAxis.CalcGroupPos(r.Width()-d.xView3DDepth,n).LabelMiddlePos,o=0;p>o;o++){a=e[o],i=d.graphSerieses[a];var g={x:c,y:r.bottom-d.YAxisOfSeries(i).CalcValuePos(d.Value(a,n),r.Height())};f[o].push(g),d.toUpdateShapes&&d.shapes.push(new Pt(a,n,g.x,g.y,i.MarkerSize))}for(o=0;p>o;o++)(7===t?d.DrawCurveLine:d.DrawPolyLine).call(d,f[o],e[o]);for(o=0;p>o;o++)d.DrawPointsMarker(f[o],e[o]);for(n=0;n<d.GroupCount;n++)for(o=0;p>o;o++)a=e[o],i=d.graphSerieses[a],i.LabelTextBuilder&&(u=r.bottom-d.YAxisOfSeries(i).CalcValuePos(d.Value(a,n),r.Height()),-1!==i.MarkerStyle&&(u-=i.MarkerSize/2),l=d.GetDrawValueText(a,n),s=h.measureTextWidth(l),c=f[o][n].x+s/2,d.GroupCount>1&&(c-=s*n/(d.GroupCount-1)),d.DrawValueText(i,l,c,u))},DrawBubble:function(e,t){var r,o,n,a,i,l,s,c,u,d=this,h=(d.context,e.length),p=[],f=[];for(r=0;h>r;r++)for(a=e[r],i=d.graphSerieses[a],c=[],u=[],p.push(c),f.push(u),s=d.ValueCount(a),n=0;s>n;n++){o=d.Value(a,n),l=Math.sqrt(o.z/d.DrawBubbleScalePerCm)*mt/2;var g={x:t.left+d.XAxis.CalcValuePos(o.x,t.Width()),y:t.bottom-d.YAxisOfSeries(i).CalcValuePos(o.y,t.Height())};c.push(g),u.push(l),d.toUpdateShapes&&d.shapes.push(new Pt(a,n,g.x,g.y,l)),i.LabelTextBuilder&&d.DrawValueText(i,d.GetDrawValueText(a,n),g.x,g.y-l)}for(r=0;h>r;r++)a=e[r],d.DrawPointsMarker(p[a],a,f[a])},DrawXYScatterGraph:function(e,t,r){var o,n,a,i,l,s,c,u=this,d=e.length,h=[];for(o=0;d>o;o++)for(i=e[o],l=u.graphSerieses[i],c=[],h.push(c),s=u.ValueCount(i),a=0;s>a;a++){n=u.Value(i,a);var p={x:r.left+u.XAxis.CalcValuePos(n.x,r.Width()),y:r.bottom-u.YAxisOfSeries(l).CalcValuePos(n.y,r.Height())};c.push(p),u.toUpdateShapes&&u.shapes.push(new Pt(i,a,p.x,p.y,l.MarkerSize)),l.LabelTextBuilder&&u.DrawValueText(l,u.GetDrawValueText(i,a),p.x,p.y-l.MarkerSize)}if(6===t||8===t)for(o=0;d>o;o++)i=e[o],l=u.graphSerieses[i],(8===t?u.DrawCurveLine:u.DrawPolyLine).call(u,h[i],i);for(o=0;d>o;o++)i=e[o],u.DrawPointsMarker(h[i],i)},DrawPolyLine:function(e,t){var r,o,n=this,a=n.context,i=e.length,l=[];for(r=0;i>r;r++)l.push(e[r].x,e[r].y);o=n.graphSerieses[t].BorderPen.clone(),o.Color=n.GetGraphFillColor(t),a.SelectPen(o),a.drawPolyLine(l),a.RestorePen()},DrawCurveLine:function(e,t){function r(e,t,r){var o=.4,n=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),a=Math.sqrt(Math.pow(r.x-t.x,2)+Math.pow(r.y-t.y,2)),i=n+a,l=i>0?o*n/i:1,s=i>0?o*a/i:1;return{inner:{x:t.x-l*(r.x-e.x),y:t.y-l*(r.y-e.y)},outer:{x:t.x+s*(r.x-e.x),y:t.y+s*(r.y-e.y)}}}var o,n,a,i,l=this,s=l.context,c=e.length,u=[];if(c>1){for(a=e[0],i=r(a,a,e[1]),u.push(a,i.outer),o=1;c-1>o;o++)a=e[o],i=r(e[o-1],a,e[o+1]),u.push(i.inner,a,i.outer);a=e[o],i=r(e[o-1],a,a),u.push(i.inner,a),n=l.graphSerieses[t].BorderPen.clone(),n.Color=l.GetGraphFillColor(t),s.SelectPen(n),s.polyBezier(u),s.RestorePen()}},DrawPointsMarker:function(e,t,o){var n,a=this,i=a.context,l=a.graphSerieses[t],s=e.length;if(-1!==l.MarkerStyle)for(n=0;s>n;n++)i.DrawPointMarker(r(e[n].x,e[n].y,o?o[n]:l.MarkerSize),l.MarkerStyle,l.MarkerPen,l.MarkerColorAuto?a.GetGraphFillColor(t):l.MarkerColor)},DrawHorzSideLegend:function(e){var t,r,o,n,a,i,l,s,c=this,u=c.context,d=c.LegendRealShowValue(),h=c.LegendColumnCount>0?c.LegendColumnCount:999,p=e.Width(),f=2*c.fontHeight,g=3*f/4,m=c.LegendItemCount(),C=p,b=[],v={Count:0,Width:0};for(r=0;m>r;++r)t=Tt+g+xt,t+=u.measureTextWidth(c.LegendItemLabel(r)),d&&(t+=xt+u.measureTextWidth(c.LegendItemValueText(r))),(t>C||v.Count>=h)&&v.Width>0&&(b.push(v),v={Count:0,Width:0},C=p),v.Count++,v.Width+=t,C-=t;for(v.Count>0&&b.push(v),n=xt+b.length*f,o=0,v=b[o],r=e.bottom-n+xt,a=new J((e.left+e.right-v.Width)/2,e.bottom-n+xt,0,r+f),r=0;m>r;++r)v.Count<=0&&(o++,v=b[o],a.left=(e.left+e.right-v.Width)/2,a.top=a.bottom,a.bottom+=f),v.Count--,a.left+=Tt,(m-1>r||!c.LegendIsSumItem(r))&&(t=(a.top+a.bottom-g)/2,i=new J(a.left,t,a.left+g,t+g),c.DrawLegendGraph(r,i)),a.left+=g,l=(a.top+a.bottom-c.fontHeight)/2,s=c.LegendItemLabel(r),a.left+=xt,a.right=a.left+u.measureTextWidth(s),u.drawText(s,a.left,l),a.left=a.right,d&&(s=c.LegendItemValueText(r),a.left+=xt,a.right=a.left+u.measureTextWidth(s),u.drawText(s,a.left,l),a.left=a.right);return n},DrawVertSideLegend:function(e){var t,r,o,n,a,i,l,s,c,u,d,h,p,f,g=this,m=g.context,C=g.LegendRealShowValue(),b=g.LegendRealShowSum(),v=g.LegendItemCount(),T=g.LegendColumnCount,x=2*g.fontHeight,y=3*x/4,S=e.Height()-2*xt,F=0,w=0,D=2*xt,P=[],R=[];for(n=0;v>n;++n)i=m.measureTextWidth(g.LegendItemLabel(n)),i>F&&(F=i),l=x,D+=l,P.push(l),C&&(i=m.measureTextWidth(g.LegendItemValueText(n)),i>w&&(w=i));if(t=F+xt,w>0&&(t+=w+xt),0>=T&&(T=1,D>e.Height()))for(i=0,n=0;v>n;++n)i>S&&(T++,i=P[n]);if(S<P[0])return 0;for(n=0,i=0;T>i;i++)for(l=S;v>n&&l>P[n];)l-=P[n++];for(r=v>n,r&&(i=v,b&&(n--,i--),P.splice(n,i-n)),i=P.length,l=T,s=Math.ceil(i/T),R=M(T,0),b&&(R[T-1]=s,i-=s,l--,l>0&&(s=Math.ceil(i/l))),n=0;l>n;n++)R[n]=Math.min(s,i),i-=R[n];for(l=0,n=0,i=0;T>i;i++){for(s=0,a=0;a<R[i];a++)s+=P[n++];s>l&&(l=s)}for(D=Math.min(e.Height(),l+2*xt),c=xt+y+xt+t,u=c*T+xt,u>2*e.Width()/3&&(u=2*e.Width()/3,l=c,c=(u-xt)/T,F-=l-c),i=e.right-u,l=(e.top+e.bottom-D)/2,d=new J(i,l,i+u,l+D),m.rectangle2(d),i=d.left+xt,l=c-xt,h=new J(i,0,i+y,0),i+=h.Width()+xt,l-=h.Width()+xt,p=new J(i,d.top+xt,i+Math.min(l,F+xt),0),i+=p.Width()+xt,l-=p.Width()+xt,f=new J(i,0,i+l,0),i=P.length-1,b&&i--,l=0,n=0;T>n;n++){for(p.top=d.top+xt,a=0;a<R[n];++a)p.bottom=p.top+P[l],s=(p.top+p.bottom-g.fontHeight)/2,r&&i===l?m.drawText("... ...",h.left,s):(h.top=(p.top+p.bottom-y)/2,h.bottom=h.top+y,o=b&&l===P.length-1,o?l=v-1:g.DrawLegendGraph(l,h),m.drawText(g.LegendItemLabel(l),p.left,s),C&&m.drawText(g.LegendItemValueText(l),f.left,s),o&&(m.SelectPen(new Y(.5,0,1)),m.DrawHorzLine(p.top,h.left,f.right),m.RestorePen(new Y(.5,0,1)))),p.top+=P[l++];h.left+=c,h.right+=c,p.left+=c,p.right+=c,f.left+=c,f.right+=c}return u},DrawLegendGraph:function(e,t){var r,o=this,n=o.context,a=!1,i=o.GetGraphFillColor(e);o.LegendIsGroup()||(r=o.graphSerieses[e],a=r.HasPointMarker()&&r.MarkerLegendShow,a&&n.DrawPointMarker(t,r.MarkerStyle,r.MarkerPen,i)),a||(n.setFillColor(i),n.rectangle2(t,1),n.resetFillStyle())},DrawValueText:function(e,t,r,o){var n,a=this,i=a.context,l=a.valueFontHeight;e.LabelTextAngle?(n=_(e.LabelTextAngle),r-=(i.measureTextWidth(t)*Math.cos(n)+Math.abs(l*Math.sin(n)))/2,o-=Math.abs(l*Math.cos(n)),i.drawTextRotate(t,r,o,e.LabelTextAngle)):i.drawTextCenter(t,r,o-l)},DrawLabelText:function(e,t,r){var o=this.context;o.drawTextCenter(e,t,r)},DrawVertBarText:function(e,t){var r=this,o=r.context;o.drawTextRotate(e,(t.left+t.right-r.fontHeight)/2,(t.top+t.bottom+o.measureTextWidth(e))/2,90)},DrawHorzBarText:function(e,t){var r=this,o=r.context,n=o.measureTextWidth(e),a=r.fontHeight,i=(t.left+t.right-n)/2,l=(t.top+t.bottom-a)/2;o.drawText(e,i,l)},CalcBarCount:function(){var e,t,r,o=this,n=o.graphs.length,a=0;for(e=0;n>e;e++)t=o.graphs[e],r=o.graphSerieses[t[0]].ChartType,1===r?a+=t.length:4!==r&&10!==r||a++;return a},CalcColumnBarCount:function(){var e,t,r,o=this,n=o.graphs.length,a=0;for(e=0;n>e;e++)t=o.graphs[e],r=o.graphSerieses[t[0]].ChartType,11===r?a+=t.length:12!==r&&13!==r||a++;return a},CalcFirtBarIndex:function(e){var t,r,o,n=this,a=n.graphs,i=a.length,l=0;for(t=0;i>t&&(r=a[t],r!==e);t++)o=n.graphSerieses[r[0]].ChartType,1===o?l+=r.length:4!==o&&10!==o||++l;return l},CalcFirtColumnBarIndex:function(e){var t,r,o,n=this,a=n.graphs,i=a.length,l=0;for(t=0;i>t&&(r=a[t],r!==e);t++)o=n.graphSerieses[r[0]].ChartType,11===o?l+=r.length:12!==o&&13!==o||++l;return l},CalcGroupTotalValue:function(e,t){var r,o=this,n=e.length,a=0;for(r=0;n>r;r++)a+=o.Value(e[r],t);return a},IsScatterGraph:function(){return this.Series.items[0].IsScatterGraph()},IsHorzGraph:function(){return this.Series.items[0].IsHorzGraph()},IsColorSingleBar:function(){var e=this;return 1==e.SeriesCount&&e.SingleSeriesColored},IsDrawNegativeGraph:function(){var e=this;return!e.Series.items.some(function(e){return e.ByY2Axis})&&e.YAxis.DrawMax>=0&&e.YAxis.DrawMin<0&&!e.AbsNegativeValue},LegendIsGroup:function(){var e=this,t=e.Series.items[0].ChartType;return 1===e.SeriesCount&&e.SingleSeriesColored&&(1===t||3===t||7===t||11===t)},LegendRealShowValue:function(){var e=this;return e.LegendValueVisible&&(!e.IsScatterGraph()||9===e.Series.items[0].ChartType)},LegendRealShowSum:function(){var e=this;return e.LegendShowSum&&e.LegendRealShowValue()},LegendItemCount:function(){var e=this;return(e.LegendIsGroup()?e.GroupCount:e.SeriesCount)+(e.LegendRealShowSum()?1:0)},LegendIsSumItem:function(e){var t=this;return t.LegendIsGroup()?e===t.GroupCount:e===t.SeriesCount},LegendItemLabel:function(e){var t=this;return t.LegendIsSumItem(e)?t.LegendSumLabelShow():t.LegendIsGroup()?t.GroupLabels[e]:t.getSeriesShowLabel(e)},LegendItemValueText:function(e){var t=this,r=0,o=t.graphSerieses[0];return t.LegendIsSumItem(e)?r=t.GetTotalValue():t.LegendIsGroup()?r=t.Value(0,e):(r=t.GetSeriesTotalValue(e),o=t.graphSerieses[e]),o.ValueFormatParser.format(r)},LegendSumLabelShow:function(){return this.LegendSumLabel||"合计"},Support3D:function(){return this.Series.items.every(function(e){return e.Support3D()})},YAxisOfSeries:function(e){var t=this;return e.ByY2Axis?t.Y2Axis:t.YAxis},getSeriesShowLabel:function(e){var t=this;return t.SeriesLabels[e]||(t.graphSerieses[e]?t.graphSerieses[e].SeriesName:"")},getUsingTitleFont:function(){return this.TitleFont.UsingFont()},getUsingValueFont:function(){return this.ValueFont.UsingFont()},GetGraphFillColor:function(e){var t,r,o,n,a=this,i=a.graphSerieses[e],l=a.FillColors?a.FillColors.length:bt;return a.IsColorSingleBar()||i.FillColorAuto?(t=Math.floor(e/l),r=e%l,o=a.FillColors?a.FillColors[r]:R(Ct[r],a.report.viewer.alpha.chartGraph),t>0&&(n=B(o),o=P((n.r+73*r+196*t)%255,(n.g+197*r+120*t)%255,(n.b+117*r+90*t)%255,n.a)),o):i.FillColor},GetSeriesIndexByLabel:function(e,t){var r=this,o=r.SeriesLabels.indexOf(e);return 0>o&&t&&(o=+e,(!isNaN(o)||o>=r.SeriesCount)&&(o=-1)),o},GetGroupIndexByLabel:function(e,t){var r=this,o=r.GroupLabels.indexOf(e);return 0>o&&t&&(o=+e,(!isNaN(o)||o>=r.GroupCount)&&(o=-1)),o},GetDrawValueText:function(e,t){var r=this.graphSerieses[e];return r.LabelTextBuilder?r.LabelTextBuilder.generateChartDisplayText(e,t):""},GetGroupTotalValue:function(e,t){var r,o=this,n=e.length,a=0;if(!o.IsScatterGraph())for(r=0;n>r;r++)a+=o.Value(e[r],t);return a},GetSeriesTotalValue:function(e){var t,r,o=this,n=0;if(o.IsScatterGraph())for(r=o.ValueCount(e),t=0;r>t;t++)n+=o.Value(e,t).z;else for(t=0;t<o.GroupCount;t++)n+=o.Value(e,t);return n},GetTotalValue:function(){var e,t=this,r=0;for(e=0;e<t.SeriesCount;e++)r+=t.GetSeriesTotalValue(e);return r},prepareValues:function(){for(var e=this,t=e.values.length;t++<e.SeriesCount;)e.values.push([])},get AsChart(){return this},GroupLabel:function(e){return this.GroupLabels[e]},SetGroupLabel:function(e,t){this.GroupLabels[e]=t},SeriesLabel:function(e){return this.SeriesLabels[e]},SetSeriesLabel:function(e,t){this.SeriesLabels[e]=t},Value:function(e,t){var r=this;return r.prepareValues(),r.values[e][t]},SetValue:function(e,t,r){var o=this;o.prepareValues(),o.values[e][t]=r},ValueCount:function(e){var t=this;return t.prepareValues(),t.values[e].length},get FillColorCount(){var e=this;return e.FillColors?e.FillColors.length:0},getFillColor:function(t){var r=this;return r.FillColors?r.FillColors[t]:e},AddFillColor:function(e){var t=this;t.FillColors&&(t.FillColors=[]),t.FillColors.push(e)},EmptyFillColors:function(){delete self.FillColors},LoadDataFromXML:function(e,t,r,o){function n(){return l?i.text:i.textContent}var a,i,l,s,c,u,d=this,h=1,p=G(e);if(!dom)return 0;for(o&&(d.GroupCount=0,d.GroupLabels=[]),r&&(d.SeriesCount=0,d.SeriesLabels=[]),d.values=[],a=p.childNodes[0].firstChild,nodeText=a.hasOwnProperty("text");a;){if(i=a.firstChild,t&&(s=n(),i=i.nextSibling,c=d.GetSeriesIndexByLabel(s,!r),0>c&&r&&(c=d.SeriesCount,d.SeriesCount++,d.SeriesLabels.push(s)),0>c))throw 0;if(s=n(),i=i.nextSibling,u=d.GetGroupIndexByLabel(s,!o),0>u&&o&&(u=d.GroupCount,d.GroupCount++,d.GroupLabels.push(s)),0>u)throw 0;if(t)d.SetValue(c,u,+n()+d.Value(c,u));else for(c=0;i;)d.SetValue(c,u,+n()+d.Value(c,u)),c++,i=i.nextSibling;a=a.nextSibling}return h},DoLoadXYZDataFromXML:function(e,t,r){function o(){return i?a.text:a.textContent}var n,a,i,l,s,c,u,d,h=this,p=1,f=G(e);if(!dom)return 0;for(t&&(h.SeriesCount=0,h.SeriesLabels=[]),h.values=[],n=f.childNodes[0].firstChild,nodeText=n.hasOwnProperty("text");n;){if(a=n.firstChild,FirstSeries?(l=o(),d=h.GetSeriesIndexByLabel(l,!t),0>d&&t&&(d=m_SeriesCount,++m_SeriesCount,m_SeriesLabels[d]=l),a=a.nextSibling):d=0,0>d)throw 0;s=+o(),a=a.nextSibling,c=+o(),r||(a=a.nextSibling,u=+o()),h.AddXYZValue(d,s,c,u),n=n.nextSibling}return p},LoadXYDataFromXML:function(e,t){return this.DoLoadXYZDataFromXML(e,t,1)},LoadXYZDataFromXML:function(e,t){return DoLoadXYZDataFromXML(e,t,0)},AddXYZValue:function(e,t,r,o){var n=this;n.prepareValues(),n.values[e].push({x:t,y:r,z:o})},EmptyValues:function(){var e=this;e.values=[],e.prepareValues()}},V(At,De),gr.dom.Report=Ke}(),function(e,t){"use strict";var r=gr.helper,o=gr.common,n=(gr.enum_,gr.const_),a=r.penStyleText,i=r.fontCSSText,l=r.pixelsToHtml,s=r.colorValue2Html,c=r.assignObject,u=r.compareObject,d=r.parseXML,h=r.xmlToReportDataJSON,p=o.HtmlStyles,f=function(e){var t,r,o=this;e.FreeCell?e.isSingleDockControl()&&(r=e.Controls.items[0],r.TextFormat&&(o.TextFormat={},o.TextFormat.ForeColor=r.ForeColor,c(o.TextFormat,r.TextFormat)),t=o.padding={},t.Left=r.PaddingLeft,t.Right=r.PaddingRight,t.Top=r.PaddingTop,t.Bottom=r.PaddingBottom):(o.TextFormat={},c(o.TextFormat,e.TextFormat),o.TextFormat.ForeColor=e.ForeColor,t=o.padding={},t.Left=e.PaddingLeft,t.Right=e.PaddingRight,t.Top=e.PaddingTop,t.Bottom=e.PaddingBottom),e.BorderCustom?(o.border={},c(o.border,e.Border)):o.ownerGrid=e.getOwnerGrid(),o.toFillBack=e.toFillBack(),o.toFillBack&&(o.BackColor=e.BackColor)};f.prototype={compare:function(e){var t=this,r=new f(e);return u(t.padding,r.padding)&&u(t.TextFormat,r.TextFormat)&&u(t.border,r.border)&&t.toFillBack===r.toFillBack&&t.BackColor===r.BackColor&&t.ownerGrid===r.ownerGrid},getStyleName:function(){return"-gr-cell"+this.index},getStyles:function(){var e=this,t=new p,r=e.TextFormat;return r&&(t.addTextFormat(r,1),t.addObjectPadding(e)),e.border?t.addBorder(e.border):t.addCellBorder(e.ownerGrid),e.toFillBack&&t.addBackColor(e.BackColor),t}};var g=function(e){var t=this,r=t.padding={},o=e.getUsingFont();t.asCell=!!e.cell,e.TextFormat&&(t.TextFormat={},t.TextFormat.ForeColor=e.ForeColor,c(t.TextFormat,e.TextFormat)),r.Left=e.PaddingLeft,r.Right=e.PaddingRight,r.Top=e.PaddingTop,r.Bottom=e.PaddingBottom,t.border={},c(t.border,e.Border),t.toFillBack=e.toFillBack(),t.toFillBack&&(t.BackColor=e.BackColor),t.textdecoration={Underline:o.Underline,Strikethrough:o.Strikethrough}};g.prototype={compare:function(e){var t=this,r=new g(e);return u(t.padding,r.padding)&&u(t.TextFormat,r.TextFormat)&&u(t.border,r.border)&&u(t.textdecoration,r.textdecoration)&&t.toFillBack===r.toFillBack&&t.BackColor===r.BackColor&&t.asCell===r.asCell},getStyleName:function(){return"-gr-ctrl"+this.index},getStyles:function(){var e=this,t=new p,r=e.textdecoration;return!e.asCell&&t.add("position","absolute"),t.addObjectPadding(e),t.addBorder(e.border),e.TextFormat&&t.addTextFormat(e.TextFormat,e.asCell),e.toFillBack&&t.addBackColor(e.BackColor),(r.Underline||r.Strikethrough)&&t.add("text-decoration",(r.Underline?"underline":"")+(r.Underline&&r.Strikethrough?" ":"")+(r.Strikethrough?"line-through":"")),t}};var m=function(e){var t=this;t.Left=e.pxRect.left,t.Top=e.pxRect.top,t.Width=e.getContentWidth(),t.Height=e.getContentHeight()};m.prototype={compare:function(e){var t=this;return t.Left===e.pxRect.left&&t.Top===e.pxRect.top&&t.Width===e.getContentWidth()&&t.Height===e.getContentHeight()},getStyleName:function(){return"-gr-pos"+this.index},getStyles:function(){var e=this,t=new p;return t.add("left",l(e.Left)),t.add("top",l(e.Top)),t.add("width",l(e.Width)),t.add("height",l(e.Height)),t}};var C=function(e){var t=this,r=e.cells?e:0;t.section=e,t.isLastRow=1,t.Height=e.pxHeight,r&&(e=r.section,t.isLastRow=e.tableRows[e.tableRows.length-1]===r),e.Font.font&&(t.Font={},c(t.Font,e.Font.font)),e.owner.Header&&(t.detailgrid=e.owner.owner),!e.toFillBack()||r&&!t.detailgrid||(t.BackColor=e.BackColor)};C.prototype={compare:function(e){var t,r,o=this,n=e.cells?e:0,a=e.pxHeight,i=1;return n&&(e=e.section,i=e.tableRows[e.tableRows.length-1]===n),t=e.toFillBack()&&(!n||e.owner.Header),r=e.Font.font,o.Height===a&&(r&&o.Font&&u(r,o.Font)||!r&&!o.Font)&&(t&&o.BackColor&&o.BackColor===e.BackColor||!t&&!o.BackColor)&&(e.owner.Header&&e.owner.owner===o.detailgrid||!e.owner.Header&&!o.detailgrid)&&o.isLastRow===i},getStyleName:function(){return"-gr-section"+this.index},getStyles:function(){var e=this,t=e.section,r=t.pctHeight,o=new p,n=e.detailgrid;return o.add("height",r?r+"%":l(e.Height)),(r||!t.cells&&t.report.viewer.options.reportFitWidth)&&o.add("width","100%"),e.Font&&(o.items=o.items.concat(b.prototype.getStyles.call(e.Font).items)),e.BackColor&&o.addBackColor(e.BackColor),e.isLastRow&&n&&n.ShowRowLine&&o.add("border-bottom",a(n.ColLinePen)),o}};var b=function(e){var t=this;t.Size=e.Size,t.Bold=e.Bold,t.Italic=e.Italic,t.Name=e.Name};b.prototype={compare:function(e){var t=this;return t.Size===e.Size&&t.Bold===e.Bold&&t.Italic===e.Italic&&t.Name===e.Name},getStyleName:function(){return"-gr-fs"+this.index},getStyles:function(){var e=new p;return e.add("font",i(this)),e}};var v=function(e){this.htmlStyles=e};v.prototype={getStyleName:function(){return"-gr-cs"+this.index},getStyles:function(){return this.htmlStyles}};var T=function(e){var t=this;t.items=[],t.classStyle=e};T.prototype={toString:function(){var e="";return this.items.forEach(function(t){e+="."+t.getStyleName()+"{"+t.getStyles().getText()+"}\r\n"}),e},select:function(e,t){return this.selectItem(e,t).getStyleName()},selectItem:function(e,t){var r,o,n=this,a=n.items.length;if(t&&t.compare(e))return t;for(r=0;a>r;r++)if(o=n.items[r],o.compare(e))return o;return o=new n.classStyle(e),o.index=a,n.items.push(o),o}};var x=function(e,t,r,o){var n=this;n.running=!1,n.generated=!1,n.events={},n.viewerHolderID=e,n.reportHTTP={},"string"==typeof t?n.reportHTTP.url=t:c(n.reportHTTP,t),n.dataHTTP={},"string"==typeof r?n.dataHTTP.url=r:c(n.dataHTTP,r),n.alpha={background:.5,border:.8,stroke:.8,pen:.8,text:.8,chartGraph:0,chartStroke:1},n.options={controlPosition:gr.enum_.controlLayout.auto,reportFitWidth:!1,reportFitHeight:!1,detailgridResize:gr.enum_.detailgridResize.asDesign,singleChartFill:!0,selectionHighlight:!0,selectionCell:!1,selectionTextColor:"rgba(255,255,255,1)",selectionBackColor:"rgba(20,20,127,1)",hoverEnabled:!0,hoverBackColor:"#eee",hoverTextColor:"#000"},n.attachOptions(o),n.report=new gr.dom.Report(n)};x.prototype={attachOptions:function(e){var t=this;t.stop(),e&&c(t.options,e)},loadReport:function(e,r,o){function n(){function e(e){return e>=" "&&"~">=e&&(e=d[e.charCodeAt(0)-32]),e}for(var t,r,o,n,a,i=s,l="",c=4,u=i.length,d=gr.WRAsciiMap_R,h=gr.WRZipSource,p=gr.WRZipDest,f=[];u>c;)l+=e(i[c++]);for(c=0;"["==l[c];){for(a={},t=++c;","!=l[c];)c++;for(a.f=+l.substring(t,c),t=++c;"]"!=l[c];)c++;a.s=+l.substring(t,c++),f.push(a)}for(i=l.substr(c).split(""),a=f.length;a-- >0;)r=f[a].f,o=f[a].s,n=i[r],i[r]=i[o],i[o]=n;for(u=i.length,l="",c=0;u>c;c++)n=i[c],a=p.indexOf(n),a>=0?l+=h[a]:("#"==n&&(n=i[++c]),l+=n);s=l}var a,i=this,l=i.report,s=e;if(r=r||r===t,o=o||o===t){try{s.responseText!==t&&(s=s.responseText),"string"==typeof s&&(l.isWR="_WR_"===s.substr(0,4),l.isWR&&n(),s=JSON.parse(s)),l.loadFromJSON(s),i.events.onReportLoaded&&i.events.onReportLoaded(i)}catch(c){o=0,a="解析报表模板"}o&&(i.reportPrepared=!0,r&&!i.waitData&&i.generate())}else a="获取报表模板";!o&&i.displayError(a,e,1)},loadData:function(e,r,o){var n,a=this,i=e;if(r=r||r===t,o=o||o===t){try{if(i.responseText!==t&&(i=i.responseText),"string"==typeof i)if("{"===i.charAt(0))i=JSON.parse(i);else{if(i=i.replace(/\r\n/g,""),i=d(i),!i)throw 0;i=h(i)}a.tables=i}catch(l){o=0,n="解析报表数据"}o&&(a.dataPrepared=!0,r&&a.generate())}else n="获取报表数据";!o&&a.displayError(n,e,0)},start:function(){var t=this;t.waitData&&(t.waitData=0),t.generated||t.running||(t.running=!0,t.events.onGenerateBegin&&t.events.onGenerateBegin(t),t.reportPrepared=t.reportPrepared||!t.reportHTTP.url,t.dataPrepared=t.dataPrepared||!t.dataHTTP.url,t.reportPrepared&&t.dataPrepared?(t.events.onReportLoaded&&t.events.onReportLoaded(t),!t.waitData&&t.generate()):(!t.reportPrepared&&e.rubylong.ajax(t.reportHTTP,function(e,t){this.loadReport(e,1,t)},t),!t.dataPrepared&&e.rubylong.ajax(t.dataHTTP,function(e,t){this.loadData(e,1,t)},t)))},stop:function(e,r){var o,n=this,a=n.report;return n.running?!1:(n.generated&&(e||(a.Clear(),n.reportPrepared=!1),r||(n.tables=t,n.dataPrepared=!1),n.viewerHolderID&&(o=document.getElementById(n.viewerHolderID),o&&(o.innerHTML="",DEBUG&&(document.getElementById("htmlText")&&(document.getElementById("htmlText").innerText="htmlText"),document.getElementById("stylesText")&&(document.getElementById("stylesText").innerText="stylesText")))),a.unprepare(),n.generated=!1),!0)},generate:function(){function t(){o.fontStyles=new T(b),o.controlStyles=new T(g),o.cellStyles=new T(f),o.sectionStyles=new T(C),o.positionStyles=new T(m),o.customStyles=new T(v)}var o=this,a=o.report,i=document.getElementById(o.viewerHolderID);if(o.reportPrepared&&o.dataPrepared){try{i.innerHTML="",DEBUG&&(o.stylesText=""),o._detailgrids=[],o._domevents=[],o.html="",t(),i.classList.add(o.selectFont2(a.Font.font)),16777215!==a.BackColor&&(i.style.backgroundColor=s(a.BackColor)),o.html=a.generateHtml(),o.generateStyles(),i.innerHTML=o.html,a.toFillHolder&&(i.style.height="100%"),a.singleChart&&(i.style.backgroundColor=s(a.singleChart.BackColor)),a.canvasControls&&(a.prepareCanvas(),a.isDynamicSize?(r.addEvent(e,"resize",function(e){a.resizeCanvas()}),a.resizeCanvas()):a.renderCanvas()),o._detailgrids.forEach(function(e,t){var o=document.getElementById(n.DG_ID+t);r.addEvent(o,"mousedown",function(t){e.onmousedown(t)})}),o._domevents.forEach(function(e,t){for(var o=document.querySelectorAll("."+r.getDomEventCSSName(t+1)),t=o.length;t-- >0;)switch(e.type){case 1:r.addEvent(o[t],"click",function(t){e.fun(t)});break;default:r.addEvent(o[t],"dblclick",function(t){e.fun(t)})}}),DEBUG&&(document.getElementById("htmlText")&&(document.getElementById("htmlText").innerText=o.html),document.getElementById("stylesText")&&(document.getElementById("stylesText").innerText=o.stylesText))}catch(l){i.innerHTML="生成报表时发生异常错误!<br />Error Code: "+l.number+"<br />Error Name: "+l.name+"<br />Error Message: "+l.message}o.running=!1,o.generated=!0,o.events.onGenerateEnd&&o.events.onGenerateEnd(o)}},generateStyles:function(){var e=this,t=e.report,r=e.options,o=document.getElementById(n.REPORT_STYLE_ID),a=t.toFillHolder?"html,body{height:100%;}\n*{margin:0;padding:0;}":"";o||(o=document.createElement("STYLE"),o.id=n.REPORT_STYLE_ID,document.head.appendChild(o)),a+="."+n.DG_CSS+"{}\n",r.hoverEnabled&&(a+="."+n.DG_CSS+">tbody>tr:hover {background-color:"+r.hoverBackColor+";color:"+r.hoverTextColor+";}\n"),r.selectionHighlight&&(a+="."+n.SH_CSS+"{ background-color:"+r.selectionBackColor+";color:"+r.selectionTextColor+";}\n"),o.innerHTML=[e.fontStyles,e.positionStyles,e.sectionStyles,e.cellStyles,e.controlStyles,e.customStyles,e.getDomEventStyles(),a].join(""),DEBUG&&(e.stylesText=o.innerHTML)},getDomEventStyles:function(){for(var e=this._domevents.length,t="";e>0;)t+="."+r.getDomEventCSSName(e--)+"{}\n";return t},addCustomStyle:function(e){var t=this.customStyles.items,r=new v(e);return r.index=t.length,t.push(r),r},selectCell:function(e){return this.cellStyles.select(e,e.defaultStyle)},selectCellItem:function(e){return this.cellStyles.selectItem(e)},selectControl:function(e){return this.controlStyles.select(e,e.defaultStyle)},selectControlItem:function(e){return this.controlStyles.selectItem(e)},selectSection:function(e){return this.sectionStyles.select(e,e.defaultStyle)},selectSectionItem:function(e){return this.sectionStyles.selectItem(e)},selectPosition:function(e){return this.positionStyles.select(e,e.defaultPositionStyle)},selectPositionItem:function(e){return this.positionStyles.selectItem(e)},selectFont:function(e,t){return this.fontStyles.select(e,t)},selectFont2:function(e){return this.selectFontItem(e).getStyleName()},selectFontItem:function(e){return this.fontStyles.selectItem(e)},displayError:function(e,r,o){var a,i=this,l=r.responseText!==t,s=l?o?i.reportHTTP:i.dataHTTP:t,c=document.getElementById(i.viewerHolderID);a='<div style="background-color:#bbffbb"><h3>'+e+"失败，锐浪HTML5报表("+n.VERSION+")</h3>",s&&(a+='<div>URL: <a href="'+s.url+'">'+s.url+"</a></div>"),l?(a+="<div>HTTP Status: "+r.status+"</div><div>HTTP Status Text: "+r.statusText+"</div>",r.responseText&&(a+="<div>HTTP Response Text: <pre>"+r.responseText+"</pre></div>")):a+="string"==typeof r?"<div>Loaded Text: <pre>"+r+"</pre></div>":"<div>Loaded Json Object: <pre>"+JSON.stringify(r)+"</pre></div>",a+="</div>",c.innerHTML=a},get reportURL(){return this.reportHTTP.url},set reportURL(e){this.reportHTTP.url=e},get dataURL(){return this.dataHTTP.url},set dataURL(e){this.dataHTTP.url=e}},e.rubylong={grhtml5:{controlLayout:gr.enum_.controlLayout,detailgridResize:gr.enum_.detailgridResize,barcodeURL:"/html5/General/Barcode.ashx",Viewer:x,helper:r,utility:gr.utility,insertReportViewer:function(e,t,r,o){return new x(e,t,r,o)}},ajax:function(e,t,r,o){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState&&n.status>0&&t.call(r,n,200==n.status)},n.onerror=function(){t.call(r,n,0)},"string"==typeof e&&(e={url:e}),e.method||(e.method=o?o:"GET"),n.open(e.method,e.url,!0),n.send(e.data)}}}(window);